webpackJsonp([155],{"96Ut":function(e,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var n=t("tzsN"),r=t("pADA"),i=t("0oES"),o=t("syAl"),l=(t("Luip"),t("0VOF")),s=t("AA3o"),u=t.n(s),d=function e(){u()(this,e),this.data={BusiOper:"Q"},this.BusiDataKey="queryRetainUkey",this.TransServiceCode="ib-dbcomm/dbComm"},c={components:{selectTree:n.a},data:function(){return{brnoList:[],formInline:{startdate:"",enddate:"",branchId:[],devNum:"",dealflag:"",expdealstatus:""},filename:"废盾记录查询导出",currentPage:1,loading:!1,tableData:[],tableTotal:0,typedealflag:[{label:"处理",value:"1"},{label:"未处理",value:"2"}],dealflagtype:o.a.get("dealflagtype"),pickerOptionsStart:{disabledDate:function(e){(new Date).getTime();return e.getTime()>Date.now()}}}},created:function(){this.formInline.startdate=r.a.getNowTime(29),this.formInline.enddate=r.a.getNowTime(0),this.pageSize=o.a.get("PageSize"),this.initBrno(),console.log("=====",this.dealflagtype)},watch:{formInline:{handler:function(e,a){this.currentPage=1},deep:!0}},methods:{dateChange:function(){this.formInline.startdate>this.formInline.enddate?(this.$aui.message.show({type:"warning",message:"开始日期不能大于结束日期"}),this.formInline.startdate=r.a.getNowTime(29),this.formInline.enddate=r.a.getNowTime(0)):this.formInline.startdate<r.a.getNowTime(365)&&(this.$aui.message.show({type:"warning",message:"开始日期不能超过当日前12个月"}),this.formInline.startdate=r.a.getNowTime(365))},dFormat:function(e,a){return r.a.timeFormat2Date(e[a.property])},tFormat:function(e,a){return r.a.timeFormat2Time(e[a.property])},dealflagFormat:function(e,a){return this.dealflagtype[e[a.property]]},handleDownload:function(){var e=this;t.e(169).then(t.bind(null,"FNRk")).then(function(a){var t=e.list1,n=e.formatJson(["PLATFM_SN","PLATFM_WORK_DT","PLATFM_WORK_TM","ORG_NO","ORG_NM","EQUIP_NO","VOUCH_NO","RSN_CD","UKEY_BIND_FAIL_RSN","DLWTH_FLG_CD","SERVICECODE"],t);a.export_json_to_excel({header:["业务流水号","交易日期","交易时间","机构号","机构名称","设备编号","U盾凭证号","错误代码","错误描述","废盾处理标志","备注"],data:n,filename:e.filename,autoWidth:e.autoWidth,bookType:e.bookType})})},formatJson:function(e,a){return a.map(function(a){return e.map(function(e){return"timestamp"===e?parseTime(a[e]):a[e]})})},initBrno:function(){var e=this;this.loading=!0;var a=new l.a;a.data.orgno=this.$store.getters.BranchNum,Object(i.a)(a).then(function(a){console.log(a),e.loading=!1,e.branchNum=a.RspInfo.Result||[],e.permission=r.a.objArray2Hash(e.branchNum,"orgno"),e.brnoMap=a.RspInfo.orgMap||{},e.brnoList=r.a.formatTreeData(e.branchNum,"orgno","superno"),e.formInline.branchId.push(e.brnoList[0].orgno)}).catch(function(a){e.loading=!1,e.$aui.message.show({type:"warning",message:a.SYS_HEAD.ReturnMessage}),console.error("查询错误",a)})},handleSizeChange:function(e){},handleCurrentChange:function(e){this.currentPage=e,this.querylist()},querylist:function(){var e=this;this.loading=!0;var a=new d;a.data.orgno=this.formInline.branchId[0],a.data.sdate=this.formInline.startdate,a.data.edate=this.formInline.enddate,a.data.flag=this.formInline.dealflag,a.data.equipno=this.formInline.devNum,a.data.CurtPage=this.currentPage+"",a.data.PageSize=this.pageSize+"",a.data.StartRows=(this.currentPage-1)*this.pageSize+"",Object(i.a)(a).then(function(a){e.loading=!1,console.log("---------------------",a),e.tableData=a.RspInfo.Result||[],e.tableTotal=a.RspInfo.totalNum,"0"==e.tableTotal&&e.$aui.message.show({type:"warning",message:"无满足条件的记录"})}).catch(function(a){e.loading=!1,e.tableData=[],e.tableTotal=0,e.$aui.message.show({type:"error",message:"请求失败，错误码:"+a.SYS_HEAD.ReturnCode+"，错误信息："+a.SYS_HEAD.ReturnMessage}),console.error("查询错误",a)})},getExcel:function(){var e=this;this.$refs.formInline.validate(function(a){if(a){e.loading=!0;var t=new d;t.data.orgno=e.formInline.branchId[0],t.data.sdate=e.formInline.startdate,t.data.edate=e.formInline.enddate,t.data.flag=e.formInline.dealflag,t.data.equipno=e.formInline.devNum,t.data.CurtPage="1",t.data.PageSize="50000000",t.data.StartRows="",Object(i.a)(t).then(function(a){e.loading=!1,e.list1=a.RspInfo.Result||[],e.handleDownload()}).catch(function(a){e.loading=!1,e.$aui.message.show({type:"warning",message:"请求失败，错误码:"+a.SYS_HEAD.ReturnCode+"，错误信息："+a.SYS_HEAD.ReturnMessage}),console.error("查询错误",a)})}})},resetForm:function(e){this.$refs[e].resetFields()}}},m={render:function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{"element-loading-text":"拼命加载中"}},[t("aui-card",{staticStyle:{"margin-bottom":"10px",overflow:"visible"}},[t("aui-form",{ref:"formInline",attrs:{model:e.formInline,"label-position":"top",size:"mini"}},[t("aui-row",{attrs:{gutter:10}},[t("aui-col",{attrs:{md:6,lg:4}},[t("aui-form-item",{staticClass:"typeInfo-aui-form-item",attrs:{label:"机构",prop:"branchId"}},[t("select-tree",{staticStyle:{width:"170px"},attrs:{"single-check":!0,props:{id:"orgno",label:"cname",children:"children"},"tree-data":e.brnoList,placeholder:"请选择机构"},model:{value:e.formInline.branchId,callback:function(a){e.$set(e.formInline,"branchId",a)},expression:"formInline.branchId"}})],1)],1),e._v(" "),t("aui-col",{attrs:{md:6,lg:4}},[t("aui-form-item",{attrs:{label:"开始日期",prop:"startdate"}},[t("aui-date-picker",{attrs:{editable:!1,clearable:!1,"picker-options":e.pickerOptionsStart,"value-format":"yyyyMMdd",type:"date",placeholder:"选择日期"},on:{change:e.dateChange},model:{value:e.formInline.startdate,callback:function(a){e.$set(e.formInline,"startdate",a)},expression:"formInline.startdate"}})],1)],1),e._v(" "),t("aui-col",{attrs:{md:6,lg:4}},[t("aui-form-item",{attrs:{label:"结束日期",prop:"enddate"}},[t("aui-date-picker",{attrs:{editable:!1,clearable:!1,"picker-options":e.pickerOptionsStart,"value-format":"yyyyMMdd",type:"date",placeholder:"选择日期"},on:{change:e.dateChange},model:{value:e.formInline.enddate,callback:function(a){e.$set(e.formInline,"enddate",a)},expression:"formInline.enddate"}})],1)],1),e._v(" "),t("aui-col",{attrs:{md:6,lg:4}},[t("aui-form-item",{attrs:{label:"处理标志",prop:"dealflag"}},[t("aui-select",{attrs:{placeholder:"请选择处理标志"},model:{value:e.formInline.dealflag,callback:function(a){e.$set(e.formInline,"dealflag",a)},expression:"formInline.dealflag"}},e._l(e.typedealflag,function(e){return t("aui-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1)],1),e._v(" "),t("aui-col",{attrs:{md:6,lg:4}},[t("aui-form-item",{attrs:{label:"设备编号",prop:"devNum"}},[t("aui-input",{attrs:{placeholder:"请选择设备编号"},model:{value:e.formInline.devNum,callback:function(a){e.$set(e.formInline,"devNum",a)},expression:"formInline.devNum"}})],1)],1)],1),e._v(" "),t("aui-row",[t("aui-col",{staticClass:"searchBtnMarginTop",attrs:{md:3,lg:2}},[t("aui-form-item",[t("aui-button",{attrs:{type:"primary",icon:"aui-icon-search"},on:{click:e.querylist}},[e._v("查询")])],1)],1),e._v(" "),t("aui-col",{staticClass:"searchBtnMarginTop",attrs:{lg:2,md:3}},[t("aui-form-item",[t("aui-button",{attrs:{type:"warning",icon:"aui-icon-refresh"},on:{click:function(a){e.resetForm("formInline")}}},[e._v("重置")])],1)],1),e._v(" "),t("aui-col",{staticClass:"searchBtnMarginTop",attrs:{lg:2,md:3}},[t("aui-form-item",[e.btnPermission("Button_SwallowCardQue_Export")?t("aui-button",{attrs:{type:"primary",icon:"aui-icon-download"},on:{click:e.getExcel}},[e._v("导出")]):e._e()],1)],1)],1)],1)],1),e._v(" "),t("aui-card",[t("aui-table",{staticStyle:{"min-height":"390px"},attrs:{data:e.tableData,height:"390","header-row-class-name":"tableHeaderClass",border:""}},[t("aui-table-column",{attrs:{prop:"PLATFM_SN",label:"业务流水号"}}),e._v(" "),t("aui-table-column",{attrs:{prop:"PLATFM_WORK_DT",label:"交易日期"}}),e._v(" "),t("aui-table-column",{attrs:{prop:"PLATFM_WORK_TM",label:"交易时间"}}),e._v(" "),t("aui-table-column",{attrs:{prop:"ORG_NO",label:"机构号"}}),e._v(" "),t("aui-table-column",{attrs:{prop:"ORG_NM",label:"机构名称"}}),e._v(" "),t("aui-table-column",{attrs:{prop:"EQUIP_NO",label:"设备编号"}}),e._v(" "),t("aui-table-column",{attrs:{prop:"VOUCH_NO",label:"U盾凭证号"}}),e._v(" "),t("aui-table-column",{attrs:{prop:"RSN_CD",label:"错误代码"}}),e._v(" "),t("aui-table-column",{attrs:{prop:"UKEY_BIND_FAIL_RSN",label:"错误描述"}}),e._v(" "),t("aui-table-column",{attrs:{prop:"DLWTH_FLG_CD",formatter:e.dealflagFormat,label:"废盾处理标志"}}),e._v(" "),t("aui-table-column",{attrs:{prop:"SERVICECODE",label:"备注"}})],1),e._v(" "),t("aui-pagination",{staticStyle:{"text-align":"right","margin-top":"20px"},attrs:{"current-page":e.currentPage,background:"",layout:"total, prev, pager, next, jumper",total:e.tableTotal},on:{"current-change":e.handleCurrentChange,"update:currentPage":function(a){e.currentPage=a}}})],1)],1)},staticRenderFns:[]};var p=t("/Xao")(c,m,!1,function(e){t("gMFE")},null,null);a.default=p.exports},XqVL:function(e,a,t){(e.exports=t("BkJT")(!1)).push([e.i,"\n.aui-date-editor.aui-input,\n.aui-date-editor.el-input__inner {\n  width: 100%;\n}\n\n",""])},gMFE:function(e,a,t){var n=t("XqVL");"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);t("8bSs")("01e7f648",n,!0)}});