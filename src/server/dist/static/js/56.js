webpackJsonp([56],{"7+8p":function(e,t,a){var r=a("H+0h");"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);a("8bSs")("8dcfcbf4",r,!0)},"H+0h":function(e,t,a){(e.exports=a("BkJT")(!1)).push([e.i,"",""])},OS1i:function(e,t,a){var r=a("x6hd");"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);a("8bSs")("23b953b1",r,!0)},f40C:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("tzsN"),i=a("0oES"),o=a("fCv1"),s=a("AA3o"),n=a.n(s),l=function e(){n()(this,e),this.data={OperTp:"A",Brno:"",Descr:"",RuleTp:"",RuleName:"",TransServiceCode:"MS_MS011"},this.CommCode="CQParaManage",this.SceneCode="RuleGrpDefnMnt",this.TransServiceCode="mg-afaservices-cq/ruleDefineManage"},u=function e(){n()(this,e),this.data={OperTp:"M",Brno:"",Descr:"",RuleTp:"",RuleName:"",RuleId:""},this.CommCode="CQParaManage",this.SceneCode="RuleGrpDefnMnt",this.TransServiceCode="mg-afaservices-cq/ruleDefineManage"},c={components:{selectTree:r.a},props:{option:Object},data:function(){return{loading:!1,appId:[],ruleTypeList:[{value:"01",label:"叫号规则"},{value:"02",label:"排队机界面"}],form:{ruleType:"",ruleName:"",dese:"",brno:[],ruleId:""},rules:{brno:[{type:"array",required:!0,message:"请选择机构编号",trigger:"change"}],ruleType:[{required:!0,message:"请选择规则类型",trigger:"change"}],ruleName:[{required:!0,message:"请输入规则名称",trigger:"blur"},{validator:o.l,trigger:"blur"},{validator:Object(o.h)(30),trigger:"blur"}],dese:[{validator:Object(o.h)(100),trigger:"blur"},{validator:o.l,trigger:"blur"}]}}},created:function(){},methods:{openUpdate:function(){var e=this;"2"==this.option.mark?this.$nextTick(function(){e.setData()}):this.$refs.form&&this.$refs.form.clearValidate()},setData:function(){this.form.brno.push(this.option.currentRow.Brno),this.form.ruleName=this.option.currentRow.RuleName,this.form.ruleType=this.option.currentRow.RuleTp,this.form.dese=this.option.currentRow.Descr,this.form.ruleId=this.option.currentRow.RuleId},closeUpdete:function(){this.$refs.form.resetFields(),this.$refs.form.clearValidate()},ItemUpdate:function(){var e=this;this.$refs.form.validate(function(t){if(!t)return e.$aui.message.show({type:"warning",message:"请输入合法的数据！"}),!1;e.loading=!0;var a="1"==e.option.mark?new l:new u;a.data.Brno=e.form.brno[0],a.data.Descr=e.form.dese,a.data.RuleTp=e.form.ruleType,a.data.RuleName=e.form.ruleName,a.data.RuleId=e.form.ruleId,console.log(a),Object(i.a)(a).then(function(t){e.$emit("refreshTable"),e.option.isShow=!1;var a="1"==e.option.mark?"创建":"修改";e.$aui.message.show({type:"success",message:a+"成功!"}),e.loading=!1}).catch(function(t){e.$aui.message.show({type:"warning",message:t.SYS_HEAD.ReturnMessage+"!"}),e.loading=!1})})}}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("aui-dialog",{attrs:{title:e.option.title,visible:e.option.isShow,width:"800px","close-on-click-modal":!1},on:{"update:visible":function(t){e.$set(e.option,"isShow",t)},show:e.openUpdate,hide:e.closeUpdete}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[a("aui-card",[a("aui-form",{ref:"form",attrs:{model:e.form,size:"mini",rules:e.rules,"label-width":"140px","label-position":"right"}},[a("aui-row",{attrs:{gutter:40}},[a("aui-col",{attrs:{span:12}},[e.option.isDisabled?a("aui-form-item",{attrs:{label:"规则ID:",prop:"ruleId"}},[a("aui-input",{attrs:{disabled:!0},model:{value:e.form.ruleId,callback:function(t){e.$set(e.form,"ruleId",t)},expression:"form.ruleId"}})],1):e._e()],1)],1),e._v(" "),a("aui-row",{attrs:{gutter:40}},[a("aui-col",{attrs:{span:12}},[a("aui-form-item",{attrs:{label:"机构编号:",prop:"brno"}},[a("select-tree",{staticStyle:{width:"170px"},attrs:{"single-check":!0,props:{id:"orgno",label:"cname",children:"children"},"tree-data":e.option.branchNum,placeholder:"请选择机构",disabled:e.option.isDisabled},model:{value:e.form.brno,callback:function(t){e.$set(e.form,"brno",t)},expression:"form.brno"}})],1)],1),e._v(" "),a("aui-col",{attrs:{span:12}},[a("aui-form-item",{attrs:{label:"规则名称:",prop:"ruleName"}},[a("aui-input",{attrs:{placeholder:"请输入规则名称"},model:{value:e.form.ruleName,callback:function(t){e.$set(e.form,"ruleName",t)},expression:"form.ruleName"}})],1)],1)],1),e._v(" "),a("aui-row",{attrs:{gutter:40}},[a("aui-col",{attrs:{span:12}},[a("aui-form-item",{attrs:{label:"规则类型:",prop:"ruleType"}},[a("aui-select",{attrs:{disabled:e.option.isDisabled,placeholder:"请选择规则类型"},model:{value:e.form.ruleType,callback:function(t){e.$set(e.form,"ruleType",t)},expression:"form.ruleType"}},e._l(e.ruleTypeList,function(e){return a("aui-option",{key:e.value,attrs:{label:e.value+"-"+e.label,value:e.value,disabled:e.disabled}})}))],1)],1),e._v(" "),a("aui-col",{attrs:{span:12}},[a("aui-form-item",{attrs:{label:"描述:",prop:"dese"}},[a("aui-input",{attrs:{placeholder:"请输入描述内容"},model:{value:e.form.dese,callback:function(t){e.$set(e.form,"dese",t)},expression:"form.dese"}})],1)],1)],1)],1)],1),e._v(" "),a("aui-row",{staticStyle:{margin:"20px 0","text-align":"right"}},[a("aui-button",{attrs:{size:"mini"},on:{click:function(t){e.option.isShow=!1}}},[e._v("返回")]),e._v(" "),a("aui-button",{attrs:{type:"primary",size:"mini"},on:{click:e.ItemUpdate}},[e._v("确定")])],1)],1)])],1)},staticRenderFns:[]};var p=a("/Xao")(c,d,!1,function(e){a("7+8p")},null,null).exports,m=a("0VOF"),h=a("syAl"),g=function e(){n()(this,e),this.data={OperTp:"D",Brno:"",RuleId:""},this.CommCode="CQParaManage",this.SceneCode="RuleGrpDefnMnt",this.TransServiceCode="mg-afaservices-cq/ruleDefineManage"},f=function e(){n()(this,e),this.data={Brno:"",RuleId:"",CurtPage:"",PageSize:"",StartRows:"",RuleTp:""},this.CommCode="CQParaManage",this.SceneCode="RuleGrpDefQuy",this.TransServiceCode="mg-afaservices-cq/ruleDefineQuery"},b=a("pADA"),v={name:"ruleDefineManage",components:{selectTree:r.a},data:function(){return{ruleTypeList:[{value:"01",label:"叫号规则"},{value:"02",label:"排队机界面"}],ruleTypeMap:{"01":"叫号规则","02":"排队机界面"},currentRow:[],QueryForm:{branchNum:[],ruleID:"",ruleType:""},brnoList:[],branchNum:[],total:void 0,orgParamList:[],brnoMap:{},permission:{},loading:!1,isDisabledDel:!1,dialogList:{ruleDefineAdd:p},dialogOptions:{isShow:!1},currentPage:1,pageSize:void 0,rules:{branchNum:[{required:!0,message:"请选择机构编号",trigger:"change"}],ruleID:[{validator:Object(o.h)(15),trigger:"blur"}]}}},created:function(){this.pageSize=h.a.get("PageSize"),this.queryBranchNum()},watch:{QueryForm:{handler:function(e,t){this.currentPage=1},deep:!0}},computed:{},methods:{queryBranchNum:function(){var e=this;this.loading=!0;var t=new m.a;t.data.orgno=this.$store.getters.BranchNum,Object(i.a)(t).then(function(t){e.loading=!1,e.branchNum=t.RspInfo.Result||[],e.brnoMap=t.RspInfo.orgMap||{},e.permission=b.a.objArray2Hash(e.branchNum,"orgno"),e.brnoList=b.a.formatTreeData(e.branchNum,"orgno","superno"),e.QueryForm.branchNum.push(e.brnoList[0].orgno)}).catch(function(t){e.loading=!1,e.$aui.message.show({type:"warning",message:t.SYS_HEAD.ReturnMessage}),console.error("查询错误",t)})},dataFormat:function(e,t){return"Brno"==t.property?e[t.property]+"-"+e.BrName:"RuleTp"==t.property?e[t.property]+"-"+this.ruleTypeMap[e[t.property]]:void 0},clickAdd:function(){this.dialogOptions.isShow=!0,this.dialogOptions.title="新增叫号规则",this.dialogOptions.mark="1",this.dialogOptions.isDisabled=!1,this.dialogOptions.branchNum=this.brnoList},checkPermission:function(e){this.permission[this.currentRow.Brno]?e?this.clickUpdate():this.delBut():this.$aui.message.show({type:"warning",message:"权限不足,无法修改！"})},clickUpdate:function(){this.dialogOptions.isShow=!0,this.dialogOptions.title="修改叫号规则",this.dialogOptions.mark="2",this.dialogOptions.isDisabled=!0,this.dialogOptions.currentRow=this.currentRow,this.dialogOptions.branchNum=this.brnoList},resetForm:function(){this.orgParamList=[],this.$refs.QueryForm.resetFields()},delBut:function(){var e=this;this.$aui.confirm.show("此操作将永久删除该叫号规则, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.menuModelDel()}).catch(function(){e.$aui.message.show({type:"info",message:"已取消删除"})})},menuModelDel:function(){var e=this;this.loading=!0;var t=new g;t.data.Brno=this.currentRow.Brno,t.data.RuleId=this.currentRow.RuleId,Object(i.a)(t).then(function(t){e.loading=!1,e.$aui.message.show({type:"success",message:"规则删除成功！"}),e.currentPage=1,e.query()}).catch(function(t){e.loading=!1,e.$aui.message.show({type:"warning",message:t.SYS_HEAD.ReturnMessage}),console.log(t)})},query:function(){var e=this;this.$refs.QueryForm.validate(function(t){if(t){e.loading=!0;var a=new f;a.data.Brno=e.QueryForm.branchNum[0],a.data.RuleId=e.QueryForm.ruleID,a.data.RuleTp=e.QueryForm.ruleType,a.data.PageSize=e.pageSize+"",a.data.CurtPage=e.currentPage+"",a.data.StartRows=(e.currentPage-1)*e.pageSize+"",Object(i.a)(a).then(function(t){e.loading=!1,e.orgParamList=t.RspInfo.ResultList||[],e.total=t.RspInfo.recordsTotal||0,t.RspInfo.ResultList||e.$aui.message.show({type:"warning",message:"没有满足条件得记录!"})}).catch(function(t){e.orgParamList=[],e.total=0,e.loading=!1,e.$aui.message.show({type:"error",message:"请求失败，错误码:"+t.SYS_HEAD.ReturnCode+"，错误信息："+t.SYS_HEAD.ReturnMessage})})}})},handleCurrentChange:function(e){this.currentPage=e,this.query()},selectList:function(e){this.currentRow=e[0],1==e.length?this.isDisabledDel=!0:e.length>1?this.$refs.orgParamList.toggleRowSelection(e[0]):this.isDisabledDel=!1}}},y={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{"element-loading-text":"加载中。。。"}},[a("aui-card",[a("aui-form",{ref:"QueryForm",attrs:{model:e.QueryForm,rules:e.rules,size:"mini","label-position":"top"}},[a("aui-row",{attrs:{gutter:10}},[a("aui-col",{attrs:{lg:4,md:6}},[a("aui-form-item",{attrs:{label:"机构编号",prop:"branchNum"}},[a("select-tree",{staticStyle:{width:"170px"},attrs:{"single-check":!0,props:{id:"orgno",label:"cname",children:"children"},"tree-data":e.brnoList,placeholder:"请选择机构"},model:{value:e.QueryForm.branchNum,callback:function(t){e.$set(e.QueryForm,"branchNum",t)},expression:"QueryForm.branchNum"}})],1)],1),e._v(" "),a("aui-col",{attrs:{lg:4,md:6}},[a("aui-form-item",{attrs:{label:"规则类型",prop:"ruleType"}},[a("aui-select",{attrs:{filterable:"",placeholder:"请选择规则类型"},model:{value:e.QueryForm.ruleType,callback:function(t){e.$set(e.QueryForm,"ruleType",t)},expression:"QueryForm.ruleType"}},e._l(e.ruleTypeList,function(e){return a("aui-option",{key:e.value,attrs:{label:e.value+"-"+e.label,value:e.value,disabled:e.disabled}})}))],1)],1),e._v(" "),a("aui-col",{attrs:{lg:4,md:6}},[a("aui-form-item",{attrs:{label:"规则ID",prop:"ruleID"}},[a("aui-input",{attrs:{placeholder:"请输入规则ID"},model:{value:e.QueryForm.ruleID,callback:function(t){e.$set(e.QueryForm,"ruleID",t)},expression:"QueryForm.ruleID"}})],1)],1),e._v(" "),a("aui-col",{staticClass:"searchBtnMarginTop",attrs:{lg:2,md:3}},[a("aui-button",{attrs:{type:"primary",size:"mini",icon:"aui-icon-search"},on:{click:e.query}},[e._v("查询")])],1),e._v(" "),a("aui-col",{staticClass:"searchBtnMarginTop",attrs:{lg:2,md:3}},[a("aui-button",{attrs:{type:"warning",size:"mini",icon:"aui-icon-refresh"},on:{click:function(t){e.resetForm("QueryForm")}}},[e._v("重置")])],1)],1)],1)],1),e._v(" "),a("aui-card",{staticStyle:{"margin-top":"10px"}},[a("aui-row",[a("aui-col",{attrs:{lg:2,md:3}},[e.btnPermission("Button_Menu_Add")?a("aui-button",{attrs:{type:"primary",icon:"aui-icon-plus",disabled:e.isDisabledDel,size:"mini"},on:{click:e.clickAdd}},[e._v("新增")]):e._e()],1),e._v(" "),a("aui-col",{attrs:{lg:2,md:3}},[e.btnPermission("Button_Menu_Add")?a("aui-button",{attrs:{type:"primary",icon:"aui-icon-edit",disabled:!e.isDisabledDel,size:"mini"},on:{click:function(t){e.checkPermission("1")}}},[e._v("修改")]):e._e()],1),e._v(" "),a("aui-col",{attrs:{lg:2,md:3}},[e.btnPermission("Button_Menu_Edit")?a("aui-button",{attrs:{type:"danger",icon:"aui-icon-delete",disabled:!e.isDisabledDel,size:"mini"},on:{click:function(t){e.checkPermission()}}},[e._v("删除")]):e._e()],1)],1),e._v(" "),a("aui-table",{ref:"orgParamList",staticClass:"tableMarginTop",staticStyle:{"min-height":"390px"},attrs:{data:e.orgParamList,border:"","header-row-class-name":"tableHeaderClass"},on:{"selection-change":e.selectList}},[a("aui-table-column",{attrs:{type:"selection",width:"40px"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"Brno",formatter:e.dataFormat,label:"机构编号","min-width":"247px"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"RuleId",label:"规则ID","min-width":"107px"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"RuleName",label:"规则名称","min-width":"107px"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"RuleTp",formatter:e.dataFormat,label:"规则类型","min-width":"107px"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"Descr",label:"描述","min-width":"107px"}})],1),e._v(" "),a("div",{staticStyle:{"text-align":"right","margin-top":"10px"}},[a("aui-pagination",{attrs:{background:"","current-page":e.currentPage,"page-size":10,layout:"total, prev, pager, next, jumper",total:e.total},on:{"current-change":e.handleCurrentChange}})],1)],1)],1),e._v(" "),a("keep-alive",[a(e.dialogList.ruleDefineAdd,{tag:"component",attrs:{option:e.dialogOptions},on:{refreshTable:e.query}})],1)],1)},staticRenderFns:[]};var w=a("/Xao")(v,y,!1,function(e){a("OS1i")},"data-v-e2bc31d6",null);t.default=w.exports},x6hd:function(e,t,a){(e.exports=a("BkJT")(!1)).push([e.i,"",""])}});