webpackJsonp([60],{O4nf:function(a,t,e){(a.exports=e("BkJT")(!1)).push([a.i,"",""])},Po3F:function(a,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=e("0oES"),r=e("syAl"),o=e("AA3o"),s=e.n(o),n=function a(){s()(this,a),this.data={OperType:""},this.CommCode="SSCardManage",this.SceneCode="CardtypeManage",this.TransServiceCode="mg-afaservices-stm/cardTypeManage"},l=e("fCv1"),d=e("Zqsi"),c=function a(){s()(this,a),this.data={OperType:""},this.BusiDataKey="SelCardCertTyp",this.TransServiceCode="ib-dbcomm/dbComm"},u=e("pADA"),p={props:{option:Object},data:function(){return{loading:!1,disabled:!1,fileList:[],fileSize:2,fileUploadUrl:"",absFilePath:"",afaToJSUploadFilePath:"",uploadData:{},upLoadType:["jpg","png","bmp","jpeg"],cardStatusList:[{value:"0",label:"0-停用"},{value:"1",label:"1-启用"}],cardTypeIdList:[],imageUrl:"",OrgNo:"",form:{cardTypeId:"",cardDesc:"",cardStatus:"",fileId:"",fileName:""},rules:{file:[{trigger:"blur",validator:this.picVali}],cardTypeId:[{required:!0,message:"请输入卡种类",trigger:"change"}],cardStatus:[{required:!0,message:"请输入状态",trigger:"change"}],cardDesc:[{required:!0,message:"请输入卡种介绍",trigger:"blur"},{require:!1,validator:Object(l.h)(60),trigger:"blur"}]}}},created:function(){var a=this;this.$nextTick(function(){a.fileUploadUrl=r.a.get("uploadFileToABSAddress"),a.absFilePath=r.a.get("absFilePath"),a.afaToJSUploadFilePath=r.a.get("afaToJSUploadFilePath"),a.uploadData.destDir=a.absFilePath})},watch:{},methods:{openUpdate:function(){this.loadCardType(),"2"==this.option.mark?this.setData():this.$refs.form&&(this.imageUrl="",this.form.cardTypeId="",this.form.cardDesc="",this.form.cardStatus="",this.fileList=[],this.$refs.form.clearValidate())},setData:function(){if(this.form.cardTypeId=this.option.currentRow.CardType,this.form.cardDesc=this.option.currentRow.CardDesc,this.imageUrl=this.option.currentRow.CardPicPath,this.form.cardStatus=this.option.currentRow.CardStatus,this.option.currentRow.CardPicPath){var a={};a.name=this.option.currentRow.CardPicPath,this.fileList.push(a)}},loadCardType:function(){var a=this,t=new c;t.data.ORG_NO=this.option.branchNum,t.data.Current_DT=u.a.getDateTime("date"),Object(i.a)(t).then(function(t){a.cardTypeIdList=t.RspInfo.Result||[]}).catch(function(t){a.loading=!1})},cardTypeChange:function(){this.uploadData.destDir=this.uploadData.destDir,this.afaToJSUploadFilePath=this.afaToJSUploadFilePath},picVali:function(a,t,e){""==this.imageUrl?e("请选择上传图片"):e()},handleBeforeUpload:function(a){var t=!1;this.$refs.form.validateField("cardTypeId",function(a){a||(t=!0)});var e=a.name.substring(a.name.lastIndexOf(".")+1),i=a.size/1024/1024<this.fileSize,r=-1==this.upLoadType.indexOf(e);return r&&this.$aui.message.show.error("上传文件格式错误"),i||this.$aui.message.show.error("上传文件大小不能超过"+this.fileSize+"M"),t&&!r&&i},handleRemove:function(a,t){this.imageUrl="",this.$aui.message.show.error("上传失败")},onExceed:function(){this.$aui.message.show.error("文件最大上传个数:1")},submitUpload:function(){this.$refs.upload.submit()},handleSuccess:function(a,t,e){var r=this;this.imageUrl=t.name,this.loading=!0;var o=new d.a;o.OpType="1",o.FileNm=this.uploadData.destDir+t.name,o.FileNm1=this.afaToJSUploadFilePath,o.Wher="0",o.data.FILE_NAME=t.name,o.data.SysCode="SYS_MG_01",o.data.FILE_UPLOAD_PATH=this.afaToJSUploadFilePath,Object(i.a)(o).then(function(a){r.loading=!1,r.form.fileName=t.name,r.form.fileId=a.RspInfo.FILE_ID,r.$aui.message.show({type:"success",message:"上传成功！文件编号："+r.form.fileId})}).catch(function(a){r.loading=!1,r.fileList=[],r.imageUrl="",r.$aui.message.show({type:"error",message:"上传失败!"+a.SYS_HEAD.ReturnMessage}),console.log(a)})},confirm:function(){var a=this;this.$refs.form.validate(function(t){if(t){a.loading=!0;var e=new n;"1"==a.option.mark?e.data.OperType="A":e.data.OperType="U",e.data.OrgNo=a.option.branchNum,e.data.CardType=a.form.cardTypeId,e.data.CardPicPath=a.imageUrl,e.data.CardDesc=a.form.cardDesc,e.data.CardStatus=a.form.cardStatus,e.data.FileId=a.form.fileId,Object(i.a)(e).then(function(t){a.$emit("refreshTable"),a.option.isShow=!1;var e="1"==a.option.mark?"创建成功":"修改成功";a.$aui.message.show({type:"success",message:e+"!"}),a.loading=!1}).catch(function(t){a.$aui.message.show({type:"warning",message:t.SYS_HEAD.ReturnMessage+"!"}),a.loading=!1})}})},closeUpdate:function(){this.disabled=!1,this.fileList=[],this.$refs.form.resetFields(),this.$refs.form.clearValidate()}}},h={render:function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("div",[e("aui-dialog",{attrs:{title:a.option.title,visible:a.option.isShow,width:"800px","close-on-click-modal":!1},on:{"update:visible":function(t){a.$set(a.option,"isShow",t)},show:a.openUpdate,hide:a.closeUpdate}},[e("div",{directives:[{name:"loading",rawName:"v-loading",value:a.loading,expression:"loading"}]},[e("aui-card",[e("aui-form",{ref:"form",attrs:{model:a.form,size:"mini",rules:a.rules,"label-width":"140px","label-position":"top"}},[e("aui-row",{attrs:{gutter:40}},[e("aui-col",{attrs:{span:12}},[e("aui-form-item",{attrs:{label:"卡种类",prop:"cardTypeId"}},[e("aui-select",{attrs:{filterable:"",placeholder:"请选择卡种类",disabled:a.option.isDisabled},on:{change:a.cardTypeChange},model:{value:a.form.cardTypeId,callback:function(t){a.$set(a.form,"cardTypeId",t)},expression:"form.cardTypeId"}},a._l(a.option.cardTypeIdList,function(a){return e("aui-option",{key:a.CERT_TYP,attrs:{label:a.CERT_TYP+"-"+a.CERT_MNAME,value:a.CERT_TYP,disabled:a.disabled}})}))],1)],1),a._v(" "),e("aui-col",{attrs:{span:12}},[e("aui-form-item",{attrs:{label:"是否启用:",prop:"cardStatus"}},[e("aui-select",{attrs:{placeholder:"请选择是否启用"},model:{value:a.form.cardStatus,callback:function(t){a.$set(a.form,"cardStatus",t)},expression:"form.cardStatus"}},a._l(a.cardStatusList,function(a){return e("aui-option",{key:a.value,attrs:{label:a.label,value:a.value}})}))],1)],1)],1),a._v(" "),e("aui-row",{attrs:{gutter:40}},[e("aui-col",{attrs:{span:24}},[e("aui-form-item",{attrs:{label:"卡种介绍:",prop:"cardDesc"}},[e("aui-input",{attrs:{type:"textarea",rows:4,resize:"none"},model:{value:a.form.cardDesc,callback:function(t){a.$set(a.form,"cardDesc",t)},expression:"form.cardDesc"}})],1)],1)],1),a._v(" "),e("aui-row",{attrs:{gutter:40}},[e("aui-col",{attrs:{span:20}},[e("aui-form-item",{attrs:{label:"卡种正面图",prop:"file"}},[e("aui-upload",{ref:"upload",staticClass:"upload-demo",attrs:{action:a.fileUploadUrl,limit:1,"auto-upload":!1,data:a.uploadData,"before-upload":a.handleBeforeUpload,"on-error":a.handleRemove,"on-success":a.handleSuccess,"file-list":a.fileList,accept:".jpg, .png, .bmp, .jpeg"}},[e("aui-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[a._v("选取文件")]),a._v(" "),e("aui-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"small",type:"success"},on:{click:a.submitUpload}},[a._v("上传到服务器")]),a._v(" "),e("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[a._v(a._s("最佳尺寸:212*133像素，支持.jpg,.jpeg,.png,.bmp格式文件，文件大小不超过"+a.fileSize+"M"))])],1)],1)],1)],1)],1)],1),a._v(" "),e("aui-row",{staticStyle:{margin:"20px 0","text-align":"right"}},[e("aui-button",{attrs:{size:"mini"},on:{click:function(t){a.option.isShow=!1}}},[a._v("返回")]),a._v(" "),e("aui-button",{attrs:{type:"primary",size:"mini"},on:{click:a.confirm}},[a._v("确定")])],1)],1)])],1)},staticRenderFns:[]};var g=e("/Xao")(p,h,!1,function(a){e("c3g6")},null,null).exports,m=e("tzsN"),f=e("0VOF"),b=e("QUZ0"),y={components:{selectTree:m.a},data:function(){return{currentRow:[],QueryForm:{branchNum:[]},brnoList:[],cardTypeIdList:[],branchNum:[],stateMap:{},total:void 0,cardTypeList:[],brnoMap:{},permission:{},loading:!1,isDisabledDel:!1,isDisabledUpd:!1,dialogVisible:!1,loadingImg:!0,loadingImgError:!1,dialogImageUrl:"",dialogList:{dialogAdd:g},dialogOptions:{isShow:!1},currentPage:1,pageSize:void 0,rules:{branchNum:[{required:!0,message:"请选择机构编号",trigger:"change"}]},absFilePath:"",viewFileAddress:"",afaToJSDownloadFilePath:""}},created:function(){var a=this;this.pageSize=r.a.get("PageSize"),this.stateMap=r.a.get("state"),this.queryBranchNum(),this.$nextTick(function(){a.absFilePath=r.a.get("absDownFilePath"),a.viewFileAddress=r.a.get("viewFileAddress"),a.afaToJSDownloadFilePath=r.a.get("afaToJSDownloadFilePath")})},computed:{},methods:{queryBranchNum:function(){var a=this;this.loading=!0;var t=new f.a;t.data.orgno=this.$store.getters.BranchNum,Object(i.a)(t).then(function(t){a.loading=!1,a.branchNum=t.RspInfo.Result||[],a.brnoMap=t.RspInfo.orgMap||{},a.permission=u.a.objArray2Hash(a.branchNum,"orgno"),a.brnoList=u.a.formatTreeData(a.branchNum,"orgno","superno"),a.QueryForm.branchNum.push(a.brnoList[0].orgno)}).catch(function(t){a.loading=!1,a.$aui.message.show({type:"warning",message:t.SYS_HEAD.ReturnMessage}),console.error("查询错误",t)})},loadCardType:function(){var a=this,t=new c;t.data.ORG_NO=this.QueryForm.branchNum[0],t.data.Current_DT=u.a.getDateTime("date"),Object(i.a)(t).then(function(t){a.cardTypeIdList=t.RspInfo.Result||[]}).catch(function(t){a.loading=!1})},dataFormat:function(a,t){if("OrgNo"==t.property)return a[t.property]+"-"+this.brnoMap[a[t.property]];if("CardStatus"==t.property)return this.stateMap[a[t.property]]||"";if("CardType"==t.property)for(var e=0;e<this.cardTypeIdList.length;e++){var i=this.cardTypeIdList[e];if(i.CERT_TYP==a[t.property])return i.CERT_TYP+"-"+i.CERT_MNAME}},clickAdd:function(){this.dialogOptions.isShow=!0,this.dialogOptions.title="新增卡种信息",this.dialogOptions.mark="1",this.dialogOptions.isDisabled=!1,this.dialogOptions.branchNum=this.QueryForm.branchNum[0],this.dialogOptions.cardTypeIdList=this.cardTypeIdList},clickUpdate:function(){this.dialogOptions.isShow=!0,this.dialogOptions.title="修改卡种信息",this.dialogOptions.mark="2",this.dialogOptions.isDisabled=!0,this.dialogOptions.currentRow=this.currentRow,this.dialogOptions.branchNum=this.currentRow.OrgNo,this.dialogOptions.cardTypeIdList=this.cardTypeIdList},checkPermission:function(a){var t=this;"1"==a?this.$aui.confirm.show("是否修改该卡种参数?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.clickUpdate()}).catch(function(){t.$aui.message.show({type:"info",message:"已取消修改"})}):this.delCardType()},resetForm:function(){this.cardTypeList=[],this.$refs.QueryForm.resetFields()},delCardType:function(){var a=this;this.$aui.confirm.show("此操作将永久删除该卡种参数, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){a.cardTypeDel()}).catch(function(){a.$aui.message.show({type:"info",message:"已取消删除"})})},cardTypeDel:function(){var a=this;this.loading=!0;var t=new n;t.data.OperType="D",t.data.OrgNo=this.currentRow.OrgNo,t.data.CardType=this.currentRow.CardType,Object(i.a)(t).then(function(t){a.loading=!1,a.$aui.message.show({type:"success",message:"删除成功！"}),a.query()}).catch(function(t){a.$aui.message.show({type:"warning",message:t.SYS_HEAD.ReturnMessage}),a.loading=!1,console.log(t)})},query:function(){var a=this;this.loadCardType(),this.$refs.QueryForm.validate(function(t){if(t){a.loading=!0;var e=new n;e.data.OperType="Q",e.data.OrgNo=a.QueryForm.branchNum[0],e.data.PageNum=a.pageSize+"",e.data.Page=a.currentPage+"",Object(i.a)(e).then(function(t){a.loading=!1,a.cardTypeList=t.RspInfo.Result||[],a.total=t.RspInfo.TotalRcdCount||0,a.total&&0!==a.total||(a.$aui.message.show({type:"warning",message:"没有满足条件得记录!"}),a.cardTypeList=[])}).catch(function(t){a.loading=!1,a.$aui.message.show({type:"warning",message:"错误信息："+t.SYS_HEAD.ReturnMessage}),a.cardTypeList=[]})}})},handleCurrentChange:function(a){this.currentPage=a,this.query()},selectList:function(a){1==a.length?(this.currentRow=a[0],this.isDisabledUpd=!0,"1"==a[0].CardStatus?this.isDisabledDel=!1:this.isDisabledDel=!0):a.length>1?this.$refs.cardTypeList.toggleRowSelection(a[0]):(this.isDisabledUpd=!1,this.isDisabledDel=!1)},dialogDetail:function(a){var t=this;this.dialogVisible=!0,this.loadingImgError=!1,this.loadingImg=!0,this.loading=!0;var e=new b.a;e.OpType="0",e.FileNm=this.absFilePath,e.FileNm1=this.afaToJSDownloadFilePath,e.data.FILE_ID=a.row.FileId,e.data.FILE_NAME=a.row.CardPicPath,e.data.SysCode="SYS_MG_01",Object(i.a)(e).then(function(a){t.loading=!1;var e=a.RspInfo.fileDownPath;e=e.substring(e.lastIndexOf("/")+1,e.length),t.dialogImageUrl=t.viewFileAddress+e}).catch(function(a){t.loading=!1,t.loadingImgError=!0,t.$aui.message.show({type:"warning",message:a.SYS_HEAD.ReturnMessage}),console.log(a)})},dialogDetailClose:function(){this.dialogImageUrl=""},loadingImgFalse:function(){this.loadingImg=!1,this.loadingImgError=!0}}},v={render:function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("div",[e("div",{directives:[{name:"loading",rawName:"v-loading",value:a.loading,expression:"loading"}],attrs:{"element-loading-text":"加载中。。。"}},[e("aui-card",[e("aui-form",{ref:"QueryForm",attrs:{model:a.QueryForm,rules:a.rules,size:"mini","label-position":"top"}},[e("aui-row",{attrs:{gutter:10}},[e("aui-col",{attrs:{lg:4,md:6}},[e("aui-form-item",{attrs:{label:"机构编号",prop:"branchNum"}},[e("select-tree",{staticStyle:{width:"170px"},attrs:{"single-check":!0,props:{id:"orgno",label:"cname",children:"children"},"tree-data":a.brnoList,placeholder:"请选择机构"},model:{value:a.QueryForm.branchNum,callback:function(t){a.$set(a.QueryForm,"branchNum",t)},expression:"QueryForm.branchNum"}})],1)],1),a._v(" "),e("aui-col",{staticClass:"searchBtnMarginTop",attrs:{lg:2,md:3}},[e("aui-button",{attrs:{type:"primary",size:"mini",icon:"aui-icon-search"},on:{click:a.query}},[a._v("查询")])],1),a._v(" "),e("aui-col",{staticClass:"searchBtnMarginTop",attrs:{lg:2,md:3}},[e("aui-button",{attrs:{type:"warning",size:"mini",icon:"aui-icon-refresh"},on:{click:function(t){a.resetForm("QueryForm")}}},[a._v("重置")])],1)],1)],1)],1),a._v(" "),e("aui-card",{staticStyle:{"margin-top":"10px"}},[e("aui-row",[e("aui-col",{attrs:{lg:2,md:3}},[e("aui-button",{attrs:{type:"primary",size:"mini",disabled:a.isDisabledUpd,icon:"aui-icon-plus"},on:{click:a.clickAdd}},[a._v("新增")])],1),a._v(" "),e("aui-col",{attrs:{lg:2,md:3}},[e("aui-button",{attrs:{type:"primary",disabled:!a.isDisabledUpd,size:"mini",icon:"aui-icon-edit"},on:{click:function(t){a.checkPermission("1")}}},[a._v("修改")])],1),a._v(" "),e("aui-col",{attrs:{lg:2,md:3}},[e("aui-button",{attrs:{type:"danger",disabled:!a.isDisabledDel,size:"mini",icon:"aui-icon-delete"},on:{click:function(t){a.checkPermission()}}},[a._v("删除")])],1)],1),a._v(" "),e("aui-table",{ref:"cardTypeList",staticClass:"tableMarginTop",staticStyle:{"min-height":"390px"},attrs:{data:a.cardTypeList,border:"","header-row-class-name":"tableHeaderClass"},on:{"selection-change":a.selectList}},[e("aui-table-column",{attrs:{type:"selection",width:"40px"}}),a._v(" "),e("aui-table-column",{attrs:{prop:"OrgNo",formatter:a.dataFormat,label:"机构编号","min-width":"247px"}}),a._v(" "),e("aui-table-column",{attrs:{prop:"CardType",label:"卡种类",formatter:a.dataFormat,"min-width":"147px"}}),a._v(" "),e("aui-table-column",{attrs:{prop:"CardDesc",label:"卡种介绍","min-width":"137px"}}),a._v(" "),e("aui-table-column",{attrs:{prop:"CardStatus",formatter:a.dataFormat,label:"状态","min-width":"107px"}}),a._v(" "),e("aui-table-column",{attrs:{prop:"CardPicPath",label:"图片路径","min-width":"107px"}}),a._v(" "),e("aui-table-column",{attrs:{prop:"FileId",label:"文件编号","min-width":"107px"}}),a._v(" "),e("aui-table-column",{attrs:{label:"预览",align:"center",fixed:"right",width:"80"},scopedSlots:a._u([{key:"default",fn:function(t){return[e("aui-button",{attrs:{type:"text",size:"mini"},on:{click:function(e){a.dialogDetail(t,a.cardTypeList)}}},[a._v("预览")])]}}])})],1),a._v(" "),e("div",{staticStyle:{"text-align":"right","margin-top":"10px"}},[e("aui-pagination",{attrs:{background:"","current-page":a.currentPage,"page-size":10,layout:"total, prev, pager, next, jumper",total:a.total},on:{"current-change":a.handleCurrentChange}})],1)],1)],1),a._v(" "),e("aui-dialog",{attrs:{visible:a.dialogVisible,"lock-scroll":!1},on:{"update:visible":function(t){a.dialogVisible=t},hide:a.dialogDetailClose}},[e("div",{directives:[{name:"loading",rawName:"v-loading",value:a.loadingImg,expression:"loadingImg"}],staticStyle:{"text-align":"center"}},[e("img",{staticStyle:{width:"100%","min-height":"340px",position:"relative"},attrs:{src:a.dialogImageUrl,alt:""},on:{load:function(t){a.loadingImg=!1},error:a.loadingImgFalse}})])]),a._v(" "),e("keep-alive",[e(a.dialogList.dialogAdd,{tag:"component",attrs:{option:a.dialogOptions},on:{refreshTable:a.query}})],1)],1)},staticRenderFns:[]};var T=e("/Xao")(y,v,!1,function(a){e("U1ea")},"data-v-59d26112",null);t.default=T.exports},U1ea:function(a,t,e){var i=e("O4nf");"string"==typeof i&&(i=[[a.i,i,""]]),i.locals&&(a.exports=i.locals);e("8bSs")("7cbe32f2",i,!0)},UaG1:function(a,t,e){(a.exports=e("BkJT")(!1)).push([a.i,"\n.ADupload.avatar-uploader .aui-upload {\n  border: 1px dashed #d9d9d9;\n  border-radius: 6px;\n  cursor: pointer;\n  position: relative;\n  overflow: hidden;\n}\n.ADupload.avatar-uploader .aui-upload:hover {\n    border-color: #409EFF;\n}\n.ADupload.avatar-uploader .aui-upload .avatar-uploader-icon {\n    font-size: 28px;\n    color: #8c939d;\n    width: 356px;\n    height: 216px;\n    line-height: 216px;\n    text-align: center;\n}\n.ADupload.avatar-uploader .aui-upload .avatar {\n    width: 356px;\n    height: 216px;\n    display: block;\n}\n",""])},c3g6:function(a,t,e){var i=e("UaG1");"string"==typeof i&&(i=[[a.i,i,""]]),i.locals&&(a.exports=i.locals);e("8bSs")("159ee043",i,!0)}});