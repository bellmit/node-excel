webpackJsonp([131],{"314q":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("tzsN"),r=a("pADA"),i=a("0oES"),o=a("syAl"),l=a("0VOF"),s=a("AA3o"),u=a.n(s),c=function e(){u()(this,e),this.data={BusiOper:"SelectAddCardLog"},this.BusiDataKey="SelectAddCardLog",this.TransServiceCode="ib-dbcomm/dbComm"},d=a("+V+J"),m={components:{selectTree:n.a},data:function(){return{vouList:"",filename:"加卡记录查询导出",options:{label:"label",checkbox:!0,checkedOpen:!0,folderBold:!0,idsWithParent:!0,depthOpen:2,openIcon:"aui-icon aui-icon-angle-right",closeIcon:"aui-icon aui-icon-angle-down",checkedIcon:"aui-icon aui-icon-fangxingxuanzhong",uncheckedIcon:"aui-icon aui-icon-fangxingweixuanzhong"},ids:null,pickerOptionsStart:{disabledDate:function(e){(new Date).getTime();return e.getTime()>Date.now()}},brnoList:[],formInline:{startdate:"",enddate:"",devNum:void 0,branchNum:[]},currentPage:1,loading:!1,tableData3:[],tableTotal:0}},created:function(){this.formInline.startdate=r.a.getNowTime(29),this.formInline.enddate=r.a.getNowTime(0),this.pageSize=o.a.get("PageSize"),this.vouTypeList(),this.initBrno()},watch:{formInline:{handler:function(e,t){this.currentPage=1},deep:!0}},methods:{vouTypeList:function(){var e=this,t=new d.a;Object(i.a)(t).then(function(t){console.log(t),e.vouList=t.RspInfo.Result||[]}).catch(function(e){})},dFormat:function(e,t){return r.a.timeFormat2Date(e[t.property])},tFormat:function(e,t){return r.a.timeFormat2Time(e[t.property])},dataFormat:function(e,t){if("cardtpcode"==t.property){for(var a=0;a<this.vouList.length;a++)if(e[t.property]==this.vouList[a].UKEY_KIND_CD)return e[t.property]+"-"+this.vouList[a].UKEY_NM;return e[t.property]}},dateChange:function(){this.formInline.startdate>this.formInline.enddate?(this.$aui.message.show({type:"warning",message:"开始日期不能大于结束日期"}),this.formInline.startdate=r.a.getNowTime(29),this.formInline.enddate=r.a.getNowTime(0)):this.formInline.startdate<r.a.getNowTime(365)&&(this.$aui.message.show({type:"warning",message:"开始日期不能超过当日前12个月"}),this.formInline.startdate=r.a.getNowTime(365))},initBrno:function(){var e=this;this.loading=!0;var t=new l.a;t.data.orgno=this.$store.getters.BranchNum,Object(i.a)(t).then(function(t){e.loading=!1,e.branchNum=t.RspInfo.Result||[],e.permission=r.a.objArray2Hash(e.branchNum,"orgno"),e.brnoMap=t.RspInfo.orgMap||{},e.brnoList=r.a.formatTreeData(e.branchNum,"orgno","superno"),e.formInline.branchNum.push(e.brnoList[0].orgno)}).catch(function(t){e.loading=!1,e.$aui.message.show({type:"warning",message:t.SYS_HEAD.ReturnMessage}),console.error("查询错误",t)})},handleSizeChange:function(e){console.log("每页 "+e+" 条")},handleCurrentChange:function(e){console.log("当前页: "+e),this.queryInfoList()},queryInfoList:function(){var e=this;this.$refs.formInline.validate(function(t){if(t){e.loading=!0;var a=new c;a.data.startdate=e.formInline.startdate,a.data.enddate=e.formInline.enddate,a.data.branchNum=e.formInline.branchNum[0],a.data.devNum=e.formInline.devNum,a.data.CurtPage=e.currentPage+"",a.data.PageSize=e.pageSize+"",a.data.StartRows=(e.currentPage-1)*e.pageSize+"",Object(i.a)(a).then(function(t){e.tableData3=t.RspInfo.Result||[],e.tableTotal=t.RspInfo.totalNum||0,e.loading=!1,"0"==e.tableTotal&&e.$aui.message.show({type:"warning",message:"无满足条件的记录"})}).catch(function(t){e.$aui.message.show({type:"error",message:"请求失败，错误码:"+t.SYS_HEAD.ReturnCode+"，错误信息："+t.SYS_HEAD.ReturnMessage}),e.loading=!1,e.tableData3=[],e.tableTotal=0,console.error("查询错误",t)})}})},getExcel:function(){var e=this;this.loading=!0;var t=new c;t.data.startdate=this.formInline.startdate,t.data.enddate=this.formInline.enddate,t.data.branchNum=this.formInline.branchNum[0],t.data.devNum=this.formInline.devNum,t.data.CurtPage="1",t.data.PageSize="50000000",t.data.StartRows="",Object(i.a)(t).then(function(t){e.loading=!1,e.list1=t.RspInfo.Result||[],e.handleDownload()}).catch(function(t){e.loading=!1,e.$aui.message.show({type:"warning",message:"请求失败，错误码:"+t.SYS_HEAD.ReturnCode+"，错误信息："+t.SYS_HEAD.ReturnMessage}),console.error("查询错误",t)})},handleDownload:function(){var e=this;a.e(169).then(a.bind(null,"FNRk")).then(function(t){var a=e.list1,n=e.formatJson(["busiserino","workdate","worktime","branchnum","branchname","devnum","cardboxno","cardtpcode","voucherbusitype","vchrserl","addcardnum","operater","remark"],a);t.export_json_to_excel({header:["业务流水号","加卡日期","加卡时间","机构号","机构名称","设备编号","卡箱号","凭证种类代码","冠字号","凭证号段","加卡数量","操作柜员号","备注"],data:n,filename:e.filename,autoWidth:e.autoWidth,bookType:e.bookType})})},formatJson:function(e,t){return t.map(function(t){return e.map(function(e){return"timestamp"===e?parseTime(t[e]):t[e]})})},resetForm:function(e){this.formInline.branchNum=[],this.$refs[e].resetFields()}}},p={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{"element-loading-text":"拼命加载中"}},[a("aui-card",{staticStyle:{"margin-bottom":"10px",overflow:"visible"}},[a("aui-form",{ref:"formInline",attrs:{model:e.formInline,"label-position":"top",size:"mini"}},[a("aui-row",{attrs:{gutter:10}},[a("aui-col",{attrs:{md:6,lg:4}},[a("aui-form-item",{attrs:{label:"机构",prop:"branchNum"}},[a("select-tree",{staticStyle:{width:"170px"},attrs:{"single-check":!0,props:{id:"orgno",label:"cname",children:"children"},"tree-data":e.brnoList,placeholder:"请选择机构"},model:{value:e.formInline.branchNum,callback:function(t){e.$set(e.formInline,"branchNum",t)},expression:"formInline.branchNum"}})],1)],1),e._v(" "),a("aui-col",{attrs:{md:6,lg:4}},[a("aui-form-item",{attrs:{label:"开始日期",prop:"startdate"}},[a("aui-date-picker",{attrs:{editable:!1,"picker-options":e.pickerOptionsStart,clearable:!1,"value-format":"yyyyMMdd",type:"date",placeholder:"选择日期"},on:{change:e.dateChange},model:{value:e.formInline.startdate,callback:function(t){e.$set(e.formInline,"startdate",t)},expression:"formInline.startdate"}})],1)],1),e._v(" "),a("aui-col",{attrs:{md:6,lg:4}},[a("aui-form-item",{attrs:{label:"结束日期",prop:"enddate"}},[a("aui-date-picker",{attrs:{editable:!1,"picker-options":e.pickerOptionsStart,clearable:!1,"value-format":"yyyyMMdd",type:"date",placeholder:"选择日期"},on:{change:e.dateChange},model:{value:e.formInline.enddate,callback:function(t){e.$set(e.formInline,"enddate",t)},expression:"formInline.enddate"}})],1)],1),e._v(" "),a("aui-col",{attrs:{md:6,lg:4}},[a("aui-form-item",{attrs:{label:"设备编号",prop:"devNum"}},[a("aui-input",{attrs:{placeholder:"请选择设备编号"},model:{value:e.formInline.devNum,callback:function(t){e.$set(e.formInline,"devNum",t)},expression:"formInline.devNum"}})],1)],1),e._v(" "),a("aui-col",{staticClass:"searchBtnMarginTop",attrs:{md:3,lg:2}},[a("aui-form-item",[a("aui-button",{attrs:{type:"primary",icon:"aui-icon-search"},on:{click:e.queryInfoList}},[e._v("查询")])],1)],1),e._v(" "),a("aui-col",{staticClass:"searchBtnMarginTop",attrs:{lg:2,md:3}},[a("aui-form-item",[a("aui-button",{attrs:{type:"warning",icon:"aui-icon-refresh"},on:{click:function(t){e.resetForm("formInline")}}},[e._v("重置")])],1)],1),e._v(" "),a("aui-col",{staticClass:"searchBtnMarginTop",attrs:{lg:2,md:3}},[a("aui-form-item",[e.btnPermission("Button_AddCardQue_Export")?a("aui-button",{attrs:{type:"primary",icon:"aui-icon-download"},on:{click:e.getExcel}},[e._v("导出")]):e._e()],1)],1)],1)],1)],1),e._v(" "),a("aui-card",[a("aui-table",{attrs:{data:e.tableData3,height:"390","header-row-class-name":"tableHeaderClass",border:""}},[a("aui-table-column",{attrs:{fixed:"",prop:"busiserino",label:"业务流水号",width:"130"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"workdate",label:"加卡日期",width:"100"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"worktime",label:"加卡时间",width:"80"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"branchnum",label:"机构号",width:"100"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"branchname",label:"机构名称",width:"100"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"devnum",label:"设备编号",width:"120"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"cardboxno",label:"卡箱号",width:"100"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"cardtpcode",formatter:e.dataFormat,label:"凭证种类代码",width:"120"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"voucherbusitype",label:"冠字号",width:"120"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"vchrserl",label:"凭证号段",width:"180"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"addcardnum",label:"加卡数量",width:"80"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"operater",label:"操作柜员",width:"120"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"remark",label:"备注","min-width":"150"}})],1),e._v(" "),a("aui-pagination",{staticStyle:{"text-align":"right","margin-top":"20px"},attrs:{"current-page":e.currentPage,background:"",layout:"total, prev, pager, next, jumper",total:e.tableTotal},on:{"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.currentPage=t}}})],1)],1)},staticRenderFns:[]};var h=a("/Xao")(m,p,!1,function(e){a("BUFA")},null,null);t.default=h.exports},BUFA:function(e,t,a){var n=a("q9aN");"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);a("8bSs")("394fc154",n,!0)},q9aN:function(e,t,a){(e.exports=a("BkJT")(!1)).push([e.i,"\n.aui-date-editor.aui-input,\n.aui-date-editor.el-input__inner {\n  width: 100%;\n}\n\n",""])}});