webpackJsonp([75],{JE7o:function(e,t,a){var i=a("jZFb");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);a("8bSs")("0d181efc",i,!0)},Qn9U:function(e,t,a){var i=a("Y5lR");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);a("8bSs")("82d6a366",i,!0)},Y5lR:function(e,t,a){(e.exports=a("BkJT")(!1)).push([e.i,"",""])},fZY7:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("tzsN"),o=a("syAl"),r=a("0oES"),s=a("pADA"),n=a("AA3o"),l=a.n(n),d=function e(){l()(this,e),this.data={dealType:"1",ORG_NO:"",QR_CD_PATH:"",LOGO_PICT_PATH:"",LOGO_PICT_NM:"",MATN_PERSON_EMPLY_ID:""},this.CommCode="CQParaManage",this.SceneCode="CRCodeManager",this.TransServiceCode="mg-afaservices-cq/tickCodeManage"},c=function e(){l()(this,e),this.data={dealType:"3",ORG_NO:"",QR_CD_PATH:"",LOGO_PICT_PATH:"",LOGO_PICT_NM:"",MATN_PERSON_EMPLY_ID:""},this.CommCode="CQParaManage",this.SceneCode="CRCodeManager",this.TransServiceCode="mg-afaservices-cq/tickCodeManage"},u=a("fCv1"),p=a("Zqsi"),m={components:{selectTree:i.a},props:{option:Object},data:function(){return{loading:!1,form:{brno:[],codeAddress:"",operTeller:"",operTellerName:"",fileId:"",fileName:""},imageUrl:"",pictureName:"",fileList:[],fileSize:100,fileUploadUrl:"",absFilePath:"",afaToJSUploadFilePath:"",uploadData:{},upLoadType:["jpg","png","bmp","jpeg"],rules:{codeAddress:[{required:!0,message:"请输入二维码地址",trigger:"blur"},{required:!0,validator:Object(u.h)(64),trigger:"blur"},{required:!0,validator:function(e,t,a){var i=new RegExp(/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- .\/?%&=]*)?/);t&&1==i.test(t)?a():a(new Error("输入地址格式不正确!"))},trigger:"blur"}]}}},created:function(){var e=this;this.$nextTick(function(){e.fileUploadUrl=o.a.get("uploadFileToABSAddress"),e.absFilePath=o.a.get("absFilePath"),e.afaToJSUploadFilePath=o.a.get("afaToJSUploadFilePath"),e.uploadData.destDir=e.absFilePath})},methods:{openUpdate:function(){var e=this;this.$nextTick(function(){"2"==e.option.mark?e.setData():(e.$refs.form&&e.$refs.form.clearValidate(),e.fileList=[],e.form.brno=e.$store.getters.BranchNum,e.form.operTeller=e.$store.getters.UserNum,e.form.operTellerName=e.$store.getters.UserName)})},setData:function(){if(this.form.brno=this.option.currentRow.ORG_NO,this.form.codeAddress=this.option.currentRow.QR_CD_PATH,this.form.operTeller=this.$store.getters.UserNum,this.form.operTellerName=this.$store.getters.UserName,this.form.fileId=this.option.currentRow.LOGO_PICT_PATH,this.pictureName=this.option.currentRow.LOGO_PICT_NM,this.option.currentRow.LOGO_PICT_NM){var e={};e.name=this.option.currentRow.LOGO_PICT_NM,this.fileList.push(e)}},closeUpdete:function(){this.$refs.form.resetFields(),this.$refs.form.clearValidate(),this.imageUrl="",this.pictureName="",this.fileList=[]},handleBeforeUpload:function(e){var t=e.name.substring(e.name.lastIndexOf(".")+1),a=e.size/1024<this.fileSize+1,i=-1==this.upLoadType.indexOf(t);return i&&this.$aui.message.show.error("上传文件格式错误"),a||this.$aui.message.show.error("上传文件大小不能超过"+this.fileSize+"KB"),!i&&a},handleRemove:function(e,t){this.imageUrl="",this.$aui.message.show.error("上传失败")},onExceed:function(){this.$aui.message.show.error("文件最大上传个数:1")},submitUpload:function(){this.$refs.upload.submit()},handleSuccess:function(e,t,a){var i=this;this.pictureName=t.name,this.imageUrl=t.name,this.loading=!0;var o=new p.a;o.OpType="1",o.FileNm=this.uploadData.destDir+t.name,o.FileNm1=this.afaToJSUploadFilePath,o.Wher="0",o.data.FILE_NAME=t.name,o.data.SysCode="SYS_MG_01",o.data.FILE_UPLOAD_PATH=this.afaToJSUploadFilePath,Object(r.a)(o).then(function(e){i.loading=!1,i.form.fileName=t.name,i.form.fileId=e.RspInfo.FILE_ID,i.$aui.message.show({type:"success",message:"上传成功！文件编号："+i.form.fileId})}).catch(function(e){i.loading=!1,i.fileList=[],i.imageUrl="",i.$aui.message.show({type:"error",message:"上传失败!"+e.SYS_HEAD.ReturnMessage}),console.log(e)})},picVali:function(e,t,a){""==this.imageUrl?a("请选择上传logo"):a()},ItemUpdate:function(){var e=this;this.$refs.form.validate(function(t){if(!t)return e.$aui.message.show({type:"warning",message:"请输入合法的数据！"}),!1;e.loading=!0;var a="1"==e.option.mark?new d:new c;a.data.ORG_NO=e.form.brno,a.data.QR_CD_PATH=e.form.codeAddress,a.data.MATN_PERSON_EMPLY_ID=e.form.operTeller,""==e.pictureName?(a.data.LOGO_PICT_PATH="",a.data.LOGO_PICT_NM=""):(a.data.LOGO_PICT_PATH=e.form.fileId,a.data.LOGO_PICT_NM=e.pictureName),Object(r.a)(a).then(function(t){e.loading=!1;var a="1"==e.option.mark?"创建":"修改";e.$aui.message.show({type:"success",message:""+a+t.SYS_HEAD.ReturnMessage+"!"}),e.option.isShow=!1,e.$emit("refreshTable")}).catch(function(t){e.$aui.message.show({type:"warning",message:t.SYS_HEAD.ReturnMessage+"!"}),e.loading=!1})})}}},g={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("aui-dialog",{attrs:{title:e.option.title,visible:e.option.isShow,width:"800px","close-on-click-modal":!1},on:{"update:visible":function(t){e.$set(e.option,"isShow",t)},show:e.openUpdate,hide:e.closeUpdete}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[a("aui-card",[a("aui-form",{ref:"form",attrs:{model:e.form,size:"mini",rules:e.rules,"label-width":"120px","label-position":"right"}},[a("aui-row",{attrs:{gutter:40}},[a("aui-col",{attrs:{span:12}},[a("aui-form-item",{attrs:{label:"机构号:",prop:"brno"}},[a("select-tree",{staticStyle:{width:"170px"},attrs:{"single-check":!0,props:{id:"orgno",label:"cname",children:"children"},"tree-data":e.option.branchNum,disabled:""},model:{value:e.form.brno,callback:function(t){e.$set(e.form,"brno",t)},expression:"form.brno"}})],1)],1)],1),e._v(" "),a("aui-row",{attrs:{gutter:40}},[a("aui-col",{attrs:{span:24}},[a("aui-form-item",{attrs:{label:"二维码地址:",prop:"codeAddress"}},[a("aui-input",{attrs:{placeholder:"请输入二维码地址"},model:{value:e.form.codeAddress,callback:function(t){e.$set(e.form,"codeAddress",t)},expression:"form.codeAddress"}})],1)],1)],1),e._v(" "),a("aui-row",{attrs:{gutter:40}},[a("aui-col",{attrs:{span:20}},[a("aui-form-item",{attrs:{label:"小票logo上传",prop:"file"}},[a("aui-upload",{ref:"upload",staticClass:"upload-demo",attrs:{action:e.fileUploadUrl,data:e.uploadData,"before-upload":e.handleBeforeUpload,"on-error":e.handleRemove,"on-success":e.handleSuccess,limit:1,"file-list":e.fileList,"auto-upload":!1,"on-exceed":e.onExceed,accept:".jpg, .png, .bmp, .jpeg"}},[a("aui-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v("选取文件")]),e._v(" "),a("aui-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"small",type:"success"},on:{click:e.submitUpload}},[e._v("上传到服务器")]),e._v(" "),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v(e._s("支持.jpg,.jpeg,.png,.bmp格式文件，且大小不超过"+e.fileSize+"KB"))])],1)],1)],1)],1),e._v(" "),a("aui-row",{attrs:{gutter:40}},[a("aui-col",{attrs:{span:12}},[a("aui-form-item",{attrs:{label:"维护柜员:",prop:"operTeller"}},[a("aui-input",{attrs:{disabled:""},model:{value:e.form.operTeller,callback:function(t){e.$set(e.form,"operTeller",t)},expression:"form.operTeller"}})],1)],1),e._v(" "),a("aui-col",{attrs:{span:12}},[a("aui-form-item",{attrs:{label:"维护柜员名称:",prop:"operTellerName"}},[a("aui-input",{attrs:{disabled:""},model:{value:e.form.operTellerName,callback:function(t){e.$set(e.form,"operTellerName",t)},expression:"form.operTellerName"}})],1)],1)],1)],1)],1),e._v(" "),a("aui-row",{staticStyle:{margin:"20px 0","text-align":"center"}},[a("aui-button",{attrs:{size:"mini"},on:{click:function(t){e.option.isShow=!1}}},[e._v("返回")]),e._v(" "),a("aui-button",{attrs:{type:"primary",size:"mini"},on:{click:e.ItemUpdate}},[e._v("确定")])],1)],1)])],1)},staticRenderFns:[]};var h=a("/Xao")(m,g,!1,function(e){a("JE7o")},null,null).exports,f=a("0VOF"),b=function e(){l()(this,e),this.data={org_no:"",currpage:"",pagenum:""},this.CommCode="CQParaManage",this.SceneCode="CRCodeQuery",this.TransServiceCode="mg-afaservices-cq/tickCodeQuery"},_=function e(){l()(this,e),this.data={dealType:"2",ORG_NO:""},this.CommCode="CQParaManage",this.SceneCode="CRCodeManager",this.TransServiceCode="mg-afaservices-cq/tickCodeManage"},v=a("QUZ0"),w={name:"ticketQRCode",components:{selectTree:i.a},data:function(){return{QueryForm:{branchNum:[]},dialogList:{dialogAdd:h},dialogOptions:{isShow:!1},brnoList:[],ticketCodeList:[],permission:{},currentRow:[],loading:!1,isDisabledDel:!1,total:0,pageSize:void 0,currentPage:1,rules:{branchNum:[{required:!0,message:"请选择机构号",trigger:"change"}]},dialogVisible:!1,loadingImg:!0,loadingImgError:!1,dialogImageUrl:"",absFilePath:"",viewFileAddress:"",afaToJSDownloadFilePath:""}},created:function(){var e=this;this.pageSize=o.a.get("PageSize"),this.queryBranchNum(),this.$nextTick(function(){e.absFilePath=o.a.get("absDownFilePath"),e.viewFileAddress=o.a.get("viewFileAddress"),e.afaToJSDownloadFilePath=o.a.get("afaToJSDownloadFilePath")})},methods:{queryBranchNum:function(){var e=this;this.loading=!0;var t=new f.a;t.data.orgno=this.$store.getters.BranchNum,Object(r.a)(t).then(function(t){e.loading=!1,e.branchNum=t.RspInfo.Result||[],e.brnoMap=t.RspInfo.orgMap||{},e.permission=s.a.objArray2Hash(e.branchNum,"orgno"),e.brnoList=s.a.formatTreeData(e.branchNum,"orgno","superno"),e.QueryForm.branchNum.push(e.brnoList[0].orgno)}).catch(function(t){e.loading=!1,e.$aui.message.show({type:"warning",message:t.SYS_HEAD.ReturnMessage}),console.error("查询错误",t)})},handleCurrentChange:function(e){this.currentPage=e,this.query()},resetForm:function(){this.ticketCodeList=[],this.total=0,this.currentPage=1,this.$refs.QueryForm.resetFields()},dialogDetail:function(e){var t=this;this.dialogVisible=!0,this.loadingImgError=!1,this.loadingImg=!0,this.loading=!0;var a=new v.a;a.OpType="0",a.FileNm=this.absFilePath,a.FileNm1=this.afaToJSDownloadFilePath,a.data.FILE_ID=e.row.LOGO_PICT_PATH,a.data.FILE_NAME=e.row.LOGO_PICT_NM,a.data.SysCode="SYS_MG_01",Object(r.a)(a).then(function(e){t.loading=!1;var a=e.RspInfo.fileDownPath;a=a.substring(a.lastIndexOf("/")+1,a.length),t.dialogImageUrl=t.viewFileAddress+a}).catch(function(e){t.loading=!1,t.loadingImgError=!0,t.$aui.message.show({type:"warning",message:e.SYS_HEAD.ReturnMessage}),console.log(e)})},dialogDetailClose:function(){this.dialogImageUrl=""},loadingImgFalse:function(){this.loadingImg=!1,this.loadingImgError=!0},query:function(){var e=this;this.$refs.QueryForm.validate(function(t){if(t){e.loading=!0;var a=new b;a.data.org_no=e.QueryForm.branchNum[0],a.data.DEAL_TYPE="1",a.data.pagenum=e.pageSize+"",a.data.currpage=e.currentPage+"",Object(r.a)(a).then(function(t){e.loading=!1,console.log(t),e.ticketCodeList=t.RspInfo.crcodelist||[],e.total=t.RspInfo.TotalRowNum||0,e.total&&0!==e.total||e.$aui.message.show({type:"warning",message:"没有满足条件的记录!"})}).catch(function(t){e.ticketCodeList=[],e.total=0,e.loading=!1,e.$aui.message.show({type:"warning",message:"请求失败，错误码:"+t.SYS_HEAD.ReturnCode+"，错误信息："+t.SYS_HEAD.ReturnMessage})})}})},dataFormat:function(e,t){if("ORG_NO"==t.property)return e[t.property]+"-"+this.brnoMap[e[t.property]]},selectList:function(e){1==e.length?(this.isDisabledDel=!0,this.currentRow=e[0]):e.length>1?this.$refs.ticketCodeList.toggleRowSelection(e[0]):this.isDisabledDel=!1},clickAdd:function(){this.dialogOptions.isShow=!0,this.dialogOptions.title="新增小票二维码logo",this.dialogOptions.mark="1",this.dialogOptions.branchNum=this.brnoList},checkPermission:function(e){this.permission[this.currentRow.Brno]?e?this.clickUpdate():this.delBut():this.$aui.message.show({type:"warning",message:"权限不足,无法修改！"})},clickUpdate:function(){this.dialogOptions.isShow=!0,this.dialogOptions.title="修改小票二维码logo",this.dialogOptions.mark="2",this.dialogOptions.currentRow=this.currentRow,this.dialogOptions.branchNum=this.brnoList},delBut:function(){var e=this;this.$aui.confirm.show("此操作将删除小票二维码logo, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.orgQueueDel()}).catch(function(){e.$aui.message.show({type:"info",message:"已取消删除"})})},orgQueueDel:function(){var e=this;this.loading=!0;var t=new _;t.data.ORG_NO=this.currentRow.ORG_NO,Object(r.a)(t).then(function(t){e.loading=!1,e.$aui.message.show({type:"success",message:"删除成功！"}),e.currentPage=1,e.query()}).catch(function(t){e.loading=!1,e.$aui.message.show({type:"warning",message:t.SYS_HEAD.ReturnMessage})})}}},T={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{"element-loading-text":"加载中。。。"}},[a("aui-card",[a("aui-form",{ref:"QueryForm",attrs:{model:e.QueryForm,rules:e.rules,size:"mini","label-position":"top"}},[a("aui-row",{attrs:{gutter:10}},[a("aui-col",{attrs:{lg:4,md:6}},[a("aui-form-item",{attrs:{label:"机构号",prop:"branchNum"}},[a("select-tree",{staticStyle:{width:"170px"},attrs:{"single-check":!0,props:{id:"orgno",label:"cname",children:"children"},"tree-data":e.brnoList,placeholder:"请选择机构"},model:{value:e.QueryForm.branchNum,callback:function(t){e.$set(e.QueryForm,"branchNum",t)},expression:"QueryForm.branchNum"}})],1)],1),e._v(" "),a("aui-col",{staticClass:"searchBtnMarginTop",attrs:{lg:2,md:3}},[a("aui-button",{attrs:{type:"primary",size:"mini",icon:"aui-icon-search"},on:{click:e.query}},[e._v("查询")])],1),e._v(" "),a("aui-col",{staticClass:"searchBtnMarginTop",attrs:{lg:2,md:3}},[a("aui-button",{attrs:{type:"warning",size:"mini",icon:"aui-icon-refresh"},on:{click:function(t){e.resetForm("QueryForm")}}},[e._v("重置")])],1)],1)],1)],1),e._v(" "),a("aui-card",{staticStyle:{"margin-top":"10px"}},[a("aui-row",[a("aui-col",{attrs:{lg:2,md:3}},[a("aui-button",{attrs:{type:"primary",icon:"aui-icon-plus",disabled:e.isDisabledDel,size:"mini"},on:{click:e.clickAdd}},[e._v("新增")])],1),e._v(" "),a("aui-col",{attrs:{lg:2,md:3}},[a("aui-button",{attrs:{type:"primary",icon:"aui-icon-edit",disabled:!e.isDisabledDel,size:"mini"},on:{click:function(t){e.checkPermission("1")}}},[e._v("修改")])],1),e._v(" "),a("aui-col",{attrs:{lg:2,md:3}},[a("aui-button",{attrs:{type:"danger",icon:"aui-icon-delete",disabled:!e.isDisabledDel,size:"mini"},on:{click:function(t){e.checkPermission()}}},[e._v("删除")])],1)],1),e._v(" "),a("aui-table",{ref:"ticketCodeList",staticClass:"tableMarginTop",staticStyle:{"min-height":"390px"},attrs:{data:e.ticketCodeList,border:"","header-row-class-name":"tableHeaderClass"},on:{"selection-change":e.selectList}},[a("aui-table-column",{attrs:{type:"selection",width:"40px"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"ORG_NO",formatter:e.dataFormat,label:"机构号","min-width":"247px"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"QR_CD_PATH",label:"二维码地址","min-width":"160px"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"LOGO_PICT_PATH",label:"文件编号","min-width":"160px"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"LOGO_PICT_NM",label:"文件名称","min-width":"160px"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"MATN_PERSON_EMPLY_ID",label:"维护柜员","min-width":"137px"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"MATN_PERSON_NAME",label:"维护柜员名称","min-width":"137px"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"MATN_DT",label:"维护日期","min-width":"110px"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"MATN_TM",label:"维护时间","min-width":"110px"}}),e._v(" "),a("aui-table-column",{attrs:{label:"预览",align:"center",fixed:"right",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("aui-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){e.dialogDetail(t)}}},[e._v("预览")])]}}])})],1),e._v(" "),a("div",{staticStyle:{"text-align":"right","margin-top":"10px"}},[a("aui-pagination",{attrs:{background:"","current-page":e.currentPage,"page-size":e.pageSize,layout:"total, prev, pager, next, jumper",total:e.total},on:{"current-change":e.handleCurrentChange}})],1)],1)],1),e._v(" "),a("aui-dialog",{attrs:{visible:e.dialogVisible,"lock-scroll":!1},on:{"update:visible":function(t){e.dialogVisible=t},hide:e.dialogDetailClose}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingImg,expression:"loadingImg"}],staticStyle:{"text-align":"center"}},[a("img",{staticStyle:{width:"100%","min-height":"340px",position:"relative"},attrs:{src:e.dialogImageUrl,alt:""},on:{load:function(t){e.loadingImg=!1},error:e.loadingImgFalse}})])]),e._v(" "),a("keep-alive",[a(e.dialogList.dialogAdd,{tag:"component",attrs:{option:e.dialogOptions},on:{refreshTable:e.query}})],1)],1)},staticRenderFns:[]};var O=a("/Xao")(w,T,!1,function(e){a("Qn9U")},"data-v-039cd9e7",null);t.default=O.exports},jZFb:function(e,t,a){(e.exports=a("BkJT")(!1)).push([e.i,"\n.LOGOupload.avatar-uploader .aui-upload {\n  border: 1px dashed #d9d9d9;\n  border-radius: 6px;\n  cursor: pointer;\n  position: relative;\n  overflow: hidden;\n}\n.LOGOupload.avatar-uploader .aui-upload:hover {\n    border-color: #409EFF;\n}\n.LOGOupload.avatar-uploader .aui-upload .avatar-uploader-icon {\n    font-size: 28px;\n    color: #8c939d;\n    width: 178px;\n    height: 178px;\n    line-height: 178px;\n    text-align: center;\n}\n.LOGOupload.avatar-uploader .aui-upload .avatar {\n    width: 178px;\n    height: 178px;\n    display: block;\n}\n",""])}});