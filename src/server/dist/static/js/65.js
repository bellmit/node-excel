webpackJsonp([65],{"/szI":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("pADA"),n=a("tzsN"),o=a("0oES"),r=(a("5mQV"),a("syAl")),s=a("AA3o"),l=a.n(s),d=function e(){l()(this,e),this.data={dyncondlist:[],DeviceNum:"",DeviceModel:""},this.CommCode="IBDeviceManagement",this.SceneCode="ActvnCodeGenn",this.TransServiceCode="mg-afaservices-dev/actvnCodeGenn"},c=function e(){l()(this,e),this.data={TransCode:"unioT008",termType:"14",termID:"",factoryId:"002",organization:"100",pkMLenth:"128",authCodeLen:"0",authCodeType:"1"},this.CommCode="PBEsscComm",this.SceneCode="EsscComm",this.TransServiceCode="pb-essccomm/EsscComm"},u={props:{createBrand:Object},data:function(){return{currentRow:[],appList:[],newDate:{devModel:"",devNum:""},loading:!1,applicationInfoList:[]}},created:function(){},computed:{isShow:{get:function(){return this.createBrand.isShow},set:function(e){this.createBrand.isShow=e}}},methods:{openDialog:function(){console.log("====",this.createBrand.applicationInfoList),this.newDate.devModel=this.createBrand.currentRow.devicemodel,this.newDate.devNum=this.createBrand.currentRow.devicenum,this.applicationInfoList=this.createBrand.applicationInfoList},dataFormat:function(e,t){if("devicenum"==t.property)return""==e[t.property]?"未激活":"已生成激活码"},closeBrand:function(){},brandAdd:function(){var e=this;if(this.currentRow.length<1)this.$aui.message.show({type:"warning",message:"请选择要激活信息!"});else{this.appList=[];var t=new c;t.data.termID=this.newDate.devNum,Object(o.a)(t).then(function(t){var a={};a.AppNum=e.currentRow[0].appnum,a.FicttellerNum=e.currentRow[0].ficttellernum,a.SnNumber=e.currentRow[0].SER_NO,a.ActiState="0",a.ActiCode=t.RspInfo.authCode,e.appList.push(a),e.submit(e.appList)}).catch(function(t){console.log(t),e.$aui.message.show({type:"error",message:"生成激活码失败!"+t.SYS_HEAD.ReturnMessage})})}},submit:function(e){var t=this;this.loading=!0;var a=new d;a.data.DeviceNum=this.newDate.devNum,a.data.DeviceModel=this.newDate.devModel,a.data.dyncondlist=e,Object(o.a)(a).then(function(e){t.loading=!1,t.isShow=!1,t.$aui.message.show({type:"success",message:"激活成功!"})}).catch(function(e){console.log(e),t.loading=!1})},handleCurrentChangeTable:function(e){this.currentRow=e,e.length>1&&this.$refs.dataTypeInfo.toggleRowSelection(e[0])}}},p={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("aui-dialog",{attrs:{visible:e.isShow,title:"激活维护",width:"800px","close-on-click-modal":!1},on:{"update:visible":function(t){e.isShow=t},hide:e.closeBrand,show:e.openDialog}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[a("aui-card",[a("aui-form",{ref:"newDate",attrs:{size:"mini",model:e.newDate,inline:"","label-width":"120px","label-position":"right"}},[a("aui-row",{attrs:{gutter:10}},[a("aui-col",{attrs:{span:12}},[a("aui-form-item",{attrs:{prop:"devModel",label:"设备型号:"}},[a("aui-input",{attrs:{disabled:!0,placeholder:"加载异常"},model:{value:e.newDate.devModel,callback:function(t){e.$set(e.newDate,"devModel",t)},expression:"newDate.devModel"}})],1)],1),e._v(" "),a("aui-col",{attrs:{span:12}},[a("aui-form-item",{attrs:{prop:"devNum",label:"设备编号:"}},[a("aui-input",{attrs:{disabled:!0,placeholder:"加载异常"},model:{value:e.newDate.devNum,callback:function(t){e.$set(e.newDate,"devNum",t)},expression:"newDate.devNum"}})],1)],1)],1)],1)],1),e._v(" "),a("aui-card",[a("aui-table",{ref:"dataTypeInfo",staticClass:"tableMarginTop",attrs:{data:e.applicationInfoList,border:"","max-height":"400",width:"100%","header-row-class-name":"tableHeaderClass","highlight-current-row":""},on:{"selection-change":e.handleCurrentChangeTable}},[a("aui-table-column",{attrs:{type:"selection",width:"40px"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"devicemodel",label:"设备型号","min-width":"107px"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"appnum",label:"应用编号","min-width":"107px"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"appname",label:"应用名称","min-width":"107px"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"devicenum",formatter:e.dataFormat,label:"激活状态","min-width":"107px"}}),e._v(" "),a("aui-table-column",{attrs:{label:"SN序列号","min-width":"147px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("aui-input",{attrs:{placeholder:"SN序列号"},model:{value:t.row.SER_NO,callback:function(a){e.$set(t.row,"SER_NO",a)},expression:"scope.row.SER_NO"}})]}}])}),e._v(" "),a("aui-table-column",{attrs:{label:"机器柜员号","min-width":"147px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("aui-input",{attrs:{placeholder:"机器柜员号",disabled:e.createBrand.isDisabled},model:{value:t.row.ficttellernum,callback:function(a){e.$set(t.row,"ficttellernum",a)},expression:"scope.row.ficttellernum"}})]}}])}),e._v(" "),a("aui-table-column",{attrs:{prop:"acticode",label:"激活码","min-width":"107px"}})],1)],1),e._v(" "),a("aui-row",{staticStyle:{margin:"20px 0","text-align":"right"}},[a("aui-button",{attrs:{size:"mini"},on:{click:function(t){e.isShow=!1}}},[e._v("取消")]),e._v(" "),a("aui-button",{attrs:{type:"primary",size:"mini",disabled:e.currentRow.length>1},on:{click:e.brandAdd}},[e._v("确认")])],1)],1)])],1)},staticRenderFns:[]};var m=a("/Xao")(u,p,!1,function(e){a("7e9s")},"data-v-6685cdf2",null).exports,h=a("nXXQ"),v=a("0VOF"),g=a("zdBp"),f=function e(){l()(this,e),this.data={AscrBranch:"",DeviceState:"",DeviceNum:"",DeviceModel:"",start:"",length:""},this.CommCode="IBDeviceManagement",this.SceneCode="DvcActvnInfQuey",this.TransServiceCode="mg-afaservices-dev/dvcActvnInfQuey"},b=function e(){l()(this,e),this.data={BusiOper:"Q",DeviceNum:"",DeviceModel:""},this.BusiDataKey="DEV_PMV039",this.TransServiceCode="ib-dbcomm/dbComm"},w={components:{selectTree:n.a},data:function(){return{brnoList:[],devState:[{value:"3",label:"待激活"},{value:"4",label:"设备投产"}],devStateMap:{3:"待激活",4:"设备投产"},brnoMap:{},dialogList:{createBrandInfo:m},dialogOptions:{isShow:!1,title:"",isEnabled:!1,currentRow:[],applicationInfoList:[]},returnDevDialogOptions:{isShow:!1,currentRow:[]},detailDialogOptions:{isShow:!1,devId:"",dataTypeInfo:[]},devUseMgrQueryForm:{devModel:"",devId:"",selBrno:[],userId:"",devState:""},deviceTypeSpinner:"",devModel:[],ApplicationInfo:[],addBrand:{},loading:!1,currentPage:1,pageSize:void 0,totalRcrdNum:0,isEditClass:!0,isDisabled:!0,isShowBut:!1,isHeight:!1,isListItem:"",isAddBrand:!1,checkedUser:!1,currentRow:[],applicationInfoList:[]}},created:function(){},watch:{devUseMgrQueryForm:{handler:function(e,t){this.currentPage=1},deep:!0}},mounted:function(){this.pageSize=r.a.get("PageSize"),this.initList()},methods:{initList:function(){this.selectQuery()},selectQuery:function(){var e=this,t=new g.a;Object(o.a)(t).then(function(t){e.devModel=t.RspInfo.pageList||[]}).catch(function(e){console.error("查询错误",e)}),this.loading=!0;var a=new v.a;a.data.orgno=this.$store.getters.BranchNum,Object(o.a)(a).then(function(t){e.loading=!1,e.brnoList=t.RspInfo.Result||[],e.brnoMap=t.RspInfo.orgMap||{},e.brnoList=i.a.formatTreeData(e.brnoList,"orgno","superno");var a=new h.a;Object(o.a)(a).then(function(t){e.deviceTypeSpinner=t.RspInfo.Result||[]}).catch(function(e){console.error("查询错误",e)})}).catch(function(t){e.loading=!1,console.error("查询错误",t)})},dataFormat:function(e,t){return"devicestate"==t.property?this.devStateMap[e[t.property]]:"ascrbranch"==t.property?e[t.property]+"-"+e.orgname:"devicetype"==t.property?e[t.property]+"-"+e.devicetypename:void 0},handleCurrentChangeTable:function(e){this.currentRow=e[0],this.detailDialogOptions.currentRow=this.currentRow,1==e.length?"3"==e[0].devicestate?this.checkedUser=!0:this.checkedUser=!1:e.length>1?this.$refs.dataTypeInfo.toggleRowSelection(e[0]):this.checkedUser=!1},brandAdd:function(){var e=this;this.loading=!0,this.dialogOptions.applicationInfoList=[];var t=new b;t.data.DeviceNum=this.currentRow.devicenum,t.data.DeviceModel=this.currentRow.devicemodel,Object(o.a)(t).then(function(t){if(e.loading=!1,e.applicationInfoList=t.RspInfo.Result||[],e.applicationInfoList.length<1)e.$aui.message.show({type:"warning",message:"设备型号未绑定应用!"});else{e.dialogOptions.isShow=!0,e.dialogOptions.title="设备应用激活",e.dialogOptions.currentRow=e.currentRow;for(var a=e.applicationInfoList,i=0;i<a.length;i++)a[i].ficttellernum=a[i].TELR_NO,a[i].TELR_NO?e.dialogOptions.isDisabled=!0:e.dialogOptions.isDisabled=!1;e.dialogOptions.applicationInfoList=a}}).catch(function(t){e.loading=!1,e.$aui.message.show({type:"info",message:"设备型号未关联应用"}),console.error("错误信息",t)})},clearForm:function(e){this.$refs[""+e].resetFields(),this.ApplicationInfo=[],this.totalRcrdNum=0,this.currentPage=1},changePage:function(e){this.currentPage=e,this.tableQuery()},tableQuery:function(){var e=this;this.loading=!0;var t=new f;t.data.AscrBranch=this.devUseMgrQueryForm.selBrno[0],t.data.DeviceState=this.devUseMgrQueryForm.devState,t.data.DeviceNum=this.devUseMgrQueryForm.devId,t.data.DeviceModel=this.devUseMgrQueryForm.devModel,t.data.start=(this.currentPage-1)*this.pageSize,t.data.length=this.pageSize,Object(o.a)(t).then(function(t){e.loading=!1,e.ApplicationInfo=t.RspInfo.pageList||[],e.totalRcrdNum=t.RspInfo.recordsTotal||0}).catch(function(t){e.ApplicationInfo=[],e.totalRcrdNum=0,e.$aui.message.show({type:"warning",message:t.SYS_HEAD.ReturnMessage}),e.loading=!1})}}},y={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"dev-brand-manage",attrs:{"element-loading-text":"加载中。。。"}},[a("aui-card",[a("aui-form",{ref:"devUseMgrQueryForm",attrs:{model:e.devUseMgrQueryForm,size:"mini","label-position":"top"}},[a("aui-row",{attrs:{gutter:10}},[a("aui-col",{attrs:{lg:4,md:6}},[a("aui-form-item",{attrs:{label:"设备型号",prop:"devModel"}},[a("aui-select",{attrs:{placeholder:"请选择设备型号"},model:{value:e.devUseMgrQueryForm.devModel,callback:function(t){e.$set(e.devUseMgrQueryForm,"devModel",t)},expression:"devUseMgrQueryForm.devModel"}},e._l(e.devModel,function(e){return a("aui-option",{key:e.value,attrs:{label:e.devicemodel+"-"+e.devicetype,value:e.devicemodel,disabled:e.disabled}})}))],1)],1),e._v(" "),a("aui-col",{attrs:{lg:4,md:6}},[a("aui-form-item",{attrs:{label:"设备编号",prop:"devId"}},[a("aui-input",{attrs:{placeholder:"请输入设备编号"},model:{value:e.devUseMgrQueryForm.devId,callback:function(t){e.$set(e.devUseMgrQueryForm,"devId",t)},expression:"devUseMgrQueryForm.devId"}})],1)],1),e._v(" "),a("aui-col",{attrs:{lg:4,md:6}},[a("aui-form-item",{attrs:{label:"设备所属机构号",prop:"selBrno"}},[a("select-tree",{staticStyle:{width:"170px"},attrs:{"single-check":!0,props:{id:"orgno",label:"cname",children:"children"},"tree-data":e.brnoList,placeholder:"请选择机构"},model:{value:e.devUseMgrQueryForm.selBrno,callback:function(t){e.$set(e.devUseMgrQueryForm,"selBrno",t)},expression:"devUseMgrQueryForm.selBrno"}})],1)],1),e._v(" "),a("aui-col",{staticClass:"searchBtnMarginTop",attrs:{lg:2,md:3}},[a("aui-button",{attrs:{type:"primary",size:"mini",icon:"aui-icon-search"},on:{click:e.tableQuery}},[e._v("查询")])],1),e._v(" "),a("aui-col",{staticClass:"searchBtnMarginTop",attrs:{lg:2,md:3}},[a("aui-button",{attrs:{type:"warning",size:"mini",icon:"aui-icon-refresh"},on:{click:function(t){e.clearForm("devUseMgrQueryForm")}}},[e._v("重置")])],1)],1)],1)],1),e._v(" "),a("aui-card",{staticStyle:{"margin-top":"10px"}},[a("aui-row",[a("aui-col",{attrs:{lg:2,md:3}},[e.btnPermission("Button_DevBrand_Add")?a("aui-button",{attrs:{type:"primary",size:"mini",icon:"aui-icon-plus",disabled:!e.checkedUser},on:{click:function(t){e.brandAdd()}}},[e._v("激活维护")]):e._e()],1)],1),e._v(" "),a("aui-table",{ref:"dataTypeInfo",staticClass:"tableMarginTop",attrs:{data:e.ApplicationInfo,border:"","max-height":"400",width:"100%","header-row-class-name":"tableHeaderClass","highlight-current-row":""},on:{"selection-change":e.handleCurrentChangeTable}},[a("aui-table-column",{attrs:{type:"selection",width:"40px"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"devicenum",label:"设备编号","min-width":"107px"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"devicemodel",label:"设备型号","min-width":"107px"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"devicetype",label:"设备类型",formatter:e.dataFormat,"min-width":"107px"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"ascrbranch",label:"所属机构号",formatter:e.dataFormat,"min-width":"107px",fixed:""}}),e._v(" "),a("aui-table-column",{attrs:{prop:"serviceprovnum",label:"服务商编号","min-width":"107px","show-overflow-tooltip":""}}),e._v(" "),a("aui-table-column",{attrs:{prop:"devicestate",formatter:e.dataFormat,label:"设备状态","min-width":"107px"}})],1),e._v(" "),a("div",{staticStyle:{"text-align":"right","margin-top":"20px"}},[a("aui-pagination",{attrs:{background:"","current-page":e.currentPage,"page-size":e.pageSize,layout:"total, prev, pager, next, jumper",total:e.totalRcrdNum},on:{"current-change":e.changePage}})],1)],1),e._v(" "),a("keep-alive",[a(e.dialogList.createBrandInfo,{tag:"component",attrs:{createBrand:e.dialogOptions},on:{refreshBrand:e.tableQuery}})],1)],1)},staticRenderFns:[]};var S=a("/Xao")(w,y,!1,function(e){a("t9tU")},"data-v-40b60037",null);t.default=S.exports},"7e9s":function(e,t,a){var i=a("AT5I");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);a("8bSs")("97e62c64",i,!0)},AT5I:function(e,t,a){(e.exports=a("BkJT")(!1)).push([e.i,"",""])},"ap/W":function(e,t,a){(e.exports=a("BkJT")(!1)).push([e.i,"\n.cardStyle[data-v-40b60037] {\n  margin: 5px 0;\n}\n.listEdit[data-v-40b60037] {\n  text-align: right;\n}\n.listEdit a[data-v-40b60037] {\n    margin: 5px;\n}\n.demo-table-expand .aui-form-item[data-v-40b60037] {\n  margin-bottom: 5px;\n}\n.editClass input.el-input__inner[data-v-40b60037] {\n  border: none;\n  background: rgba(0, 0, 0, 0) !important;\n}\n.fade-enter-active[data-v-40b60037],\n.fade-leave-active[data-v-40b60037] {\n  -webkit-transition: opacity 0.6s;\n  transition: opacity 0.6s;\n}\n.fade-enter[data-v-40b60037],\n.fade-leave-to[data-v-40b60037] {\n  opacity: 0;\n}\n.heightlight[data-v-40b60037] {\n  -webkit-box-shadow: 0 2px 12px 0 rgba(177, 208, 244, 0.6);\n          box-shadow: 0 2px 12px 0 rgba(177, 208, 244, 0.6);\n}\n",""])},t9tU:function(e,t,a){var i=a("ap/W");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);a("8bSs")("2818c3c4",i,!0)}});