webpackJsonp([65],{"+gay":function(e,t,a){(e.exports=a("BkJT")(!1)).push([e.i,"",""])},"A/Pn":function(e,t,a){var i=a("+gay");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);a("8bSs")("27dbbd7c",i,!0)},PFFx:function(e,t,a){(e.exports=a("BkJT")(!1)).push([e.i,"",""])},bAET:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("tzsN"),r=a("syAl"),s=a("0oES"),n=a("pADA"),o=a("AA3o"),l=a.n(o),c=function e(){l()(this,e),this.data={},this.CommCode="ImpressLabel",this.SceneCode="ImpressLabelMan",this.TransServiceCode="mg-afaservices-pad/ImpressLabel"},u=a("fCv1"),m={components:{selectTree:i.a},props:{option:Object},data:function(){return{loading:!1,AllName:[],form:{brno:[],labelName:"",tabledata:[]},rules:{brno:[{required:!0,message:"请选择机构号",trigger:"change"}],labelName:[{required:!0,message:"请输入标签名称",trigger:"blur"},{required:!0,validator:Object(u.h)(20),trigger:"blur"}]}}},methods:{openUpdate:function(){this.$refs.form&&this.$refs.form.clearValidate()},closeUpdete:function(){this.form.tabledata=[],this.AllName=[],this.$refs.form.resetFields(),this.$refs.form.clearValidate()},dataDel:function(e,t){this.form.tabledata.splice(e,1)},insertLabel:function(){var e=this;this.checkLabelName(),this.$refs.form.validate(function(t){if(t){var a={brno:e.form.brno,labelName:e.form.labelName};e.form.tabledata.push(a)}})},addInfo:function(){var e=this;this.loading=!0;var t=new c;t.data.DealType="6",t.data.LPR_ORG_NO=this.form.brno[0],t.data.CUST_LABL_CONTENT=this.form.labelName,Object(s.a)(t).then(function(t){e.loading=!1,console.log(t.RspInfo.ImpressLabelList),t.RspInfo.ImpressLabelList?e.$aui.message.show({type:"warning",message:"该标签名称已存在!"}):e.insertLabel()}).catch(function(t){e.$aui.message.show({type:"error",message:"添加失败!"+t.SYS_HEAD.ReturnMessage}),e.loading=!1})},checkLabelName:function(){if(this.form.tabledata.length>0){var e="";if(this.form.tabledata[0].brno[0]==this.form.brno[0]){for(var t=0;t<this.form.tabledata.length;t++){this.form.tabledata[t].labelName==this.form.labelName&&(e="1")}"1"==e&&(this.form.labelName="",this.$aui.message.show({type:"warning",message:"该标签名称已添加"}))}else this.form.brno="",this.$aui.message.show({type:"warning",message:"只能维护同一机构"})}},getAllName:function(){this.AllName=[];for(var e=0;e<this.form.tabledata.length;e++)this.AllName.push(this.form.tabledata[e].labelName)},ItemUpdate:function(){var e=this;this.getAllName(),this.$refs.form.validate(function(t){if(t){e.loading=!0;var a=new c;a.data.DealType="5",a.data.LPR_ORG_NO=e.form.brno[0],a.data.CustLablContentList=e.AllName,a.data.LABL_INDCT_SEQ_NO="0",a.data.CUST_LABL_STUS_CD="1",a.data.MODFY_TELR_NO=e.$store.getters.UserName,Object(s.a)(a).then(function(t){e.loading=!1,e.option.isShow=!1,e.$emit("refreshTable")}).catch(function(t){e.loading=!1,e.$aui.message.show({type:"warning",message:t.SYS_HEAD.ReturnMessage+"!"})})}})}}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("aui-dialog",{attrs:{title:e.option.title,visible:e.option.isShow,width:"800px","close-on-click-modal":!1},on:{"update:visible":function(t){e.$set(e.option,"isShow",t)},show:e.openUpdate,hide:e.closeUpdete}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[a("aui-card",[a("aui-form",{ref:"form",attrs:{model:e.form,size:"mini",rules:e.rules,"label-width":"120px","label-position":"right"}},[a("aui-row",{attrs:{gutter:40}},[a("aui-col",{attrs:{span:12}},[a("aui-form-item",{attrs:{label:"机构号:",prop:"brno"}},[a("select-tree",{staticStyle:{width:"170px"},attrs:{"single-check":!0,props:{id:"orgno",label:"cname",children:"children"},"tree-data":e.option.branchNum,placeholder:"请选择机构"},model:{value:e.form.brno,callback:function(t){e.$set(e.form,"brno",t)},expression:"form.brno"}})],1)],1),e._v(" "),a("aui-col",{attrs:{span:12}},[a("aui-form-item",{attrs:{label:"标签名称:",prop:"labelName"}},[a("aui-input",{model:{value:e.form.labelName,callback:function(t){e.$set(e.form,"labelName",t)},expression:"form.labelName"}})],1)],1)],1)],1)],1),e._v(" "),a("aui-card",{staticClass:"type-info-bottom"},[a("aui-row",[a("aui-col",{attrs:{lg:2,md:3}},[a("aui-button",{staticClass:"b-button",attrs:{type:"primary",size:"mini",icon:"aui-icon-plus"},on:{click:e.addInfo}},[e._v("添加")])],1)],1),e._v(" "),a("aui-table",{ref:"table",staticClass:"tableMarginTop",attrs:{data:e.form.tabledata,border:"",width:"100%","header-row-class-name":"tableHeaderClass","highlight-current-row":""}},[a("aui-table-column",{attrs:{type:"index",prop:"id"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"brno",label:"机构号"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"labelName",label:"标签名称"}}),e._v(" "),e.option.isDisabled?e._e():a("aui-table-column",{attrs:{label:"操作",align:"center","class-name":"small-padding fixed-width",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("aui-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){e.dataDel(t.$index,t.row)}}},[e._v("删除")])]}}])})],1)],1),e._v(" "),a("aui-row",{staticStyle:{margin:"20px 0","text-align":"center"}},[a("aui-button",{attrs:{size:"mini"},on:{click:function(t){e.option.isShow=!1}}},[e._v("返回")]),e._v(" "),a("aui-button",{attrs:{type:"primary",size:"mini"},on:{click:e.ItemUpdate}},[e._v("确定")])],1)],1)])],1)},staticRenderFns:[]};var h=a("/Xao")(m,d,!1,function(e){a("i/x0")},null,null).exports,p=a("0VOF"),g=function e(){l()(this,e),this.data={},this.CommCode="ImpressLabel",this.SceneCode="ImpressLabelMan",this.TransServiceCode="mg-afaservices-pad/ImpressLabel"},b=function e(){l()(this,e),this.data={},this.CommCode="ImpressLabel",this.SceneCode="ImpressLabelMan",this.TransServiceCode="mg-afaservices-pad/ImpressLabel"},f={name:"impressionalLabel",components:{selectTree:i.a},data:function(){return{QueryForm:{branchNum:[]},dialogList:{dialogAdd:h},dialogOptions:{isShow:!1},brnoList:[],tableList:[],permission:{},currentRow:[],loading:!1,isDisabledDel:!1,total:0,pageSize:void 0,currentPage:1,rules:{branchNum:[{required:!0,message:"请选择机构号",trigger:"change"}]}}},created:function(){this.pageSize=r.a.get("PageSize"),this.queryBranchNum()},watch:{QueryForm:{handler:function(e,t){this.currentPage=1},deep:!0}},methods:{queryBranchNum:function(){var e=this;this.loading=!0;var t=new p.a;t.data.orgno=this.$store.getters.BranchNum,Object(s.a)(t).then(function(t){e.loading=!1,e.branchNum=t.RspInfo.Result||[],e.brnoMap=t.RspInfo.orgMap||{},e.permission=n.a.objArray2Hash(e.branchNum,"orgno"),e.brnoList=n.a.formatTreeData(e.branchNum,"orgno","superno"),e.QueryForm.branchNum.push(e.brnoList[0].orgno)}).catch(function(t){e.loading=!1,e.$aui.message.show({type:"warning",message:t.SYS_HEAD.ReturnMessage}),console.error("查询错误",t)})},handleCurrentChange:function(e){this.currentPage=e,this.query()},resetForm:function(){this.tableList=[],this.total=0,this.currentPage=1,this.$refs.QueryForm.resetFields()},query:function(){var e=this;this.$refs.QueryForm.validate(function(t){if(t){e.loading=!0;var a=new g;a.data.DealType="4",a.data.LPR_ORG_NO=e.QueryForm.branchNum[0],a.data.pagenum=e.pageSize+"",a.data.currpage=e.currentPage+"",Object(s.a)(a).then(function(t){e.loading=!1,e.tableList=t.RspInfo.ImpressLabelList||[],e.total=t.RspInfo.TotalRowNum||0,e.total&&0!==e.total||e.$aui.message.show({type:"warning",message:"没有满足条件的记录!"})}).catch(function(t){e.tableList=[],e.total=0,e.loading=!1,e.$aui.message.show({type:"warning",message:"请求失败，错误码:"+t.SYS_HEAD.ReturnCode+"，错误信息："+t.SYS_HEAD.ReturnMessage})})}})},dataFormat:function(e,t){if("LPR_ORG_NO"==t.property)return e[t.property]+"-"+this.brnoMap[e[t.property]]},selectList:function(e){1==e.length?(this.isDisabledDel=!0,this.currentRow=e[0]):e.length>1?this.$refs.tableList.toggleRowSelection(e[0]):this.isDisabledDel=!1},clickAdd:function(){this.dialogOptions.isShow=!0,this.dialogOptions.title="添加印象标签",this.dialogOptions.branchNum=this.brnoList},checkPermission:function(e){this.permission[this.currentRow.Brno]?e?this.clickUpdate():this.delBut():this.$aui.message.show({type:"warning",message:"权限不足,无法修改！"})},delBut:function(){var e=this;this.$aui.confirm.show("此操作将删除该印象标签, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.orgQueueDel()}).catch(function(){e.$aui.message.show({type:"info",message:"已取消删除"})})},orgQueueDel:function(){var e=this;this.loading=!0;var t=new b;t.data.DealType="2",t.data.LPR_ORG_NO=this.currentRow.LPR_ORG_NO,t.data.CUST_LABL_CONTENT=this.currentRow.CUST_LABL_NM,t.data.CUST_LABL_CD=this.currentRow.CUST_LABL_CD,Object(s.a)(t).then(function(t){e.loading=!1,e.$aui.message.show({type:"success",message:"删除成功！"}),e.currentPage=1,e.query()}).catch(function(t){e.loading=!1,e.$aui.message.show({type:"warning",message:t.SYS_HEAD.ReturnMessage})})}}},v={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{"element-loading-text":"加载中。。。"}},[a("aui-card",[a("aui-form",{ref:"QueryForm",attrs:{model:e.QueryForm,rules:e.rules,size:"mini","label-position":"top"}},[a("aui-row",{attrs:{gutter:10}},[a("aui-col",{attrs:{lg:4,md:6}},[a("aui-form-item",{attrs:{label:"机构号",prop:"branchNum"}},[a("select-tree",{staticStyle:{width:"170px"},attrs:{"single-check":!0,props:{id:"orgno",label:"cname",children:"children"},"tree-data":e.brnoList,placeholder:"请选择机构"},model:{value:e.QueryForm.branchNum,callback:function(t){e.$set(e.QueryForm,"branchNum",t)},expression:"QueryForm.branchNum"}})],1)],1),e._v(" "),a("aui-col",{staticClass:"searchBtnMarginTop",attrs:{lg:2,md:3}},[a("aui-button",{attrs:{type:"primary",size:"mini",icon:"aui-icon-search"},on:{click:e.query}},[e._v("查询")])],1),e._v(" "),a("aui-col",{staticClass:"searchBtnMarginTop",attrs:{lg:2,md:3}},[a("aui-button",{attrs:{type:"warning",size:"mini",icon:"aui-icon-refresh"},on:{click:function(t){e.resetForm("QueryForm")}}},[e._v("重置")])],1)],1)],1)],1),e._v(" "),a("aui-card",{staticStyle:{"margin-top":"10px"}},[a("aui-row",[a("aui-col",{attrs:{lg:2,md:3}},[a("aui-button",{attrs:{type:"primary",icon:"aui-icon-plus",size:"mini"},on:{click:e.clickAdd}},[e._v("添加")])],1),e._v(" "),a("aui-col",{attrs:{lg:2,md:3}},[a("aui-button",{attrs:{type:"danger",icon:"aui-icon-delete",disabled:!e.isDisabledDel,size:"mini"},on:{click:function(t){e.checkPermission()}}},[e._v("删除")])],1)],1),e._v(" "),a("aui-table",{ref:"tableList",staticClass:"tableMarginTop",staticStyle:{"min-height":"390px"},attrs:{data:e.tableList,border:"","header-row-class-name":"tableHeaderClass"},on:{"selection-change":e.selectList}},[a("aui-table-column",{attrs:{type:"selection",width:"40px"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"LPR_ORG_NO",formatter:e.dataFormat,label:"机构号","min-width":"247px"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"CUST_LABL_NM",label:"标签名称","min-width":"137px"}})],1),e._v(" "),a("div",{staticStyle:{"text-align":"right","margin-top":"10px"}},[a("aui-pagination",{attrs:{background:"","current-page":e.currentPage,"page-size":e.pageSize,layout:"total, prev, pager, next, jumper",total:e.total},on:{"current-change":e.handleCurrentChange}})],1)],1)],1),e._v(" "),a("keep-alive",[a(e.dialogList.dialogAdd,{tag:"component",attrs:{option:e.dialogOptions},on:{refreshTable:e.query}})],1)],1)},staticRenderFns:[]};var _=a("/Xao")(f,v,!1,function(e){a("A/Pn")},"data-v-3f450c64",null);t.default=_.exports},"i/x0":function(e,t,a){var i=a("PFFx");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);a("8bSs")("7c18ba4f",i,!0)}});