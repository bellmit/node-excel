webpackJsonp([39],{"3F4b":function(t,e,a){var r=a("aMWZ");"string"==typeof r&&(r=[[t.i,r,""]]),r.locals&&(t.exports=r.locals);a("8bSs")("0a234147",r,!0)},MnuC:function(t,e,a){(t.exports=a("BkJT")(!1)).push([t.i,"",""])},OsTG:function(t,e,a){(t.exports=a("BkJT")(!1)).push([t.i,"\n.aui-date-editor[data-v-42621f37] {\n  width: 100%;\n}\n.searchBtnMarginTop[data-v-42621f37] {\n  margin-top: 0px;\n}\n",""])},SbK3:function(t,e,a){var r=a("MnuC");"string"==typeof r&&(r=[[t.i,r,""]]),r.locals&&(t.exports=r.locals);a("8bSs")("5ee84afe",r,!0)},aMWZ:function(t,e,a){(t.exports=a("BkJT")(!1)).push([t.i,"\n.aui-date-editor[data-v-190a9ee3] {\n  width: 100%;\n}\n.searchBtnMarginTop[data-v-190a9ee3] {\n  margin-top: 0px;\n}\n",""])},gqVT:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=a("0oES"),o=a("tzsN"),i=a("pADA"),s=a("0VOF"),n=a("zdBp"),l=a("AA3o"),u=a.n(l),c=function t(){u()(this,t),this.data={PurchCtrtNo:"",CtrtName:"",CtrtAmount:"",PurchNum:"",PurchDate:"",SupplyName:"",PurchOrg:"",PurchPersonName:"",PurchComment:"",ModelList:[]},this.CommCode="IBDeviceInfoManage",this.SceneCode="PurchPlanAdd",this.TransServiceCode="mg-afaservices-dev/purchasePlanAdd"},d=function t(){u()(this,t),this.data={PurchCtrtNo:"",CtrtName:"",CtrtAmount:"",PurchNum:"",PurchDate:"",SupplyName:"",PurchOrg:"",PurchPersonName:"",PurchComment:"",ModelList:[]},this.CommCode="IBDeviceInfoManage",this.SceneCode="PurchPlanUpd",this.TransServiceCode="mg-afaservices-dev/purchPlanUpd"},m=function t(){u()(this,t),this.data={PurchCtrtNo:"",Page:"1",PageNum:"10"},this.CommCode="IBDeviceInfoManage",this.SceneCode="PurchPlanInfoQuey2",this.TransServiceCode="mg-afaservices-dev/purchPlanInfoQuey2"},p=a("fCv1"),h={components:{selectTree:o.a},data:function(){var t=this;return{isDialogShow:!1,dialogTitle:"",dialogType:"",row:"",devModelList:[],currentRow:[],brnoList:[],brnoList1:[],loading:!1,form:{brno:[],contractSum:"",purchaseNum:"",contractName:"",num:"",purchaseDate:"",supplierNum:"",desc:"",tabledata:[]},form1:{pushbrno:"",productno:"",productor:"",maintainer:"",price:"",agelimit:"",num:"1",deviceinfo:""},rulesBase:{contractSum:[{required:!0,message:"请输入合同金额",trigger:"blur"},{validator:function(e,a,r){t.form.contractSum||a?a&&/^[1-9]*[1-9][0-9]*$/.test(a)||t.form.contractSum&&""==a?r():r(new Error("必须是正整数且不能以0开头!")):r(new Error("请输入合同金额!"))},trigger:"blur"}],purchaseNum:[{required:!0,message:"采购合同号加载异常",trigger:"blur"}],contractName:[{required:!0,message:"请输入合同名称",trigger:"blur"},{validator:p.l,trigger:"blur"},{validator:Object(p.h)(100),trigger:"blur"}],num:[{required:!0,message:"请输入数量",trigger:"blur"},{validator:function(e,a,r){t.form.num||a?a&&/^[1-9]*[1-9][0-9]*$/.test(a)||t.form.num&&""==a?r():r(new Error("必须是正整数且不能以0开头!")):r(new Error("请输入数量!"))},trigger:"blur"}],brno:[{type:"array",required:!0,message:"请选择所属机构",trigger:"change"}],purchaseDate:[{required:!0,message:"请选择采购日期",trigger:"blur"}],supplierNum:[{required:!0,message:"请输入供应商",trigger:"blur"},{validator:p.l,trigger:"blur"},{validator:Object(p.h)(100),trigger:"blur"}],desc:[{validator:Object(p.h)(200),trigger:"blur"}]},rules1:{pushbrno:[{required:!0,message:"请输入发布机构",trigger:"change"}],productno:[{required:!0,message:"请输入设备型号",trigger:"blur"}],productor:[{required:!0,message:"请输入生产商",trigger:"blur"},{validator:p.l,trigger:"blur"},{validator:Object(p.h)(50),trigger:"blur"}],maintainer:[{required:!0,message:"请输入维护商",trigger:"blur"},{validator:p.l,trigger:"blur"},{validator:Object(p.h)(50),trigger:"blur"}],price:[{max:10,message:"设备单价不能超过10位",trigger:"blur"},{required:!0,validator:function(e,a,r){t.form1.price||a?a&&/^[1-9]*[1-9][0-9]*$/.test(a)||t.form1.price&&""==a?r():r(new Error("必须是正整数且不能以0开头!")):r(new Error("请输入设备单价!"))},trigger:"blur"}],agelimit:[{max:4,message:"折旧年限不能超过4位",trigger:"blur"},{required:!0,validator:function(e,a,r){t.form1.agelimit||a?a&&/^[1-9]*[1-9][0-9]*$/.test(a)||t.form1.agelimit&&""==a?r():r(new Error("必须是正整数且不能以0开头!")):r(new Error("请输入折旧年限!"))},trigger:"blur"}],num:[{required:!0,message:"请输入数量",trigger:"blur"}],deviceinfo:[{validator:Object(p.h)(200),trigger:"blur"}]}}},methods:{submitClick:function(t){var e=this;this.contractSumCheck(),this.numCheck(),this.$refs.form.validate(function(a){if(a){e.loading=!0;var o="1"==e.option.mark?new c:new d;o.data.PurchCtrtNo=e.form.purchaseNum,o.data.CtrtName=e.form.contractName,o.data.CtrtAmount=e.form.contractSum,o.data.PurchNum=e.form.num,o.data.PurchDate=e.form.purchaseDate,o.data.SupplyName=e.form.supplierNum,o.data.PurchOrg=e.form.brno[0],o.data.PurchPersonName=e.$store.getters.UserNum,o.data.PurchComment=e.form.desc,o.data.PurchStus="0"==t?0:1,o.data.ModelList=e.form.tabledata,Object(r.a)(o).then(function(t){e.$emit("refreshTable");var a="1"==e.option.mark?"创建":"修改";e.$aui.message.show({type:"success",message:"设备采购信息"+a+t.SYS_HEAD.ReturnMessage}),e.isShow=!1,e.loading=!1}).catch(function(t){e.isShow=!1,e.loading=!1,e.$aui.message.show({type:"error",message:""+t.SYS_HEAD.ReturnMessage})})}})},contractSumCheck:function(){if(0==this.form.tabledata.length)this.form.contractSum="";else{for(var t=0,e=0;e<this.form.tabledata.length;e++){t+=Number(this.form.tabledata[e].EquipPerCost)*Number(this.form.tabledata[e].PurchNum)}Number(this.form.contractSum)!=t&&(this.form.contractSum="",this.$aui.message.show({type:"warning",message:"总金额和表单内汇总金额不一致"}))}},numCheck:function(){if(0==this.form.tabledata.length)this.form.num="";else{for(var t=0,e=0;e<this.form.tabledata.length;e++){t+=Number(this.form.tabledata[e].PurchNum)}Number(this.form.num)!=t&&(this.form.num="",this.$aui.message.show({type:"warning",message:"总数量和表单内汇总数量不一致"}))}},addInfo:function(){this.isDialogShow=!0,this.dialogTitle="采购设备信息新增"},checkProductNo:function(){if(this.form.tabledata.length>0){for(var t="",e=0;e<this.form.tabledata.length;e++){this.form.tabledata[e].ProductModel==this.form1.productno&&(t="1")}"1"==t&&(this.form1.productno="",this.$aui.message.show({type:"warning",message:"存在相同设备型号！"}))}},modelAdd:function(){var t=this;this.$refs.form1.validate(function(e){if(e){var a={ProductModel:t.form1.productno,Producer:t.form1.productor,MaintBuss:t.form1.maintainer,EquipPerCost:t.form1.price,DeprecLife:t.form1.agelimit,PurchNum:t.form1.num,DeployOrg:t.form1.pushbrno[0],HardwInfo:t.form1.deviceinfo};t.form.tabledata.push(a),t.isDialogShow=!1}})},dataDel:function(t,e){this.form.tabledata.splice(t,1)},openDevInfo:function(){var t=this;if("1"==this.option.mark){var e=i.a.getDateTime("date")+i.a.getDateTime("time");this.form.purchaseNum=this.$store.getters.BranchNum+e}else{this.loading=!0;var a=new m;a.data.PurchCtrtNo=this.option.currentRow[0].purch_ctrt_no,Object(r.a)(a).then(function(e){t.loading=!1,e.RspInfo&&(t.form.purchaseNum=e.RspInfo.PurchCtrtNo,t.form.contractName=e.RspInfo.CtrtName,t.form.contractSum=e.RspInfo.CtrtAmount,t.form.num=e.RspInfo.PurchNum,t.form.purchaseDate=i.a.timestampToTime2(e.RspInfo.PurchDate),t.form.supplierNum=e.RspInfo.SupplyName,t.form.brno.push(e.RspInfo.PurchOrg),t.form.desc=e.RspInfo.PurchComment,e.RspInfo.Result.length>0&&(t.form.tabledata=e.RspInfo.Result))}).catch(function(e){t.loading=!1,console.log(e)})}},openDialog:function(){var t=this,e=new n.a;Object(r.a)(e).then(function(e){t.devModelList=e.RspInfo.pageList}).catch(function(e){t.$aui.message.show({type:"error",message:e.SYS_HEAD.ReturnMessage+"!"})})},dialogClearForm:function(){this.dialogTitle="",this.$refs.form1.clearValidate(),this.$refs.form1.resetFields()},clearForm:function(){this.form.tabledata=[],this.$refs.form.clearValidate(),this.$refs.form.resetFields()}},props:{option:Object},computed:{isShow:{get:function(){return this.option.isShow},set:function(t){this.option.isShow=t}}}},f={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("aui-dialog",{attrs:{title:t.option.title,visible:t.isShow,width:"80%","close-on-click-modal":!1},on:{"update:visible":function(e){t.isShow=e},show:t.openDevInfo,hide:function(e){t.clearForm()}}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]},[a("aui-card",[a("aui-form",{ref:"form",attrs:{model:t.form,rules:t.rulesBase,"label-width":"100px",size:"mini","label-position":"left"}},[a("aui-row",{attrs:{gutter:10}},[a("aui-col",{attrs:{lg:6,md:6}},[a("aui-form-item",{attrs:{label:"采购合同号:",prop:"purchaseNum"}},[a("aui-input",{attrs:{disabled:!0,placeholder:"请输入采购合同号"},model:{value:t.form.purchaseNum,callback:function(e){t.$set(t.form,"purchaseNum",e)},expression:"form.purchaseNum"}})],1)],1),t._v(" "),a("aui-col",{attrs:{lg:6,md:6}},[a("aui-form-item",{attrs:{label:"合同名称:",prop:"contractName"}},[a("aui-input",{attrs:{placeholder:"请输入合同名称",disabled:t.option.isDisabled},model:{value:t.form.contractName,callback:function(e){t.$set(t.form,"contractName",e)},expression:"form.contractName"}})],1)],1),t._v(" "),a("aui-col",{attrs:{lg:6,md:6}},[a("aui-form-item",{attrs:{label:"合同金额:",prop:"contractSum"}},[a("aui-input",{attrs:{disabled:t.option.isDisabled},model:{value:t.form.contractSum,callback:function(e){t.$set(t.form,"contractSum",e)},expression:"form.contractSum"}})],1)],1),t._v(" "),a("aui-col",{attrs:{lg:4,md:6}},[a("aui-form-item",{attrs:{label:"数量:",prop:"num","label-width":"60px"}},[a("aui-input",{attrs:{disabled:t.option.isDisabled},model:{value:t.form.num,callback:function(e){t.$set(t.form,"num",e)},expression:"form.num"}})],1)],1),t._v(" "),a("aui-col",{attrs:{lg:6,md:6}},[a("aui-form-item",{attrs:{label:"采购日期:",prop:"purchaseDate"}},[a("aui-date-picker",{attrs:{"value-format":"yyyyMMdd",align:"right",type:"date",placeholder:"选择日期",disabled:t.option.isDisabled},model:{value:t.form.purchaseDate,callback:function(e){t.$set(t.form,"purchaseDate",e)},expression:"form.purchaseDate"}})],1)],1),t._v(" "),a("aui-col",{attrs:{lg:6,md:6}},[a("aui-form-item",{attrs:{label:"供应商名称:",prop:"supplierNum"}},[a("aui-input",{attrs:{disabled:t.option.isDisabled},model:{value:t.form.supplierNum,callback:function(e){t.$set(t.form,"supplierNum",e)},expression:"form.supplierNum"}})],1)],1),t._v(" "),a("aui-col",{attrs:{lg:6,md:6}},[a("aui-form-item",{attrs:{label:"所属机构 :",prop:"brno"}},[a("select-tree",{attrs:{"single-check":!0,"tree-data":t.option.brnoList,props:{id:"orgno",label:"cname",children:"children"},placeholder:"请选择机构",disabled:t.option.isDisabled},model:{value:t.form.brno,callback:function(e){t.$set(t.form,"brno",e)},expression:"form.brno"}})],1)],1),t._v(" "),a("aui-col",{attrs:{lg:12,md:6}},[a("aui-form-item",{attrs:{label:"采购说明 :",prop:"desc"}},[a("aui-input",{attrs:{type:"textarea",resize:"none",autosize:{minRows:2,maxRows:2},disabled:t.option.isDisabled},model:{value:t.form.desc,callback:function(e){t.$set(t.form,"desc",e)},expression:"form.desc"}})],1)],1),t._v(" "),a("aui-col",{attrs:{lg:2,md:3}},[a("aui-button",{attrs:{type:"primary",size:"mini",disabled:t.option.isDisabled},on:{click:function(e){t.submitClick("0")}}},[t._v("保存")])],1),t._v(" "),a("aui-col",{attrs:{lg:2,md:3}},[a("aui-button",{attrs:{type:"primary",size:"mini",disabled:t.option.isDisabled},on:{click:function(e){t.submitClick("1")}}},[t._v("提交")])],1)],1)],1)],1),t._v(" "),a("aui-dialog",{attrs:{title:t.dialogTitle,visible:t.isDialogShow,"append-to-body":"","close-on-click-modal":!1},on:{"update:visible":function(e){t.isDialogShow=e},show:t.openDialog,hide:function(e){t.dialogClearForm()}}},[a("aui-card",[a("aui-form",{ref:"form1",attrs:{model:t.form1,size:"mini",rules:t.rules1,"label-width":"100px","label-position":"left"}},[a("aui-row",{attrs:{gutter:40}},[a("aui-col",{attrs:{span:12}},[a("aui-form-item",{attrs:{label:"设备型号:",prop:"productno"}},[a("aui-select",{attrs:{filterable:!0,clearable:!0,placeholder:"请选择设备型号"},on:{change:t.checkProductNo},model:{value:t.form1.productno,callback:function(e){t.$set(t.form1,"productno",e)},expression:"form1.productno"}},t._l(t.devModelList,function(t){return a("aui-option",{key:t.devicemodel,attrs:{label:t.devicemodel,value:t.devicemodel}})}))],1)],1),t._v(" "),a("aui-col",{attrs:{span:12}},[a("aui-form-item",{attrs:{label:"生产商:",prop:"productor"}},[a("aui-input",{attrs:{placeholder:"请输入生产商"},model:{value:t.form1.productor,callback:function(e){t.$set(t.form1,"productor",e)},expression:"form1.productor"}})],1)],1),t._v(" "),a("aui-col",{attrs:{span:12}},[a("aui-form-item",{attrs:{label:"维护商:",prop:"maintainer"}},[a("aui-input",{attrs:{placeholder:"请输入维护商"},model:{value:t.form1.maintainer,callback:function(e){t.$set(t.form1,"maintainer",e)},expression:"form1.maintainer"}})],1)],1),t._v(" "),a("aui-col",{attrs:{span:12}},[a("aui-form-item",{attrs:{label:"设备单价:",prop:"price"}},[a("aui-input",{attrs:{placeholder:"请输入设备单价"},model:{value:t.form1.price,callback:function(e){t.$set(t.form1,"price",e)},expression:"form1.price"}})],1)],1),t._v(" "),a("aui-col",{attrs:{span:12}},[a("aui-form-item",{attrs:{label:"折旧年限:",prop:"agelimit"}},[a("aui-input",{attrs:{placeholder:"请输入折旧年限"},model:{value:t.form1.agelimit,callback:function(e){t.$set(t.form1,"agelimit",e)},expression:"form1.agelimit"}})],1)],1),t._v(" "),a("aui-col",{attrs:{span:12}},[a("aui-form-item",{attrs:{label:"采购数量",prop:"num"}},[a("aui-input-number",{attrs:{min:1,max:99999,placeholder:"请输入采购数量"},model:{value:t.form1.num,callback:function(e){t.$set(t.form1,"num",e)},expression:"form1.num"}})],1)],1),t._v(" "),a("aui-col",{attrs:{span:24}},[a("aui-form-item",{attrs:{label:"布放机构:",prop:"pushbrno"}},[a("select-tree",{attrs:{"single-check":!0,"tree-data":t.option.brnoList,props:{id:"orgno",label:"cname",children:"children"},placeholder:"请选择机构"},model:{value:t.form1.pushbrno,callback:function(e){t.$set(t.form1,"pushbrno",e)},expression:"form1.pushbrno"}})],1)],1),t._v(" "),a("aui-col",{attrs:{span:24}},[a("aui-form-item",{attrs:{label:"硬件信息:",prop:"deviceinfo"}},[a("aui-input",{attrs:{type:"textarea",resize:"none",autosize:{minRows:2,maxRows:2}},model:{value:t.form1.deviceinfo,callback:function(e){t.$set(t.form1,"deviceinfo",e)},expression:"form1.deviceinfo"}})],1)],1)],1),t._v(" "),a("aui-row",{staticStyle:{margin:"20px 0","text-align":"right"}},[a("aui-button",{attrs:{size:"mini"},on:{click:function(e){t.isDialogShow=!1}}},[t._v("取消")]),t._v(" "),a("aui-button",{attrs:{type:"primary",size:"mini"},on:{click:t.modelAdd}},[t._v("确认")])],1)],1)],1)],1),t._v(" "),a("aui-card",{staticClass:"type-info-bottom"},[t.option.isDisabled?t._e():a("aui-row",[a("aui-col",{attrs:{lg:2,md:3}},[a("aui-button",{staticClass:"b-button",attrs:{type:"primary",size:"mini",icon:"aui-icon-plus"},on:{click:t.addInfo}},[t._v("添加")])],1)],1),t._v(" "),a("aui-table",{ref:"table",staticClass:"tableMarginTop",attrs:{data:t.form.tabledata,border:"",width:"100%","header-row-class-name":"tableHeaderClass","highlight-current-row":""}},[a("aui-table-column",{attrs:{type:"index",prop:"id"}}),t._v(" "),a("aui-table-column",{attrs:{prop:"ProductModel",label:"设备型号"}}),t._v(" "),a("aui-table-column",{attrs:{prop:"Producer",label:"生产商"}}),t._v(" "),a("aui-table-column",{attrs:{prop:"MaintBuss",label:"维护商"}}),t._v(" "),a("aui-table-column",{attrs:{prop:"EquipPerCost",label:"设备单价"}}),t._v(" "),a("aui-table-column",{attrs:{prop:"DeprecLife",label:"折旧年限"}}),t._v(" "),a("aui-table-column",{attrs:{prop:"PurchNum",label:"采购数量"}}),t._v(" "),a("aui-table-column",{attrs:{prop:"DeployOrg",label:"布放机构"}}),t._v(" "),a("aui-table-column",{attrs:{prop:"HardwInfo",label:"硬件信息","show-overflow-tooltip":""}}),t._v(" "),t.option.isDisabled?t._e():a("aui-table-column",{attrs:{label:"操作",align:"center","class-name":"small-padding fixed-width",width:"160"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("aui-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){t.dataDel(e.$index,e.row)}}},[t._v("删除")])]}}])})],1)],1)],1)])},staticRenderFns:[]};var g=a("/Xao")(h,f,!1,function(t){a("iMtl")},"data-v-42621f37",null).exports,b=function t(){u()(this,t),this.data={PurchCtrtNo:"",PurchDate:"",AccepDate:"",ModelList:[]},this.CommCode="IBDeviceInfoManage",this.SceneCode="PurchPlanAccept",this.TransServiceCode="mg-afaservices-dev/purchPlanAccept"},v={props:{options:Object},data:function(){return{loading:!1,tabledata:[],productModelList:[],selectRows:[]}},methods:{openDevInfo:function(){var t=this;this.loading=!0;var e=new m;e.data.PurchCtrtNo=this.options.currentRow[0].purch_ctrt_no,Object(r.a)(e).then(function(e){if(e.RspInfo){t.loading=!1;var a=e.RspInfo.Result;t.productModelList=[];for(var r=0;r<a.length;r++){var o={ProductModel:a[r].ProductModel,AccepNum:"0",Producer:a[r].Producer,MaintBuss:a[r].MaintBuss,DeployOrg:a[r].DeployOrg};t.productModelList.push(o);for(var i=Number(a[r].PurchNum)-Number(a[r].AccepNum),s=0;s<i;s++){var n={ProductModel:a[r].ProductModel,Producer:a[r].Producer,MaintBuss:a[r].MaintBuss,EquipPerCost:a[r].EquipPerCost,DeprecLife:a[r].DeprecLife,HardwInfo:a[r].HardwInfo,Status:1};t.tabledata.push(n)}}}}).catch(function(e){t.loading=!1,console.log(e)})},clearForm:function(){this.tabledata=[]},sure:function(){for(var t=this,e=0;e<this.productModelList.length;e++)this.productModelList[e].AccepNum="0";if(this.selectRows.length>0){for(var a=0;a<this.selectRows.length;a++)for(var o=0;o<this.productModelList.length;o++)this.selectRows[a].ProductModel==this.productModelList[o].ProductModel&&(this.productModelList[o].AccepNum=Number(this.productModelList[o].AccepNum)+1+"");this.loading=!0;var s=new b;s.data.PurchCtrtNo=this.options.currentRow[0].purch_ctrt_no,s.data.PurchDate=this.options.currentRow[0].purch_dt,s.data.AccepDate=i.a.getDateTime("date"),s.data.AccepTime=i.a.getDateTime("time"),s.data.OperPerson=this.$store.getters.BranchNum,s.data.PurchOrg=this.options.currentRow[0].purch_org,s.data.ModelList=this.productModelList,console.log(s.data),Object(r.a)(s).then(function(e){t.$emit("refreshTable"),t.$aui.message.show({type:"success",message:"设备验收成功!"}),t.loading=!1,t.options.isShow=!1}).catch(function(e){t.$aui.message.show({type:"error",message:e.SYS_HEAD.ReturnMessage+"!"}),t.loading=!1,t.options.isShow=!1,console.log(e)})}else this.$aui.message.show({type:"warning",message:"请勾选要验收的设备！"})},dataFormat:function(t,e){if("Status"==e.property&&"1"==t[e.property])return"全未收"},handleSelectChange:function(t){this.selectRows=t}}},w={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("aui-dialog",{attrs:{title:"采购信息到货验收",visible:t.options.isShow,width:"70%","close-on-click-modal":!1},on:{"update:visible":function(e){t.$set(t.options,"isShow",e)},show:t.openDevInfo,hide:t.clearForm}},[a("aui-card",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}]},[a("aui-table",{ref:"form",staticClass:"tableMarginTop",attrs:{data:t.tabledata,border:"",width:"100%","header-row-class-name":"tableHeaderClass","highlight-current-row":""},on:{"selection-change":t.handleSelectChange}},[a("aui-table-column",{attrs:{type:"selection",width:"40px"}}),t._v(" "),a("aui-table-column",{attrs:{prop:"ProductModel",label:"产品型号"}}),t._v(" "),a("aui-table-column",{attrs:{prop:"Producer",label:"生产商"}}),t._v(" "),a("aui-table-column",{attrs:{prop:"MaintBuss",label:"维护商"}}),t._v(" "),a("aui-table-column",{attrs:{prop:"EquipPerCost",label:"设备单价"}}),t._v(" "),a("aui-table-column",{attrs:{prop:"DeprecLife",label:"折旧年限"}}),t._v(" "),a("aui-table-column",{attrs:{prop:"HardwInfo",label:"硬件信息"}}),t._v(" "),a("aui-table-column",{attrs:{prop:"Status",label:"状态",formatter:t.dataFormat}})],1)],1),t._v(" "),a("div",{staticStyle:{margin:"10px","text-align":"right"}},[a("aui-button",{attrs:{size:"mini"},on:{click:function(e){t.options.isShow=!1}}},[t._v("取消")]),t._v(" "),a("aui-button",{attrs:{type:"primary",size:"mini"},on:{click:t.sure}},[t._v("确定验收勾选设备")])],1)],1)},staticRenderFns:[]};var y=a("/Xao")(v,w,!1,function(t){a("SbK3")},"data-v-672c7fbd",null).exports,_=a("syAl"),D=function t(){u()(this,t),this.data={PurchCtrtNo:"",CtrtName:"",StartDate:"",EndDate:"",PurchStatus:"",PurchOrg:"",PageNum:"",Page:""},this.CommCode="IBDeviceInfoManage",this.SceneCode="PurchPlanInfoQuey",this.TransServiceCode="mg-afaservices-dev/purchasePlanQury"},P=function t(){u()(this,t),this.data={PurchCtrtNo:""},this.CommCode="IBDeviceInfoManage",this.SceneCode="PurchPlanDel",this.TransServiceCode="mg-afaservices-dev/purchPlanDel"},S={name:"type-info-manage",components:{selectTree:o.a},data:function(){return{pageSize:void 0,currentPage:1,total:0,isDisabledDel:!1,isDisabledUpd:!1,isCheckProduct:!1,loading:!1,brnoList:[],devInfoMgrQueryForm:{brno:[],state:"",endDate:"",startDate:"",purchaseNum:"",purchaseName:""},stateList:[{value:"0",label:"待提交"},{value:"1",label:"全未收"},{value:"2",label:"部分验收"},{value:"3",label:"已全收"}],dialogList:{createTypeInfo:g,devTransfer:y},dialogOptions:{isShow:!1,devForm:"",mark:""},transfersOptions:{isShow:!1,currentRow:[]},dataTypeInfo:[],scrapDialogVisible:!1,fileList:[],isCheck:!0,currentRow:[]}},created:function(){this.pageSize=_.a.get("PageSize"),this.initList()},watch:{devInfoMgrQueryForm:{handler:function(t,e){this.currentPage=1},deep:!0}},methods:{changePage:function(t){this.currentPage=t,this.purchaseQuery()},dateChange:function(){this.devInfoMgrQueryForm.startDate&&this.devInfoMgrQueryForm.endDate&&this.devInfoMgrQueryForm.startDate>this.devInfoMgrQueryForm.endDate&&this.$aui.message.show({type:"warning",message:"采购开始日期不能大于采购结束日期"})},initList:function(){var t=this;this.loading=!0;var e=new s.a;e.data.orgno=this.$store.getters.BranchNum,Object(r.a)(e).then(function(e){t.loading=!1,t.brnoList=e.RspInfo.Result||[],t.brnoMap=e.RspInfo.orgMap||{},t.brnoList=i.a.formatTreeData(t.brnoList,"orgno","superno")}).catch(function(e){t.loading=!1,console.error("查询错误",e)})},purchaseQuery:function(){var t=this;this.loading=!0,this.dataTypeInfo=[];var e=new D;e.data.PurchCtrtNo=this.devInfoMgrQueryForm.purchaseNum,e.data.CtrtName=this.devInfoMgrQueryForm.purchaseName,e.data.StartDate=this.devInfoMgrQueryForm.startDate,e.data.EndDate=this.devInfoMgrQueryForm.endDate,e.data.PurchStatus=this.devInfoMgrQueryForm.state,e.data.PurchOrg=this.devInfoMgrQueryForm.brno[0],e.data.Page=this.currentPage,e.data.PageNum=this.pageSize,Object(r.a)(e).then(function(e){console.log(e),t.loading=!1,e.RspInfo&&(t.dataTypeInfo=e.RspInfo.Result,t.total=e.RspInfo.TotalRcdCount)}).catch(function(e){t.$aui.message.show({type:"warning",message:""+e.SYS_HEAD.ReturnMessage}),t.loading=!1,t.dataTypeInfo=[],t.total=0,console.log(e)})},rowDate:function(t){this.currentRow=t,1==t.length?("0"==t[0].purch_stus?this.isDisabledDel=!0:this.isDisabledDel=!1,"1"==t[0].purch_stus||"2"==t[0].purch_stus?this.isCheckProduct=!0:this.isCheckProduct=!1,"0"==t[0].purch_stus?this.isDisabledUpd=!0:this.isDisabledUpd=!1):t.length>1?this.$refs.dataTypeInfo.toggleRowSelection(t[0]):(this.isDisabledDel=!1,this.isDisabledUpd=!1)},dataFormat:function(t,e){if("purch_stus"==e.property){if("0"==t[e.property])return"待提交";if("1"==t[e.property])return"全未收";if("2"==t[e.property])return"部分验收";if("3"==t[e.property])return"已全收"}if("purch_org"==e.property)return t[e.property]+"-"+t.brname},delDialogShow:function(){var t=this;this.$aui.confirm.show("此操作将永久删除该采购信息吗, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.devInfoDel()}).catch(function(){t.$aui.message.show({type:"info",message:"已取消删除"})})},devInfoDel:function(){var t=this;this.loading=!0;var e=new P;e.data.PurchCtrtNo=this.currentRow[0].purch_ctrt_no,Object(r.a)(e).then(function(e){t.loading=!1,t.purchaseQuery(),t.$aui.message.show({type:"success",message:"设备采购信息删除"+e.SYS_HEAD.ReturnMessage})}).catch(function(e){t.loading=!1,t.$aui.message.show({type:"warning",message:"删除失败！"+e.SYS_HEAD.ReturnMessage})})},handleCommand:function(t){"scrapDialogVisible"==t&&(this.transfersOptions.isShow=!0,this.transfersOptions.currentRow=this.currentRow),"detailDev"==t&&this.detailDialogShow()},resetForm:function(t){this.$refs[""+t].resetFields()},dialogShow:function(){this.dialogOptions.isShow=!0,this.dialogOptions.isDisabled=!1,this.dialogOptions.title="采购信息新建",this.dialogOptions.mark="1",this.dialogOptions.brnoList=this.brnoList},modDialogShow:function(){this.dialogOptions.isShow=!0,this.dialogOptions.isDisabled=!1,this.dialogOptions.currentRow=this.currentRow,this.dialogOptions.title="采购信息修改",this.dialogOptions.mark="2",this.dialogOptions.brnoList=this.brnoList},detailDialogShow:function(){this.dialogOptions.isShow=!0,this.dialogOptions.isDisabled=!0,this.dialogOptions.currentRow=this.currentRow,this.dialogOptions.title="详情查看",this.dialogOptions.mark="3",this.dialogOptions.brnoList=this.brnoList}}},M={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"type-info-manage",attrs:{"element-loading-text":"加载中。。。"}},[a("aui-card",{staticStyle:{overflow:"visible"}},[a("aui-form",{ref:"devInfoMgrQueryForm",attrs:{model:t.devInfoMgrQueryForm,size:"mini","label-position":"top"}},[a("aui-row",{attrs:{gutter:10}},[a("aui-col",{attrs:{lg:4,md:6}},[a("aui-form-item",{attrs:{label:"采购合同号",prop:"purchaseNum"}},[a("aui-input",{attrs:{placeholder:"请输入采购合同号"},model:{value:t.devInfoMgrQueryForm.purchaseNum,callback:function(e){t.$set(t.devInfoMgrQueryForm,"purchaseNum",e)},expression:"devInfoMgrQueryForm.purchaseNum"}})],1)],1),t._v(" "),a("aui-col",{attrs:{lg:4,md:6}},[a("aui-form-item",{attrs:{label:"合同名称",prop:"purchaseName"}},[a("aui-input",{attrs:{placeholder:"请输入合同名称"},model:{value:t.devInfoMgrQueryForm.purchaseName,callback:function(e){t.$set(t.devInfoMgrQueryForm,"purchaseName",e)},expression:"devInfoMgrQueryForm.purchaseName"}})],1)],1),t._v(" "),a("aui-col",{attrs:{lg:4,md:6}},[a("aui-form-item",{attrs:{label:"状态",prop:"state"}},[a("aui-select",{attrs:{filterable:"",placeholder:"请选择状态"},model:{value:t.devInfoMgrQueryForm.state,callback:function(e){t.$set(t.devInfoMgrQueryForm,"state",e)},expression:"devInfoMgrQueryForm.state"}},t._l(t.stateList,function(t){return a("aui-option",{key:t.value,attrs:{label:t.value+"-"+t.label,value:t.value}})}))],1)],1),t._v(" "),a("aui-col",{attrs:{lg:4,md:6}},[a("aui-form-item",{attrs:{label:"采购开始日期",prop:"startDate"}},[a("aui-date-picker",{attrs:{"value-format":"yyyyMMdd",align:"right",type:"date",placeholder:"选择日期"},on:{change:t.dateChange},model:{value:t.devInfoMgrQueryForm.startDate,callback:function(e){t.$set(t.devInfoMgrQueryForm,"startDate",e)},expression:"devInfoMgrQueryForm.startDate"}})],1)],1),t._v(" "),a("aui-col",{attrs:{lg:4,md:6}},[a("aui-form-item",{attrs:{label:"采购结束日期",prop:"endDate"}},[a("aui-date-picker",{attrs:{"value-format":"yyyyMMdd",align:"right",type:"date",placeholder:"选择日期"},on:{change:t.dateChange},model:{value:t.devInfoMgrQueryForm.endDate,callback:function(e){t.$set(t.devInfoMgrQueryForm,"endDate",e)},expression:"devInfoMgrQueryForm.endDate"}})],1)],1),t._v(" "),a("aui-col",{attrs:{lg:4,md:6}},[a("aui-form-item",{attrs:{label:"机构",prop:"brno"}},[a("select-tree",{staticStyle:{width:"170px"},attrs:{"single-check":!0,props:{id:"orgno",label:"cname",children:"children"},"tree-data":t.brnoList,placeholder:"请选择机构"},model:{value:t.devInfoMgrQueryForm.brno,callback:function(e){t.$set(t.devInfoMgrQueryForm,"brno",e)},expression:"devInfoMgrQueryForm.brno"}})],1)],1)],1)],1)],1),t._v(" "),a("aui-card",{staticClass:"type-info-bottom"},[a("aui-row",[a("aui-col",{staticClass:"searchBtnMarginTop",attrs:{lg:2,md:3}},[a("aui-button",{attrs:{type:"primary",size:"mini",icon:"aui-icon-search"},on:{click:t.purchaseQuery}},[t._v("查询")])],1),t._v(" "),a("aui-col",{staticClass:"searchBtnMarginTop",attrs:{lg:2,md:3}},[a("aui-button",{attrs:{type:"warning",size:"mini",icon:"aui-icon-refresh"},on:{click:function(e){t.resetForm("devInfoMgrQueryForm")}}},[t._v("重置")])],1),t._v(" "),a("aui-col",{attrs:{lg:2,md:3}},[a("aui-button",{staticClass:"b-button",attrs:{type:"primary",size:"mini",icon:"aui-icon-plus",disabled:1==t.currentRow.length},on:{click:t.dialogShow}},[t._v("新建")])],1),t._v(" "),a("aui-col",{attrs:{lg:2,md:3}},[a("aui-button",{staticClass:"b-button",attrs:{type:"primary",size:"mini",icon:"aui-icon-edit",disabled:!t.isDisabledUpd},on:{click:t.modDialogShow}},[t._v("修改")])],1),t._v(" "),a("aui-col",{attrs:{lg:2,md:3}},[a("aui-button",{staticClass:"b-button",attrs:{type:"danger",size:"mini",icon:"aui-icon-delete",disabled:!t.isDisabledDel},on:{click:t.delDialogShow}},[t._v("删除")])],1),t._v(" "),a("aui-col",{attrs:{lg:2,md:3}},[a("aui-dropdown",{attrs:{trigger:"click"},on:{command:t.handleCommand}},[a("aui-button",{attrs:{type:"primary",size:"mini",disabled:!(1==t.currentRow.length)}},[t._v("\n            更多操作"),a("i",{staticClass:"aui-icon-arrow-down aui-icon--right"})]),t._v(" "),a("aui-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("aui-dropdown-item",{attrs:{command:"detailDev"}},[t._v("查看")]),t._v(" "),a("aui-dropdown-item",{attrs:{command:"scrapDialogVisible",disabled:!t.isCheckProduct}},[t._v("到货验收")])],1)],1)],1)],1),t._v(" "),a("aui-table",{ref:"dataTypeInfo",staticClass:"tableMarginTop",staticStyle:{"min-height":"392px"},attrs:{data:t.dataTypeInfo,border:"",width:"100%","header-row-class-name":"tableHeaderClass","highlight-current-row":""},on:{"selection-change":t.rowDate}},[a("aui-table-column",{attrs:{type:"selection",width:"40px"}}),t._v(" "),a("aui-table-column",{attrs:{prop:"purch_ctrt_no",label:"采购合同号","show-overflow-tooltip":""}}),t._v(" "),a("aui-table-column",{attrs:{prop:"ctrt_nm",label:"合同名称"}}),t._v(" "),a("aui-table-column",{attrs:{prop:"ctrt_amt",label:"合同金额"}}),t._v(" "),a("aui-table-column",{attrs:{prop:"purch_dt",label:"采购日期"}}),t._v(" "),a("aui-table-column",{attrs:{prop:"splr_nm",label:"供应商名称"}}),t._v(" "),a("aui-table-column",{attrs:{prop:"purch_org",label:"采购机构",formatter:t.dataFormat}}),t._v(" "),a("aui-table-column",{attrs:{prop:"purch_stus",label:"状态",formatter:t.dataFormat}}),t._v(" "),a("aui-table-column",{attrs:{prop:"purch_person_name",label:"采购人"}})],1),t._v(" "),a("div",{staticStyle:{"text-align":"right","margin-top":"20px"}},[a("aui-pagination",{attrs:{background:"","page-size":t.pageSize,"current-page":t.currentPage,layout:"total, prev, pager, next, jumper",total:t.total},on:{"current-change":t.changePage}})],1)],1),t._v(" "),a("keep-alive",[a(t.dialogList.createTypeInfo,{tag:"component",attrs:{option:t.dialogOptions},on:{refreshTable:t.purchaseQuery}})],1),t._v(" "),a("keep-alive"),t._v(" "),a("keep-alive",[a(t.dialogList.devTransfer,{tag:"component",attrs:{options:t.transfersOptions},on:{refreshTable:t.purchaseQuery}})],1)],1)},staticRenderFns:[]};var C=a("/Xao")(S,M,!1,function(t){a("3F4b")},"data-v-190a9ee3",null);e.default=C.exports},iMtl:function(t,e,a){var r=a("OsTG");"string"==typeof r&&(r=[[t.i,r,""]]),r.locals&&(t.exports=r.locals);a("8bSs")("e06a4c34",r,!0)}});