webpackJsonp([140],{"1cPE":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("lC5x"),i=a.n(r),n=a("J0Oq"),s=a.n(n),o=a("syAl"),u=a("0oES"),c=a("pADA"),m=a("tzsN"),l=a("0VOF"),h=a("AA3o"),p=a.n(h),d=function e(){p()(this,e),this.data={BusiOper:"Q",BRNO:"",BSIDTP:"1"},this.BusiDataKey="sel_type_bs_yuyue",this.TransServiceCode="ib-dbcomm/dbComm"},f=function e(){p()(this,e),this.data={Info:"",OperType:"WH",Brno:"",ReserveBsId:""},this.CommCode="CRReservationSystem",this.SceneCode="BrchReserveParaMaint",this.TransServiceCode="mg-afaservices-rsv/appointtimemanaage"},v=function e(){p()(this,e),this.data={OperType:"Q",Brno:"",ReserveBsId:""},this.CommCode="CRReservationSystem",this.SceneCode="BrchReserveParaMaint",this.TransServiceCode="mg-afaservices-rsv/appointtimemanaage"},g=function e(){p()(this,e),this.data={BusiOper:"Q",DataKey:"ReservTime"},this.TransServiceCode="ib-dbcomm/dbComm"},b={name:"",components:{selectTree:m.a},data:function(){return{brnoList:[],currentRow:[],typeList:[],brnoName:{},branchNum:[],brnoName1:{},form:{branchNum:[],DeviceTypeNum:""},loading:!1,brno:[],tableData:[],totalRcrdNum:0,currentPage:1,pageSize:o.a.get("PageSize"),rules:{DeviceTypeNum:[{required:!0,message:"业务类型编码不能为空",trigger:"blur"}],branchNum:[{required:!0,message:"机构号不能为空",trigger:"blur"}]},CheckReserveMaxNum:!1}},watch:{"form.branchNum":function(e){this.$refs.form.clearValidate(),this.typeList1()}},created:function(){this.initList()},mounted:function(){},methods:{dataFormat:function(e,t){return"Brno"==t.property?e[t.property]+"-"+this.brnoMap[e[t.property]]:"IsQueue"==t.property?this.enum[e[t.property]]:void 0},dataFormat1:function(e,t){for(var a=0;a<this.typeList.length;a++)if(this.typeList[a].BsID==e[t.property])return this.typeList[a].BsID+"-"+this.typeList[a].BsName},initList:function(){var e=this;this.loading=!0;var t=new l.a;t.data.orgno=this.$store.getters.BranchNum,Object(u.a)(t).then(function(t){e.loading=!1,e.branchNum=t.RspInfo.Result||[],e.brnoList=t.RspInfo.Result||[],e.brnoMap=t.RspInfo.orgMap||{},e.brnoList=c.a.formatTreeData(e.brnoList,"orgno","superno")}).catch(function(t){e.loading=!1,e.$aui.message.show({type:"warning",message:t.SYS_HEAD.ReturnMessage}),console.error("查询错误",t)})},typeList1:function(){var e=this;this.loading=!0;var t=new d;t.data.BRNO=this.form.branchNum[0],Object(u.a)(t).then(function(t){e.loading=!1,e.typeList=t.RspInfo.Result;for(var a=0;a<e.typeList.length;a++)e.brnoName1[e.typeList[a].BsID]=e.typeList[a].BsName,console.log("===",e.typeList[a]);e.form.DeviceTypeNum=e.typeList[0].BsID}).catch(function(t){e.loading=!1,e.$aui.message.show({type:"warning",message:"提示:该机构下没有业务类型编码"}),e.form.DeviceTypeNum=""})},formatter:function(e,t){},submit:function(){var e=this;if(this.CheckReserveMaxNum){this.loading=!0;var t=new f;this.tableData,0;for(var a=[],r=0;r<this.tableData.length;r++)if(null!=this.tableData[r].ReserveMaxNum&&""!=this.tableData[r].ReserveMaxNum){var i=this.tableData[r],n={Brno:this.form.branchNum[0],ReserveEndTime:i.ReserveEndTime,ReserveStartTime:i.ReserveStartTime,ReserveMaxNum:i.ReserveMaxNum};a.push(n)}t.data.Info=a,t.data.Brno=this.form.branchNum[0],t.data.ReserveBsId=this.form.DeviceTypeNum,Object(u.a)(t).then(function(t){e.loading=!1,e.$aui.message.show({type:"success",message:"时段预约人数修改成功!"}),e.queryModel()}).catch(function(t){e.loading=!1,e.$aui.message.show({type:"warning",message:"时段预约人数修改失败!"})})}else this.$aui.message.show({type:"warning",message:"预约最大人数最大值为10，最小值为0!"})},queryModel:function(){var e=this;this.loading=!0,this.tableData=[],this.$refs.form.validate(function(t){if(!t)return e.loading=!1,e.$aui.message.show({type:"warning",message:"查询条件不能为空"}),!1;e.loading=!0;var a=new v;a.data.Brno=e.form.branchNum[0],a.data.ReserveBsId=e.form.DeviceTypeNum,Object(u.a)(a).then(function(t){e.loading=!1;var a=t.RspInfo.pageList||[];e.queryModel1(a)}).catch(function(t){e.loading=!1,console.log(t)})})},queryModel1:function(e){var t=this;this.$refs.form.validate(function(a){if(a){t.loading=!0;var r=new g;r.data.DataKey="ReservTime",r.data.BusiOper="Q",r.BusiDataKey="sel_t_datadict",r.TransServiceCode="ib-dbcomm/dbComm",Object(u.a)(r).then(function(a){t.loading=!1;var r=a.RspInfo.Result;t.tableData=[];for(var i=0;i<r.length;i++){for(var n=r[i],s={Brno:t.form.branchNum[0],ReserveBsId:t.form.DeviceTypeNum,ReserveEndTime:n.Meaning.split("-")[1],ReserveStartTime:n.Meaning.split("-")[0],ReserveMaxNum:""},o=0;o<e.length;o++){e[o];s.ReserveStartTime===c.a.timeFormat2Time(e[o].ReserveStartTime)&&(s.ReserveMaxNum=e[o].ReserveMaxNum)}t.tableData.push(s)}}).catch(function(e){t.loading=!1,t.$aui.message.show({type:"warning",message:e.SYS_HEAD.ReturnMessage})})}})},getExcel:function(){var e=this;return s()(i.a.mark(function t(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},t,e)}))()},handleSizeChange:function(){},handleCurrentChange:function(e){this.currentRow=e},changePage:function(e){this.currentPage=e,this.queryModel()},ReserveMaxNumCheck:function(e){e.row.ReserveMaxNum&&(/^[0-9]|10$/.test(e.row.ReserveMaxNum)?Number(e.row.ReserveMaxNum)>10?this.CheckReserveMaxNum=!1:this.CheckReserveMaxNum=!0:this.CheckReserveMaxNum=!1)}}},y={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"boot-rate-form-manage",attrs:{"element-loading-text":"加载中。。。"}},[a("div",[a("aui-card",{staticClass:"type-info-box-card"},[a("aui-form",{ref:"form",attrs:{model:e.form,rules:e.rules,size:"mini","label-position":"top"}},[a("aui-row",{attrs:{gutter:10}},[a("aui-col",{attrs:{md:6,lg:4}},[a("aui-form-item",{attrs:{label:"机构编号",prop:"branchNum"}},[a("select-tree",{staticStyle:{width:"170px"},attrs:{"single-check":!0,props:{id:"orgno",label:"cname",children:"children"},"tree-data":e.brnoList,placeholder:"请选择机构"},model:{value:e.form.branchNum,callback:function(t){e.$set(e.form,"branchNum",t)},expression:"form.branchNum"}})],1)],1),e._v(" "),a("aui-col",{attrs:{md:6,lg:4}},[a("aui-form-item",{attrs:{label:"业务类型编码",prop:"DeviceTypeNum"}},[a("aui-select",{model:{value:e.form.DeviceTypeNum,callback:function(t){e.$set(e.form,"DeviceTypeNum",t)},expression:"form.DeviceTypeNum"}},e._l(e.typeList,function(e){return a("aui-option",{key:e.BsID,attrs:{label:e.Brno+"-"+e.BsName,value:e.BsID,disabled:e.disabled}})}))],1)],1),e._v(" "),a("aui-col",{staticClass:"searchBtnMarginTop",attrs:{md:3,lg:2}},[a("aui-button",{attrs:{type:"primary",size:"mini",icon:"aui-icon-search"},on:{click:e.queryModel}},[e._v("查询")])],1),e._v(" "),a("aui-col",{staticClass:"searchBtnMarginTop",attrs:{md:3,lg:2}},[a("aui-button",{attrs:{type:"primary",size:"mini",icon:"aui-icon-plus"},on:{click:e.submit}},[e._v("提交")])],1)],1)],1)],1),e._v(" "),a("aui-card",[a("aui-table",{ref:"table",staticClass:"tableMarginTop",staticStyle:{"min-height":"390px"},attrs:{data:e.tableData,border:"","highlight-current-row":"","header-row-class-name":"tableHeaderClass"},on:{"selection-change":e.handleCurrentChange}},[a("aui-table-column",{attrs:{prop:"Brno",formatter:e.dataFormat,label:"\t机构号"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"ReserveBsId",formatter:e.dataFormat1,label:"业务类型编码"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"ReserveStartTime",label:"预约开始时间"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"ReserveEndTime",label:"预约结束时间"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"ReserveMaxNum",label:"时段内预约最大人数"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("aui-input",{attrs:{maxlength:2},on:{change:function(a){e.ReserveMaxNumCheck(t)}},model:{value:t.row.ReserveMaxNum,callback:function(a){e.$set(t.row,"ReserveMaxNum",a)},expression:"scope.row.ReserveMaxNum"}})]}}])})],1)],1)],1)])},staticRenderFns:[]};var R=a("/Xao")(b,y,!1,function(e){a("HZOk")},null,null);t.default=R.exports},HZOk:function(e,t,a){var r=a("NIUT");"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);a("8bSs")("8f4b7988",r,!0)},NIUT:function(e,t,a){(e.exports=a("BkJT")(!1)).push([e.i,"\n.type-info-bottom {\n  margin-top: 10px;\n}\n.box {\n  margin-top: 20px;\n  text-align: right;\n}\n.headerClass {\n  background: #f7f7f7 !important;\n}\n.aui-date-editor.aui-input {\n  width: 100% !important;\n}\n.aui-card {\n  overflow: inherit;\n}\n",""])}});