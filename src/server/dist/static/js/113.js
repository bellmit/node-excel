webpackJsonp([113],{L2l0:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("tzsN"),r=a("pADA"),i=a("0oES"),o=a("syAl"),l=a("0VOF"),s=a("AA3o"),u=a.n(s),d=function t(){u()(this,t),this.data={BusiOper:"Q"},this.BusiDataKey="queryAddUkey",this.TransServiceCode="ib-dbcomm/dbComm"},c=a("+V+J"),m={components:{selectTree:n.a},data:function(){return{vouList:"",filename:"加盾记录查询导出",brnoList:[],formInline:{startdate:"",enddate:"",devNum:void 0,branchNum:[]},currentPage:1,loading:!1,tableData3:[],tableTotal:0,pickerOptionsStart:{disabledDate:function(t){(new Date).getTime();return t.getTime()>Date.now()}}}},created:function(){this.formInline.startdate=r.a.getNowTime(29),this.formInline.enddate=r.a.getNowTime(0),this.pageSize=o.a.get("PageSize"),this.vouTypeList(),this.initBrno()},watch:{formInline:{handler:function(t,e){this.currentPage=1},deep:!0}},methods:{vouTypeList:function(){var t=this,e=new c.a;Object(i.a)(e).then(function(e){t.vouList=e.RspInfo.Result||[]}).catch(function(t){})},dFormat:function(t,e){return r.a.timeFormat2Date(t[e.property])},tFormat:function(t,e){return r.a.timeFormat2Time(t[e.property])},dataFormat:function(t,e){if("UKEY_KIND_CD"==e.property){for(var a=0;a<this.vouList.length;a++)if(t[e.property]==this.vouList[a].UKEY_KIND_CD)return t[e.property]+"-"+this.vouList[a].UKEY_NM;return t[e.property]}},dateChange:function(){this.formInline.startdate>this.formInline.enddate?(this.$aui.message.show({type:"warning",message:"开始日期不能大于结束日期"}),this.formInline.startdate=r.a.getNowTime(29),this.formInline.enddate=r.a.getNowTime(0)):this.formInline.startdate<r.a.getNowTime(365)&&(this.$aui.message.show({type:"warning",message:"开始日期不能超过当日前12个月"}),this.formInline.startdate=r.a.getNowTime(365))},initBrno:function(){var t=this;this.loading=!0;var e=new l.a;e.data.orgno=this.$store.getters.BranchNum,Object(i.a)(e).then(function(e){t.loading=!1,t.branchNum=e.RspInfo.Result||[],t.permission=r.a.objArray2Hash(t.branchNum,"orgno"),t.brnoMap=e.RspInfo.orgMap||{},t.brnoList=r.a.formatTreeData(t.branchNum,"orgno","superno"),t.formInline.branchNum.push(t.brnoList[0].orgno)}).catch(function(e){t.loading=!1,t.$aui.message.show({type:"warning",message:e.SYS_HEAD.ReturnMessage}),console.error("查询错误",e)})},handleSizeChange:function(t){console.log("每页 "+t+" 条")},handleCurrentChange:function(t){console.log("当前页: "+t),this.queryInfoList()},queryInfoList:function(){var t=this;this.$refs.formInline.validate(function(e){if(e){t.loading=!0;var a=new d;a.data.sdate=t.formInline.startdate,a.data.edate=t.formInline.enddate,a.data.orgno=t.formInline.branchNum[0],a.data.equipno=t.formInline.devNum,a.data.CurtPage=t.currentPage+"",a.data.PageSize=t.pageSize+"",a.data.StartRows=(t.currentPage-1)*t.pageSize+"",Object(i.a)(a).then(function(e){t.tableData3=e.RspInfo.Result||[],t.tableTotal=e.RspInfo.totalNum||0,t.loading=!1,"0"==t.tableTotal&&t.$aui.message.show({type:"warning",message:"无满足条件的记录"})}).catch(function(e){t.$aui.message.show({type:"error",message:"请求失败，错误码:"+e.SYS_HEAD.ReturnCode+"，错误信息："+e.SYS_HEAD.ReturnMessage}),t.loading=!1,t.tableData3=[],t.tableTotal=0,console.error("查询错误",e)})}})},getExcel:function(){var t=this;this.loading=!0;var e=new d;e.data.sdate=this.formInline.startdate,e.data.edate=this.formInline.enddate,e.data.orgno=this.formInline.branchNum[0],e.data.equipno=this.formInline.devNum,e.data.CurtPage="1",e.data.PageSize="50000000",e.data.StartRows="",Object(i.a)(e).then(function(e){t.loading=!1,t.list1=e.RspInfo.Result||[],t.handleDownload()}).catch(function(e){t.loading=!1,t.$aui.message.show({type:"warning",message:"请求失败，错误码:"+e.SYS_HEAD.ReturnCode+"，错误信息："+e.SYS_HEAD.ReturnMessage}),console.error("查询错误",e)})},handleDownload:function(){var t=this;a.e(169).then(a.bind(null,"FNRk")).then(function(e){var a=t.list1,n=t.formatJson(["PLATFM_SN","PLATFM_WORK_DT","PLATFM_WORK_TM","ORG_NO","ORG_NM","EQUIP_NO","shieldboxno","UKEY_KIND_CD","voucherbusitype","VOUCH_NO","QTY","VRTL_TELR_NO","REMRK"],a);e.export_json_to_excel({header:["业务流水号","加盾日期","加盾时间","机构号","机构名称","设备编号","盾箱号","凭证种类代码","冠字号","凭证号段","加盾数量","操作柜员号","备注"],data:n,filename:t.filename,autoWidth:t.autoWidth,bookType:t.bookType})})},formatJson:function(t,e){return e.map(function(e){return t.map(function(t){return"timestamp"===t?parseTime(e[t]):e[t]})})},resetForm:function(t){this.formInline.branchNum=[],this.$refs[t].resetFields()}}},p={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{"element-loading-text":"拼命加载中"}},[a("aui-card",{staticStyle:{"margin-bottom":"10px",overflow:"visible"}},[a("aui-form",{ref:"formInline",attrs:{model:t.formInline,"label-position":"top",size:"mini"}},[a("aui-row",{attrs:{gutter:10}},[a("aui-col",{attrs:{md:6,lg:4}},[a("aui-form-item",{attrs:{label:"机构",prop:"branchNum"}},[a("select-tree",{staticStyle:{width:"170px"},attrs:{"single-check":!0,props:{id:"orgno",label:"cname",children:"children"},"tree-data":t.brnoList,placeholder:"请选择机构"},model:{value:t.formInline.branchNum,callback:function(e){t.$set(t.formInline,"branchNum",e)},expression:"formInline.branchNum"}})],1)],1),t._v(" "),a("aui-col",{attrs:{md:6,lg:4}},[a("aui-form-item",{attrs:{label:"开始日期",prop:"startdate"}},[a("aui-date-picker",{attrs:{editable:!1,clearable:!1,"picker-options":t.pickerOptionsStart,"value-format":"yyyyMMdd",type:"date",placeholder:"选择日期"},on:{change:t.dateChange},model:{value:t.formInline.startdate,callback:function(e){t.$set(t.formInline,"startdate",e)},expression:"formInline.startdate"}})],1)],1),t._v(" "),a("aui-col",{attrs:{md:6,lg:4}},[a("aui-form-item",{attrs:{label:"结束日期",prop:"enddate"}},[a("aui-date-picker",{attrs:{editable:!1,clearable:!1,"picker-options":t.pickerOptionsStart,"value-format":"yyyyMMdd",type:"date",placeholder:"选择日期"},on:{change:t.dateChange},model:{value:t.formInline.enddate,callback:function(e){t.$set(t.formInline,"enddate",e)},expression:"formInline.enddate"}})],1)],1),t._v(" "),a("aui-col",{attrs:{md:6,lg:4}},[a("aui-form-item",{attrs:{label:"设备编号",prop:"devNum"}},[a("aui-input",{attrs:{placeholder:"请输入设备编号"},model:{value:t.formInline.devNum,callback:function(e){t.$set(t.formInline,"devNum",e)},expression:"formInline.devNum"}})],1)],1),t._v(" "),a("aui-col",{staticClass:"searchBtnMarginTop",attrs:{md:3,lg:2}},[a("aui-form-item",[a("aui-button",{attrs:{type:"primary",icon:"aui-icon-search"},on:{click:t.queryInfoList}},[t._v("查询")])],1)],1),t._v(" "),a("aui-col",{staticClass:"searchBtnMarginTop",attrs:{lg:2,md:3}},[a("aui-form-item",[a("aui-button",{attrs:{type:"warning",icon:"aui-icon-refresh"},on:{click:function(e){t.resetForm("formInline")}}},[t._v("重置")])],1)],1),t._v(" "),a("aui-col",{staticClass:"searchBtnMarginTop",attrs:{lg:2,md:3}},[a("aui-form-item",[t.btnPermission("Button_AddCardQue_Export")?a("aui-button",{attrs:{type:"primary",icon:"aui-icon-download"},on:{click:t.getExcel}},[t._v("导出")]):t._e()],1)],1)],1)],1)],1),t._v(" "),a("aui-card",[a("aui-table",{attrs:{data:t.tableData3,height:"390","header-row-class-name":"tableHeaderClass",border:""}},[a("aui-table-column",{attrs:{fixed:"",prop:"PLATFM_SN",label:"业务流水号",width:"130"}}),t._v(" "),a("aui-table-column",{attrs:{prop:"PLATFM_WORK_DT",label:"加盾日期",width:"100"}}),t._v(" "),a("aui-table-column",{attrs:{prop:"PLATFM_WORK_TM",label:"加盾时间",width:"80"}}),t._v(" "),a("aui-table-column",{attrs:{prop:"ORG_NO",label:"机构号",width:"100"}}),t._v(" "),a("aui-table-column",{attrs:{prop:"ORG_NM",label:"机构名称",width:"100"}}),t._v(" "),a("aui-table-column",{attrs:{prop:"EQUIP_NO",label:"设备编号",width:"120"}}),t._v(" "),a("aui-table-column",{attrs:{prop:"shieldboxno",label:"盾箱号",width:"100"}}),t._v(" "),a("aui-table-column",{attrs:{prop:"UKEY_KIND_CD",formatter:t.dataFormat,label:"凭证种类代码",width:"120"}}),t._v(" "),a("aui-table-column",{attrs:{prop:"voucherbusitype",label:"冠字号",width:"120"}}),t._v(" "),a("aui-table-column",{attrs:{prop:"VOUCH_NO",label:"凭证号段",width:"180"}}),t._v(" "),a("aui-table-column",{attrs:{prop:"QTY",label:"加盾数量",width:"80"}}),t._v(" "),a("aui-table-column",{attrs:{prop:"VRTL_TELR_NO",label:"操作柜员",width:"120"}}),t._v(" "),a("aui-table-column",{attrs:{prop:"REMRK",label:"备注","min-width":"150"}})],1),t._v(" "),a("aui-pagination",{staticStyle:{"text-align":"right","margin-top":"20px"},attrs:{"current-page":t.currentPage,background:"",layout:"total, prev, pager, next, jumper",total:t.tableTotal},on:{"current-change":t.handleCurrentChange,"update:currentPage":function(e){t.currentPage=e}}})],1)],1)},staticRenderFns:[]};var h=a("/Xao")(m,p,!1,function(t){a("N/En")},null,null);e.default=h.exports},"N/En":function(t,e,a){var n=a("Xptn");"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);a("8bSs")("f724f744",n,!0)},Xptn:function(t,e,a){(t.exports=a("BkJT")(!1)).push([t.i,"\n.aui-date-editor.aui-input,\n.aui-date-editor.el-input__inner {\n  width: 100%;\n}\n\n",""])}});