webpackJsonp([57],{"6JUn":function(e,t,a){var n=a("W4cl");"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);a("8bSs")("7f890434",n,!0)},HZAa:function(e,t,a){(e.exports=a("BkJT")(!1)).push([e.i,"\n.aui-date-editor.aui-input[data-v-60126b27],\r\n.aui-date-editor.el-input__inner[data-v-60126b27] {\r\n  width: 100%;\n}\r\n",""])},W4cl:function(e,t,a){(e.exports=a("BkJT")(!1)).push([e.i,"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",""])},aF1d:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("0oES"),r=a("syAl"),i=a("pADA"),o=a("tzsN"),s=a("udOb"),l=a("Luip"),u=a("AA3o"),c=a.n(u),d=function e(){c()(this,e),this.data={versionCode:"",isEffective:"",verUpdatePrepareTime:"",verUpdateInterval:"",verUpdateDevNum:"",verUpdatePattern:"",verUpdateDevList:"",branchNo:""},this.TransServiceCode="mg-afaservices-vsn/releaseBydev"},v=function e(){c()(this,e),this.data={versionCode:"",isEffective:"",verUpdatePrepareTime:"",verUpdateInterval:"",verUpdateDevNum:"",verUpdatePattern:"",verUpdateBrnoList:"",branchNo:""},this.TransServiceCode="mg-afaservices-vsn/releaseBybrno"},p=function e(){c()(this,e),this.data={versionCode:"",isEffective:"",verUpdatePrepareTime:"",verUpdateInterval:"",verUpdateDevNum:"",verUpdatePattern:"",appNum:"",branchNo:""},this.TransServiceCode="mg-afaservices-vsn/releaseByapp"},m=function e(){c()(this,e),this.data={},this.TransServiceCode="mg-afaservices-vsn/releaseDevinfoQuery"},f=a("qfSh"),h={components:{selectTree:o.a},props:{option:Object},data:function(){return{appQueryList:[],loading:!1,isdatenow:!1,pageSize:r.a.get("PageSize"),tableTotal:0,verBaseInfo:[],brnoList:[],areaList:[],brno:[],verUpdateDevList:[],form:{brmo:[],selBrno:[],versionCode:"",area:"",isEffective:2,verUpdatePrepareTime:"",verUpdateInterval:"",verUpdateDevNum:""},rules:{versionCode:[{required:!0,message:"请选择版本编号",trigger:"blur"}],area:[{required:!0,message:"请选择分组",trigger:"blur"}],selBrno:[{required:!0,validator:function(e,t,a){0===t.length?a(new Error("请选择机构号")):a()},trigger:"blur"}],isEffective:[{required:!0,message:"请选择是否立即生效",trigger:"blur"}],verUpdatePrepareTime:[{required:!0,message:"请选择预计发布时间",trigger:"blur"}],verUpdateInterval:[{required:!0,message:"请输入升级间隔时间",trigger:"blur"},{validator:function(e,t,a){isNaN(t)?a(new Error("请输入数字")):t>600||t<10?a(new Error("请输入10~600之间的数字")):a()},trigger:"blur"}],verUpdateDevNum:[{required:!0,message:"请输入单次升级数量",trigger:"blur"},{validator:function(e,t,a){isNaN(t)?a(new Error("请输入数字")):t>100||t<0?a(new Error("请输入0~100之间的数字")):a()},trigger:"blur"}]},dateDefined:"",currentPage:1,radio:0,active:0,devTableData:[{}]}},computed:{isShow:{get:function(){return this.option.versionReleaseIsShow},set:function(e){this.option.versionReleaseIsShow=e}}},created:function(){this.initList(),this.initSpinnerDataList(),this.queryInfoList()},methods:{openInit:function(){this.appQueryInit()},appQueryInit:function(){var e=this,t=new f.a;t.data.UserNum=this.$store.getters.UserNum,Object(n.a)(t).then(function(t){e.appQueryList=t.RspInfo.Result}).catch(function(e){console.error("查询错误",e)})},initList:function(){var e=this,t=new s.a;t.data.start=0,t.data.length=99999,Object(n.a)(t).then(function(t){e.brno=[];var a=t.RspInfo.pageList||[];e.brno=i.a.formatTreeData(a,"branchnum","supebranchnum"),e.loading=!1}).catch(function(t){e.$aui.message.show({type:"success",message:t.SYS_HEAD.ReturnMessage+"!"}),e.loading=!1})},initSpinnerDataList:function(){var e=this,t=new l.a;Object(n.a)(t).then(function(t){e.verBaseInfo=t.RspInfo.verDropBoxList||[]}).catch(function(e){console.error("查询错误",e)})},radioChange:function(e){1===e?(this.form.verUpdatePrepareTime=this.getdatetime(),this.isdatenow=!0):(this.form.verUpdatePrepareTime="",this.isdatenow=!1)},getdatetime:function(){var e=new Date;return e.getFullYear()+this.ifdouble((e.getMonth()+1).toString())+this.ifdouble(e.getDate().toString())+this.ifdouble(e.getHours().toString())+this.ifdouble(e.getMinutes().toString())+this.ifdouble(e.getSeconds().toString())},ifdouble:function(e){return 2===e.length?e:"0"+e},initselBrno:function(){this.$refs.form.clearValidate(),this.form.area="",this.form.selBrno=[],this.verUpdateDevList=[]},queryInfoList:function(){var e=this,t=new m;t.data.QueryRowNum=this.pageSize,t.data.QueryPageNo=this.currentPage,Object(n.a)(t).then(function(t){e.devTableData=t.RspInfo.verUpdateDevInfoList,e.tableTotal=Number(t.RspInfo.QueryAllDataCount||e.tableData.length)}).catch(function(t){e.$aui.message.show({message:t.SYS_HEAD.ReturnMessage,type:"error"}),console.log("error",t)})},handleSizeChange:function(){this.queryInfoList()},handleCurrentChange:function(){this.queryInfoList()},handleSelectionChange:function(e){for(var t=0;t<e.length;t++)this.verUpdateDevList[t]=e[t].devid},closeCallback:function(){var e=this;this.active=0,this.radio=0,this.verUpdateDevList=[],this.form.versionCode="",this.form.area="",this.form={selBrno:[],versionCode:"",area:"",isEffective:2,verUpdatePrepareTime:"",verUpdateInterval:"",verUpdateDevNum:""},this.$nextTick(function(){e.$refs.form.clearValidate()})},next:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return t.$aui.message.show({message:"请完善信息",type:"warning"}),!1;2==t.radio&&0===t.verUpdateDevList.length?t.$aui.message.show("请至少选择一个设备"):t.active++>0&&(t.active=0)})},back:function(){this.verUpdateDevList=[],this.$refs.form.clearValidate(),this.active>=0&&this.active--},sure:function(e){var t=this;this.$refs.form.validate(function(e){if(!e)return t.$aui.message.show({message:"请完善信息",type:"warning"}),!1;if(t.loading=!0,2===t.radio){var a=new d;a.data.versionCode=t.form.versionCode,a.data.isEffective=t.form.isEffective+"",a.data.verUpdatePrepareTime=t.form.verUpdatePrepareTime,a.data.verUpdateInterval=t.form.verUpdateInterval,a.data.verUpdateDevNum=t.form.verUpdateDevNum,a.data.verUpdatePattern=t.radio+"",a.data.branchNo=t.$store.getters.BranchNum,a.data.verUpdateDevList=t.verUpdateDevList,console.log("第二步",a),Object(n.a)(a).then(function(e){t.verUpdateDevList=[],t.loading=!1,t.$parent.initSpinnerList(),t.$parent.currentPage=1,t.$parent.queryInfoList(),console.log(e),t.isShow=!1,t.$aui.message.show({message:"版本发布成功！",type:"success"})}).catch(function(e){t.loading=!1,t.$aui.message.show({message:e.SYS_HEAD.ReturnMessage,type:"error"}),console.log("error",e)})}else if(1===t.radio){var r=new v;r.data.versionCode=t.form.versionCode,r.data.isEffective=t.form.isEffective+"",r.data.verUpdatePrepareTime=t.form.verUpdatePrepareTime,r.data.verUpdateInterval=t.form.verUpdateInterval,r.data.verUpdateDevNum=t.form.verUpdateDevNum,r.data.verUpdatePattern=t.radio+"",r.data.branchNo=t.$store.getters.BranchNum,r.data.verUpdateBrnoList=t.form.brmo,t.form.selBrno=[],console.log("机构发布",r),Object(n.a)(r).then(function(e){t.loading=!1,t.$parent.initSpinnerList(),t.$parent.currentPage=1,t.$parent.queryInfoList(),t.isShow=!1,t.$aui.message.show({message:"版本发布成功！",type:"success"})}).catch(function(e){t.loading=!1,t.$aui.message.show({message:e.SYS_HEAD.ReturnMessage,type:"error"}),console.log("error",e)})}else{var i=new p;i.data.versionCode=t.form.versionCode,i.data.isEffective=t.form.isEffective+"",i.data.verUpdatePrepareTime=t.form.verUpdatePrepareTime,i.data.verUpdateInterval=t.form.verUpdateInterval,i.data.verUpdateDevNum=t.form.verUpdateDevNum,i.data.verUpdatePattern=t.radio+"",i.data.branchNo=t.form.brmo,i.data.appNum=t.form.AppNum,Object(n.a)(i).then(function(e){t.loading=!1,t.$parent.initSpinnerList(),t.$parent.currentPage=1,t.$parent.queryInfoList(),console.log(e),t.isShow=!1,t.$aui.message.show({message:"版本发布成功",type:"success"})}).catch(function(e){t.$aui.message.show({message:e.SYS_HEAD.ReturnMessage,type:"error"}),t.loading=!1,console.log("error",e)})}})}}},g={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("aui-dialog",{attrs:{title:"版本发布",visible:e.isShow,center:"","lock-scroll":!1,"close-on-click-modal":!1,width:"800px"},on:{"update:visible":function(t){e.isShow=t},show:e.openInit,hide:e.closeCallback}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{"element-loading-text":"拼命加载中"}},[a("aui-step",{staticStyle:{"margin-bottom":"10px"},attrs:{active:e.active,"align-center":"","finish-status":"success"}},[a("aui-step",{attrs:{title:"发布类型"}}),e._v(" "),a("aui-step",{attrs:{title:"发布规则"}})],1),e._v(" "),a("aui-form",{ref:"form",attrs:{model:e.form,rules:e.rules,size:"mini","label-width":"110px","label-position":"right"}},[0===e.active?a("div",[a("aui-card",{staticStyle:{"margin-bottom":"10px",overflow:"visible"}},[a("aui-row",{attrs:{gutter:10}},[a("aui-col",{attrs:{span:12}},[a("aui-form-item",{attrs:{label:"版本编号 : ",prop:"versionCode"}},[a("aui-select",{attrs:{placeholder:"请选择版本编号"},model:{value:e.form.versionCode,callback:function(t){e.$set(e.form,"versionCode",t)},expression:"form.versionCode"}},e._l(e.verBaseInfo,function(e){return a("aui-option",{key:e.adID,attrs:{label:e.VERSIONCODE,value:e.VERSIONCODE}})}))],1)],1),e._v(" "),a("aui-col",{attrs:{span:24}},[a("aui-form-item",{attrs:{label:"发布方式 : "}},[a("aui-radio-group",{on:{change:e.initselBrno},model:{value:e.radio,callback:function(t){e.radio=t},expression:"radio"}},[a("aui-radio",{attrs:{label:1}},[e._v("按机构")]),e._v(" "),a("aui-radio",{attrs:{label:2}},[e._v("按设备")]),e._v(" "),a("aui-radio",{attrs:{label:3}},[e._v("按设备应用")])],1)],1)],1),e._v(" "),"3"==e.radio?a("aui-col",{attrs:{span:12}},[a("aui-form-item",{attrs:{label:"设备应用",prop:"AppNum"}},[a("aui-select",{attrs:{placeholder:"请选择设备应用"},model:{value:e.form.AppNum,callback:function(t){e.$set(e.form,"AppNum",t)},expression:"form.AppNum"}},e._l(e.appQueryList,function(e){return a("aui-option",{key:e.appNum,attrs:{label:e.AppName,value:e.AppNum}})}))],1)],1):e._e(),e._v(" "),"1"==e.radio?a("aui-col",{attrs:{span:12}},[a("aui-form-item",{attrs:{label:"机构 : ",prop:"branchNo"}},[a("select-tree",{staticStyle:{"min-width":"259px"},attrs:{props:{id:"branchnum",label:"branchname",children:"children"},"tree-data":e.brno,"node-key":"branchnum"},model:{value:e.form.brmo,callback:function(t){e.$set(e.form,"brmo",t)},expression:"form.brmo"}})],1)],1):e._e()],1),e._v(" "),"2"==e.radio?a("aui-row",[a("aui-col",[a("aui-table",{ref:"multipleTable",attrs:{data:e.devTableData,"header-row-class-name":"tableHeaderClass",border:""},on:{"selection-change":e.handleSelectionChange}},[a("aui-table-column",{attrs:{type:"selection",width:"40"}}),e._v(" "),a("aui-table-column",{attrs:{fixed:"",prop:"devid",label:"设备编号",width:"120"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"devnum",label:"设备类型",width:"120"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"branchname",label:"及其所在网点",width:"150"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"devip",label:"设备IP","min-width":"120"}})],1),e._v(" "),a("aui-pagination",{staticStyle:{"text-align":"right","margin-top":"20px"},attrs:{"current-page":e.currentPage,"page-sizes":[10,20,50,100],"page-size":e.pageSize,background:"",layout:"total, prev, pager, next, jumper",total:e.tableTotal},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange,"update:currentPage":function(t){e.currentPage=t}}})],1)],1):e._e()],1),e._v(" "),a("div",{staticClass:"dialog-footer",staticStyle:{"text-align":"center"},attrs:{slot:"footer"},slot:"footer"},[a("aui-button",{staticStyle:{"margin-top":"10px"},attrs:{type:"primary",size:"mini"},on:{click:function(t){e.next("form")}}},[e._v("下一步")])],1)],1):e._e(),e._v(" "),1===e.active?a("div",[a("aui-card",{staticStyle:{"margin-bottom":"10px",overflow:"visible"}},[a("aui-row",{attrs:{gutter:20}},[a("aui-col",{attrs:{span:10}},[a("aui-form-item",{attrs:{label:"立即生效 :",prop:"isEffective"}},[a("aui-radio-group",{on:{change:e.radioChange},model:{value:e.form.isEffective,callback:function(t){e.$set(e.form,"isEffective",t)},expression:"form.isEffective"}},[a("aui-radio",{attrs:{label:1}},[e._v("是")]),e._v(" "),a("aui-radio",{attrs:{label:2}},[e._v("否")])],1)],1)],1),e._v(" "),a("aui-col",{attrs:{span:12,offset:2}},[a("aui-form-item",{attrs:{label:"预计发布时间:",prop:"verUpdatePrepareTime"}},[a("aui-date-picker",{attrs:{type:"datetime",readonly:e.isdatenow,placeholder:"选择日期时间","value-format":"yyyy-MM-dd HH:mm:ss",disabled:1==e.form.isEffective},model:{value:e.form.verUpdatePrepareTime,callback:function(t){e.$set(e.form,"verUpdatePrepareTime",t)},expression:"form.verUpdatePrepareTime"}})],1)],1),e._v(" "),a("aui-col",{attrs:{span:12}},[a("aui-form-item",{attrs:{label:"升级间隔时间:",prop:"verUpdateInterval"}},[a("aui-input",{attrs:{placeholder:"请输入升级间隔时间（秒）"},model:{value:e.form.verUpdateInterval,callback:function(t){e.$set(e.form,"verUpdateInterval",t)},expression:"form.verUpdateInterval"}})],1)],1),e._v(" "),a("aui-col",{attrs:{md:12,lg:12}},[a("aui-form-item",{attrs:{label:"单次升级数量:",prop:"verUpdateDevNum"}},[a("aui-input",{attrs:{placeholder:"请输入单次升级数量"},model:{value:e.form.verUpdateDevNum,callback:function(t){e.$set(e.form,"verUpdateDevNum",t)},expression:"form.verUpdateDevNum"}})],1)],1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",staticStyle:{"text-align":"center"},attrs:{slot:"footer"},slot:"footer"},[a("aui-button",{staticStyle:{"margin-top":"10px"},attrs:{size:"mini",type:"primary"},on:{click:e.back}},[e._v("上一步")]),e._v(" "),a("aui-button",{staticStyle:{"margin-top":"10px"},attrs:{size:"mini",type:"primary"},on:{click:function(t){e.sure("form")}}},[e._v("确 定")])],1)],1):e._e()])],1)])],1)},staticRenderFns:[]};var b=a("/Xao")(h,g,!1,function(e){a("hT+N")},"data-v-60126b27",null).exports,y=function e(){c()(this,e),this.data={versionCode:"",deviceNum:"",deviceModel:""},this.TransServiceCode="mg-afaservices-vsn/versionTodevQuery"},I={data:function(){return{tableTotal:0,pageSize:r.a.get("PageSize"),verBaseInfo:[],formInline:{devNum:void 0,versionCode:"",deviceNum:"",deviceModel:""},oldvcode:"",currentPage:1,loading:!1,dialogList:{versionRelease:b},dialogOptions:{versionReleaseIsShow:!1},tableData:[],isEffectivetype:r.a.get("isEffectivetype")}},created:function(){this.initSpinnerList(),this.queryInfoList()},methods:{initSpinnerList:function(){var e=this,t=new l.a;Object(n.a)(t).then(function(t){e.verBaseInfo=t.RspInfo.verDropBoxList||[]}).catch(function(e){console.error("查询错误",e)})},Format:function(e,t){return this.isEffectivetype[e[t.property]]},dtFormat:function(e,t){if(e[t.property])return i.a.timestampToTime(e[t.property])},handleSizeChange:function(e){this.queryInfoList()},handleCurrentChange:function(e){this.currentPage=e,this.queryInfoList()},queryInfoList:function(){var e=this;this.loading=!0;var t=new y;t.data.versionCode=this.formInline.versionCode,t.data.deviceNum=this.formInline.deviceNum,t.data.deviceModel=this.formInline.deviceModel,this.formInline.versionCode!=this.oldvcode&&(this.currentPage=1,this.oldvcode=this.formInline.versionCode),t.data.QueryRowNum=this.pageSize,t.data.QueryPageNo=this.currentPage,Object(n.a)(t).then(function(t){console.log(t.RspInfo),e.loading=!1,e.tableData=t.RspInfo.verToDevInfoList||[],e.tableTotal=Number(t.RspInfo.QueryAllDataCount||0)}).catch(function(t){e.$aui.message.show({message:t.SYS_HEAD.ReturnMessage,type:"error"}),e.loading=!1,e.tableData=[],e.tableTotal=0,console.log("异常信息：",t)})},clearForm:function(e){this.$refs[e].resetFields()},dialogVersionRelease:function(){this.dialogOptions.versionReleaseIsShow=!0}}},U={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{"element-loading-text":"拼命加载中"}},[a("aui-card",{staticStyle:{"margin-bottom":"10px"}},[a("aui-form",{ref:"formInline",attrs:{model:e.formInline,"label-position":"top",size:"mini"}},[a("aui-row",{attrs:{gutter:10}},[a("aui-col",{attrs:{md:6,lg:4}},[a("aui-form-item",{attrs:{label:"版本编号",prop:"versionCode"}},[a("aui-select",{attrs:{placeholder:"请选择版本编号查询"},model:{value:e.formInline.versionCode,callback:function(t){e.$set(e.formInline,"versionCode",t)},expression:"formInline.versionCode"}},e._l(e.verBaseInfo,function(e){return a("aui-option",{key:e.adID,attrs:{label:e.VERSIONCODE,value:e.VERSIONCODE}})}))],1)],1),e._v(" "),a("aui-col",{attrs:{md:6,lg:4}},[a("aui-form-item",{attrs:{label:"设备编号",prop:"deviceNum"}},[a("aui-input",{attrs:{placeholder:"请输入设备编号"},model:{value:e.formInline.deviceNum,callback:function(t){e.$set(e.formInline,"deviceNum",t)},expression:"formInline.deviceNum"}})],1)],1),e._v(" "),a("aui-col",{staticClass:"searchBtnMarginTop",attrs:{md:3,lg:2}},[a("aui-form-item",[a("aui-button",{attrs:{type:"primary",icon:"aui-icon-search"},on:{click:e.queryInfoList}},[e._v("查询")])],1)],1),e._v(" "),a("aui-col",{staticClass:"searchBtnMarginTop",attrs:{lg:2,md:3}},[a("aui-button",{attrs:{type:"warning",size:"mini",icon:"aui-icon-refresh"},on:{click:function(t){e.clearForm("formInline")}}},[e._v("重置")])],1)],1)],1)],1),e._v(" "),a("aui-card",[e.btnPermission("Button_VersionRelease_Release")?a("aui-button",{attrs:{type:"primary",size:"mini"},on:{click:e.dialogVersionRelease}},[e._v("版本发布")]):e._e(),e._v(" "),a("aui-table",{staticClass:"tableMarginTop",attrs:{border:"",data:e.tableData,"header-row-class-name":"tableHeaderClass"}},[a("aui-table-column",{attrs:{fixed:"",prop:"devId",label:"设备编号",width:"100"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"versionCode",label:"版本编号",width:"150"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"branchNo",label:"所属网点",width:"120"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"isEffective",formatter:e.Format,label:"是否立即生效",width:"120"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"verUpdateInterval",label:"升级时间间隔",width:"120"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"verUpdateDevNum",label:"升级机器数量",width:"120"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"verUpdatePrepareTime",label:"开始时间","min-width":"180"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"verCreateTime",label:"创建日期","min-width":"180"}})],1),e._v(" "),a("aui-pagination",{staticStyle:{"text-align":"right","margin-top":"20px"},attrs:{"current-page":e.currentPage,background:"","page-size":e.pageSize,layout:"total, prev, pager, next, jumper",total:e.tableTotal},on:{"current-change":e.handleCurrentChange,"size-change":e.handleSizeChange}})],1),e._v(" "),a("keep-alive",[a(e.dialogList.versionRelease,{tag:"component",attrs:{option:e.dialogOptions}})],1)],1)},staticRenderFns:[]};var w=a("/Xao")(I,U,!1,function(e){a("6JUn")},null,null);t.default=w.exports},"hT+N":function(e,t,a){var n=a("HZAa");"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);a("8bSs")("4931eefc",n,!0)}});