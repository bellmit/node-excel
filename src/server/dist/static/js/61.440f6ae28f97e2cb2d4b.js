webpackJsonp([61],{"49s5":function(e,t,a){var i=a("YRAl");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);a("8bSs")("46f41e7f",i,!0)},YRAl:function(e,t,a){(e.exports=a("BkJT")(!1)).push([e.i,"",""])},aEPt:function(e,t,a){(e.exports=a("BkJT")(!1)).push([e.i,"\n.ADupload.avatar-uploader .aui-upload {\n  border: 1px dashed #d9d9d9;\n  border-radius: 6px;\n  cursor: pointer;\n  position: relative;\n  overflow: hidden;\n}\n.ADupload.avatar-uploader .aui-upload:hover {\n    border-color: #409EFF;\n}\n.ADupload.avatar-uploader .aui-upload .avatar-uploader-icon {\n    font-size: 28px;\n    color: #8c939d;\n    width: 178px;\n    height: 178px;\n    line-height: 178px;\n    text-align: center;\n}\n.ADupload.avatar-uploader .aui-upload .avatar {\n    width: 178px;\n    height: 178px;\n    display: block;\n}\n",""])},o0wp:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("syAl"),r=a("0oES"),o=a("fCv1"),s=a("0VOF"),n=a("Zqsi"),l=a("AA3o"),d=a.n(l),m=function e(){d()(this,e),this.data={AdNo:"",Brno:"",AdName:"",AdContent:"",AdType:"",StartDate:"",EndDate:"",StartTime:"",EndTime:"",IsEnabled:"",Remark:""},this.CommCode="IBContentManagement",this.SceneCode="AdvertisementUpload",this.TransServiceCode="mg-afaservices-cnt/advertisementUpload"},c=function e(){d()(this,e),this.data={adNo:""},this.CommCode="IBContentManagement",this.SceneCode="AdvertisementUpdateQ",this.TransServiceCode="mg-afaservices-cnt/advertisementUpdateQ"},u=a("tzsN"),p=a("pADA"),h={components:{selectTree:u.a},props:{option:Object},data:function(){return{loading:!1,isUpload:!1,isAdType:!0,finishUp:!1,fileList:[],fileSize:2,branchList:[],adTypeList:[{value:"P",label:"图片"},{value:"V",label:"视频"},{value:"C",label:"文字"}],adTypeMap:{},imageUrl:"",fileUploadUrl:"",absFilePath:"",afaToJSUploadFilePath:"",uploadData:{},upLoadType:["mp4","flv","rmvb","avi","jpg","png","bmp","jpeg"],disabled:!1,form:{startDate:"",endDate:"",startTime:"000000",endTime:"235959",isEnable:!0,fileDesc:"",adNo:"",adName:"",adType:"P",imageUrl:"",brno:[],fileId:"",fileName:""},dialogFormVisible:!1,rules:{file:[{trigger:"blur",validator:this.picVali}],adNo:[{required:!0,message:"请输入广告编号",trigger:"blur"},{validator:o.j,trigger:"blur"}],imageUrl:[{required:!0,message:"广告内容不能为空",trigger:"blur"}],adName:[{required:!0,message:"请输入广告名称",trigger:"blur"},{validator:Object(o.h)(30),trigger:"blur"}],fileDesc:[{max:200,message:"长度不超过200个字符",trigger:"blur"}],isEnable:[{required:!0,message:"请选择是否启用",trigger:"blur"}],brno:[{required:!0,message:"请选择机构编号",trigger:"change"}],adType:[{required:!0,message:"请选择广告类型",trigger:"change"}],startDate:[{required:!0,message:"请选择起始日期",trigger:"change"},{trigger:"change",validator:this.startDateVali}],endDate:[{required:!0,message:"请输入结束日期",trigger:"change"},{trigger:"change",validator:this.endDateVali}],startTime:[{required:!0,message:"请输入起始时间",trigger:"change"},{trigger:"change",validator:this.startTimeVali}],endTime:[{required:!0,message:"请输入结束时间",trigger:"change"},{trigger:"change",validator:this.endTimeVali}]}}},computed:{isShow:{get:function(){return this.option.isShow},set:function(e){this.option.isShow=e}},pokerHistory:function(){return this.form.adType}},created:function(){var e=this;this.$nextTick(function(){e.fileUploadUrl=i.a.get("uploadFileToABSAddress"),e.absFilePath=i.a.get("absFilePath"),e.afaToJSUploadFilePath=i.a.get("afaToJSUploadFilePath"),e.uploadData.destDir=e.absFilePath})},watch:{pokerHistory:function(e,t){this.isUpload=!1,"C"==e?(this.disabled=!0,this.form.imageUrl=""):(this.disabled=!1,this.imageUrl="")}},methods:{adTypeChange:function(){"C"==this.form.adType?this.isAdType=!1:this.isAdType=!0},adNoCheck:function(){var e=this;this.loading=!0;var t=new c;t.data.adNo=this.form.adNo,Object(r.a)(t).then(function(t){e.loading=!1,e.form.adNo="",e.$aui.message.show({type:"warning",message:"广告编号已存在!"})}).catch(function(t){e.loading=!1,e.finishUp=!1})},openDialog:function(){},closePop:function(){this.isShow=!1,this.$refs.form.resetFields(),this.$refs.form.clearValidate(),this.imageUrl="",this.finishUp=!1,this.fileList=[]},handleBeforeUpload:function(e){var t=!1;this.$refs.form.validateField("adNo",function(e){e||(t=!0)});var a=e.name.substring(e.name.lastIndexOf(".")+1),i=e.size/1024/1024<this.fileSize,r=-1==this.upLoadType.indexOf(a);return r&&this.$aui.message.show.error("上传文件格式错误"),i||this.$aui.message.show.error("上传文件大小不能超过"+this.fileSize+"M"),t&&!r&&i},handleSuccess:function(e,t,a){var i=this;"V"==this.form.adType&&(this.disabled=!0,this.isUpload=!0),this.imageUrl=t.name,this.loading=!0;var o=new n.a;o.OpType="1",o.FileNm=this.uploadData.destDir+t.name,o.FileNm1=this.afaToJSUploadFilePath,o.Wher="0",o.data.FILE_NAME=t.name,o.data.SysCode="SYS_MG_01",o.data.FILE_UPLOAD_PATH=this.afaToJSUploadFilePath,Object(r.a)(o).then(function(e){i.loading=!1,i.form.fileName=t.name,i.form.fileId=e.RspInfo.FILE_ID,i.$aui.message.show({type:"success",message:"上传成功！文件编号："+i.form.fileId})}).catch(function(e){i.loading=!1,i.fileList=[],i.$aui.message.show({type:"error",message:"上传失败!"+e.SYS_HEAD.ReturnMessage}),console.log(e)})},handleRemove:function(e,t){this.imageUrl="",this.form.fileName="",this.$aui.message.show.error("上传失败")},onExceed:function(){this.$aui.message.show.error("文件最大上传个数:1")},submitUpload:function(){this.$refs.upload.submit()},submitForm:function(e){var t=this;this.$refs[e].validate(function(e){if(e){t.loading=!0;var a=new m;a.data.OperDate=p.a.getDateTime("date"),a.data.StartDate=t.form.startDate,a.data.EndDate=t.form.endDate,a.data.StartTime=t.form.startTime,a.data.EndTime=t.form.endTime,a.data.IsEnabled=!t.form.isEnable+0+"","C"==t.form.adType?a.data.AdContent=t.form.imageUrl:a.data.AdContent=t.imageUrl,a.data.AdType=t.form.adType,a.data.AdNo=t.form.adNo,a.data.Brno=t.form.brno[0],a.data.AdName=t.form.adName,a.data.Remark=t.form.fileDesc,a.data.FileId=t.form.fileId,Object(r.a)(a).then(function(e){t.loading=!1,t.$emit("succ"),t.isShow=!1,t.fileList=[],t.$aui.message.show({type:"success",message:"新增广告文件成功!"})}).catch(function(e){t.loading=!1,t.$aui.message.show({type:"error",message:"请求失败，错误码:"+e.SYS_HEAD.ReturnCode+"，错误信息："+e.SYS_HEAD.ReturnMessage})})}})},picVali:function(e,t,a){"C"!=this.form.adType&&""==this.imageUrl?a("请选择上传图片"):a()},startDateVali:function(e,t,a){""==this.form.endDate?a():t>this.form.endDate?a(new Error("起始日期不得大于结束日期")):(""!==this.form.endDate&&this.$refs.form.validateField("endDate"),a())},endDateVali:function(e,t,a){t<this.form.startDate?a(new Error("结束日期不得小于开始日期")):a()},startTimeVali:function(e,t,a){""==this.form.endTime?a():t>this.form.endTime?a(new Error("起始时间不得大于结束时间")):(""!==this.form.endTime&&this.$refs.form.validateField("endTime"),a())},endTimeVali:function(e,t,a){t<this.form.startTime?a(new Error("结束时间不得小于开始时间")):a()},queryUpload:function(){}}},g={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("aui-dialog",{attrs:{title:"添加广告文件",visible:e.isShow,width:"750","lock-scroll":!1},on:{hide:e.closePop,"update:visible":function(t){e.isShow=t},show:e.openDialog}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[a("aui-card",[a("aui-form",{ref:"form",attrs:{rules:e.rules,model:e.form,size:"mini","label-width":"120px"}},[a("aui-row",{attrs:{gutter:40}},[a("aui-col",{attrs:{span:12}},[a("aui-form-item",{attrs:{label:"机构编号:",prop:"brno"}},[a("select-tree",{staticStyle:{width:"170px"},attrs:{props:{id:"orgno",label:"cname",children:"children"},"tree-data":e.option.brnoList,"single-check":!0,placeholder:"请选择机构"},model:{value:e.form.brno,callback:function(t){e.$set(e.form,"brno",t)},expression:"form.brno"}})],1)],1),e._v(" "),a("aui-col",{attrs:{span:12}},[a("aui-form-item",{attrs:{label:"广告编号",prop:"adNo"}},[a("aui-input",{attrs:{maxlength:10,placeholder:"请输入广告编号",disabled:e.finishUp},on:{blur:e.adNoCheck},model:{value:e.form.adNo,callback:function(t){e.$set(e.form,"adNo",t)},expression:"form.adNo"}})],1)],1)],1),e._v(" "),a("aui-row",{attrs:{gutter:40}},[a("aui-col",{attrs:{span:12}},[a("aui-form-item",{attrs:{label:"广告名称",prop:"adName"}},[a("aui-input",{attrs:{placeholder:"请输入广告名称"},model:{value:e.form.adName,callback:function(t){e.$set(e.form,"adName",t)},expression:"form.adName"}})],1)],1),e._v(" "),a("aui-col",{attrs:{span:12}},[a("aui-form-item",{attrs:{label:"广告类型",prop:"adType",placeholder:"请选择广告类型"}},[a("aui-select",{on:{change:e.adTypeChange},model:{value:e.form.adType,callback:function(t){e.$set(e.form,"adType",t)},expression:"form.adType"}},e._l(e.adTypeList,function(e){return a("aui-option",{key:e.value,attrs:{label:e.value+"-"+e.label,value:e.value,disabled:e.disabled}})}))],1)],1),e._v(" "),a("aui-col",{attrs:{span:24}},[e.disabled?a("aui-form-item",{attrs:{label:"广告内容",prop:"imageUrl"}},[a("aui-input",{attrs:{placeholder:"请输入广告内容"},model:{value:e.form.imageUrl,callback:function(t){e.$set(e.form,"imageUrl",t)},expression:"form.imageUrl"}})],1):e._e()],1)],1),e._v(" "),a("aui-row",{attrs:{gutter:40}},[a("aui-col",{attrs:{span:20}},[e.isAdType?a("aui-form-item",{attrs:{label:"图片/视频上传",prop:"file"}},[a("aui-upload",{ref:"upload",staticClass:"upload-demo",attrs:{action:e.fileUploadUrl,limit:1,"auto-upload":!1,data:e.uploadData,"before-upload":e.handleBeforeUpload,"on-error":e.handleRemove,"on-success":e.handleSuccess,"file-list":e.fileList,accept:".mp4, .flv, .rmvb, .avi, .jpg, .png, .bmp, .jpeg"}},[a("aui-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v("选取文件")]),e._v(" "),a("aui-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"small",type:"success"},on:{click:e.submitUpload}},[e._v("上传到服务器")]),e._v(" "),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v(e._s("只能上传大小不超过"+e.fileSize+"M的文件"))])],1)],1):e._e()],1)],1),e._v(" "),a("aui-row",{attrs:{gutter:40}},[a("aui-col",{attrs:{span:24}},[a("aui-form-item",{attrs:{label:"是否启用",prop:"isEnable"}},[a("aui-radio-group",{model:{value:e.form.isEnable,callback:function(t){e.$set(e.form,"isEnable",t)},expression:"form.isEnable"}},[a("aui-radio",{attrs:{label:!0}},[e._v("启用")]),e._v(" "),a("aui-radio",{attrs:{label:!1}},[e._v("不启用")])],1)],1)],1)],1),e._v(" "),a("aui-row",[a("aui-col",{attrs:{span:24}},[a("aui-form-item",{attrs:{label:"播放日期",required:""}},[a("aui-col",{attrs:{span:11}},[a("aui-form-item",{staticStyle:{"margin-bottom":"0 !important"},attrs:{prop:"startDate"}},[a("aui-date-picker",{staticStyle:{width:"100%"},attrs:{editable:!1,"value-format":"yyyyMMdd",type:"date",placeholder:"播放开始日期"},model:{value:e.form.startDate,callback:function(t){e.$set(e.form,"startDate",t)},expression:"form.startDate"}})],1)],1),e._v(" "),a("aui-col",{staticStyle:{"text-align":"center"},attrs:{span:2}},[e._v("\n                -\n              ")]),e._v(" "),a("aui-col",{attrs:{span:11}},[a("aui-form-item",{staticStyle:{"margin-bottom":"0 !important"},attrs:{prop:"endDate"}},[a("aui-date-picker",{staticStyle:{width:"100%"},attrs:{editable:!1,"value-format":"yyyyMMdd",type:"date",placeholder:"播放结束日期"},model:{value:e.form.endDate,callback:function(t){e.$set(e.form,"endDate",t)},expression:"form.endDate"}})],1)],1)],1)],1),e._v(" "),a("aui-col",{attrs:{span:24}},[a("aui-form-item",{attrs:{label:"播放时间",required:""}},[a("aui-col",{attrs:{span:11}},[a("aui-form-item",{staticStyle:{"margin-bottom":"0 !important"},attrs:{prop:"startTime"}},[a("aui-time-picker",{staticStyle:{width:"100%"},attrs:{editable:!1,"value-format":"HHmmss",placeholder:"播放开始时间"},model:{value:e.form.startTime,callback:function(t){e.$set(e.form,"startTime",t)},expression:"form.startTime"}})],1)],1),e._v(" "),a("aui-col",{staticStyle:{"text-align":"center"},attrs:{span:2}},[e._v("\n                -\n              ")]),e._v(" "),a("aui-col",{attrs:{span:11}},[a("aui-form-item",{staticStyle:{"margin-bottom":"0 !important"},attrs:{prop:"endTime"}},[a("aui-time-picker",{staticStyle:{width:"100%"},attrs:{editable:!1,"value-format":"HHmmss",placeholder:"播放结束时间"},model:{value:e.form.endTime,callback:function(t){e.$set(e.form,"endTime",t)},expression:"form.endTime"}})],1)],1)],1)],1)],1),e._v(" "),a("aui-row",{attrs:{gutter:40}},[a("aui-col",{attrs:{span:24}},[a("aui-form-item",{attrs:{label:"文件描述",prop:"fileDesc"}},[a("aui-input",{attrs:{placeholder:"请输入文件描述"},model:{value:e.form.fileDesc,callback:function(t){e.$set(e.form,"fileDesc",t)},expression:"form.fileDesc"}})],1)],1)],1)],1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("aui-button",{attrs:{size:"small"},on:{click:e.closePop}},[e._v("取 消")]),e._v(" "),a("aui-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){e.submitForm("form")}}},[e._v("确 定")])],1)])},staticRenderFns:[]};var f=a("/Xao")(h,g,!1,function(e){a("oFHj")},null,null).exports,b=function e(){d()(this,e),this.data={IsEnable:"",StartDate:"",EndDate:"",StartTime:"",EndTime:"",AdNo:"",AdName:"",Brno:"",Remark:""},this.CommCode="IBContentManagement",this.SceneCode="AdvertisementUpdate",this.TransServiceCode="mg-afaservices-cnt/advertisementUpdate"},v={props:["option","selectedItem","editCheckData"],data:function(){return{innerVisible:!1,loading:!1,popLoading:!1,dialogFormVisible:!1,form:{startDate:"",endDate:"",startTime:"",endTime:"",isEnable:!0,brno:"",remark:"",adNo:"",adName:"",imageUrl:"",adType:""},branchList:[],fileList:[],defaultProps:{value:"devTypeNum",label:"devType"},rules:{isEnable:[{required:!0,message:"请选择是否启用",trigger:"blur"}],imageUrl:[{required:!0,message:"广告内容不能为空",trigger:"blur"}],adName:[{required:!0,message:"请输入广告名称",trigger:"blur"},{max:30,message:"长度不超过30个字符",trigger:"blur"}],startDate:[{required:!0,message:"请选择起始日期",trigger:"change"},{trigger:"change",validator:this.startDateVali}],endDate:[{required:!0,message:"请输入结束日期",trigger:"change"},{trigger:"change",validator:this.endDateVali}],startTime:[{required:!0,message:"请输入起始时间",trigger:"change"},{trigger:"change",validator:this.startTimeVali}],endTime:[{required:!0,message:"请输入结束时间",trigger:"change"},{trigger:"change",validator:this.endTimeVali}],remark:[{max:200,message:"长度不超过200个字符",trigger:"blur"}]}}},computed:{isShow:{get:function(){return this.option.isShow},set:function(e){this.option.isShow=e}}},created:function(){},methods:{handleRemove:function(e,t){console.log(e,t)},handlePreview:function(e){},previewBanner:function(e){var t=new FileReader;t.onload=function(){var e=t.result;doWhatUWant(e)},t.readAsDataURL(e.raw)},handleExceed:function(e,t){this.$aui.message.show.warning("当前限制选择 1 个文件，本次选择了 "+e.length+" 个文件，共选择了 "+(e.length+t.length)+" 个文件")},submit:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return t.$aui.message.show({type:"warning",message:"请按条件输入"}),!1;t.queryUpload()})},startDateVali:function(e,t,a){""==this.form.endDate?a():t>this.form.endDate?a(new Error("起始日期不得大于结束日期")):(""!==this.form.endDate&&this.$refs.form.validateField("endDate"),a())},endDateVali:function(e,t,a){t<this.form.startDate?a(new Error("结束日期不得小于开始日期")):a()},startTimeVali:function(e,t,a){""==this.form.endTime?a():t>this.form.endTime?a(new Error("起始时间不得大于结束时间")):(""!==this.form.endTime&&this.$refs.form.validateField("endTime"),a())},endTimeVali:function(e,t,a){t<this.form.startTime?a(new Error("结束时间不得小于开始时间")):a()},queryUpload:function(){var e=this;this.loading=!0,console.log(this.selectedItem);var t=new b;t.data.IsEnabled=!this.form.isEnable+0+"",t.data.StartDate=this.form.startDate,t.data.EndDate=this.form.endDate,t.data.StartTime=this.form.startTime,t.data.EndTime=this.form.endTime,t.data.AdName=this.form.adName,t.data.AdNo=this.form.adNo,t.data.Brno=this.form.brno,t.data.Remark=this.form.remark,"C"==this.selectedItem.adType?t.data.AdContent=this.form.imageUrl:t.data.AdContent=this.selectedItem.adContentre,Object(r.a)(t).then(function(t){e.loading=!1,e.$emit("succ"),e.isShow=!1,e.innerVisible=!1,e.$aui.message.show({type:"success",message:"修改成功!"})}).catch(function(t){e.loading=!1,e.isShow=!1,e.innerVisible=!1,e.$aui.message.show({type:"warning",message:"请求失败，错误码:"+t.SYS_HEAD.ReturnCode+"，错误信息："+t.SYS_HEAD.ReturnMessage})})}},watch:{selectedItem:function(){this.form={startDate:this.selectedItem.startDate,endDate:this.selectedItem.endDate,startTime:this.selectedItem.startTime,endTime:this.selectedItem.endTime,isEnable:this.selectedItem.isEnable,brno:this.selectedItem.brno,remark:this.selectedItem.remark,adNo:this.selectedItem.adNo,adName:this.selectedItem.adName,imageUrl:this.selectedItem.adContentre,adType:this.selectedItem.adType}}}},y={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{"element-loading-text":"加载中。。。"}},[a("aui-dialog",{attrs:{title:"提示",visible:e.isShow},on:{"update:visible":function(t){e.isShow=t}}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.popLoading,expression:"popLoading"}]},[e._v("\n      本次修改将会影响下列机具\n      "),a("aui-table",{staticStyle:{width:"100%"},attrs:{data:e.editCheckData,"max-height":"400"}},[a("aui-table-column",{attrs:{prop:"deviceNum",label:"机具编号"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"orgNum",label:"机构编号"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"orgName",label:"所属机构"}})],1)],1),e._v(" "),a("aui-dialog",{attrs:{title:"修改广告文件",visible:e.innerVisible,width:"750px","lock-scroll":!1,"append-to-body":""},on:{"update:visible":function(t){e.innerVisible=t}}},[a("aui-card",[a("aui-form",{ref:"form",attrs:{model:e.form,size:"small","label-width":"80px",rules:e.rules,"label-position":"right"}},[a("aui-col",{attrs:{span:12}},[a("aui-form-item",{attrs:{label:"广告编号"}},[a("span",[e._v(e._s(e.selectedItem?e.selectedItem.adNo:""))])])],1),e._v(" "),a("aui-row",[a("aui-col",{attrs:{span:12}},[a("aui-form-item",{attrs:{label:"广告名称",prop:"adName"}},[a("aui-input",{attrs:{placeholder:"请输入广告名称"},model:{value:e.form.adName,callback:function(t){e.$set(e.form,"adName",t)},expression:"form.adName"}})],1)],1)],1),e._v(" "),a("aui-col",{attrs:{span:12}},[a("aui-form-item",{attrs:{label:"广告类型"}},[a("span",[e._v(e._s(e.selectedItem?"C"==e.selectedItem.adType?"文字":"P"==e.selectedItem.adType?"图片":"视频":""))])])],1),e._v(" "),a("aui-row",[a("aui-col",{attrs:{span:12}},[a("aui-form-item",{attrs:{label:"机构编号",prop:"brno"}},[a("aui-select",{attrs:{disabled:e.option.isDisabled,filterable:"",placeholder:"请选择机构编号"},model:{value:e.form.brno,callback:function(t){e.$set(e.form,"brno",t)},expression:"form.brno"}},e._l(e.option.branchList,function(e){return a("aui-option",{key:e.orgno,attrs:{label:e.cname,value:e.orgno,disabled:e.disabled}})}))],1)],1)],1),e._v(" "),"C"==e.selectedItem.adType?a("aui-form-item",{attrs:{label:"广告内容",prop:"imageUrl"}},[a("aui-input",{attrs:{placeholder:"请输入广告内容"},model:{value:e.form.imageUrl,callback:function(t){e.$set(e.form,"imageUrl",t)},expression:"form.imageUrl"}})],1):e._e(),e._v(" "),a("aui-form-item",{attrs:{label:"是否启用",prop:"isEnable"}},[a("aui-radio-group",{model:{value:e.form.isEnable,callback:function(t){e.$set(e.form,"isEnable",t)},expression:"form.isEnable"}},[a("aui-radio",{attrs:{label:!0}},[e._v("启用")]),e._v(" "),a("aui-radio",{attrs:{label:!1}},[e._v("不启用")])],1)],1),e._v(" "),a("aui-form-item",{attrs:{label:"播放日期",required:""}},[a("aui-col",{attrs:{span:11}},[a("aui-form-item",{staticStyle:{"margin-bottom":"0 !important"},attrs:{prop:"startDate"}},[a("aui-date-picker",{staticStyle:{width:"100%"},attrs:{editable:!1,"value-format":"yyyyMMdd",type:"date",placeholder:"播放开始日期"},model:{value:e.form.startDate,callback:function(t){e.$set(e.form,"startDate",t)},expression:"form.startDate"}})],1)],1),e._v(" "),a("aui-col",{staticStyle:{"text-align":"center"},attrs:{span:2}},[e._v("  - ")]),e._v(" "),a("aui-col",{attrs:{span:11}},[a("aui-form-item",{staticStyle:{"margin-bottom":"0 !important"},attrs:{prop:"endDate"}},[a("aui-date-picker",{staticStyle:{width:"100%"},attrs:{editable:!1,"value-format":"yyyyMMdd",type:"date",placeholder:"播放结束日期"},model:{value:e.form.endDate,callback:function(t){e.$set(e.form,"endDate",t)},expression:"form.endDate"}})],1)],1)],1),e._v(" "),a("aui-form-item",{attrs:{label:"播放时间",required:""}},[a("aui-col",{attrs:{span:11}},[a("aui-form-item",{staticStyle:{"margin-bottom":"0 !important"},attrs:{prop:"startTime"}},[a("aui-time-picker",{staticStyle:{width:"100%"},attrs:{editable:!1,"value-format":"HHmmss",placeholder:"播放开始时间"},model:{value:e.form.startTime,callback:function(t){e.$set(e.form,"startTime",t)},expression:"form.startTime"}})],1)],1),e._v(" "),a("aui-col",{staticStyle:{"text-align":"center"},attrs:{span:2}},[e._v("\n            -\n          ")]),e._v(" "),a("aui-col",{attrs:{span:11}},[a("aui-form-item",{staticStyle:{"margin-bottom":"0 !important"},attrs:{prop:"endTime"}},[a("aui-time-picker",{staticStyle:{width:"100%"},attrs:{editable:!1,"value-format":"HHmmss",placeholder:"播放结束时间"},model:{value:e.form.endTime,callback:function(t){e.$set(e.form,"endTime",t)},expression:"form.endTime"}})],1)],1)],1),e._v(" "),a("aui-form-item",{attrs:{label:"文件描述",prop:"remark"}},[a("aui-input",{attrs:{placeholder:"请输入文件描述"},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("aui-button",{attrs:{size:"small"},on:{click:function(t){e.innerVisible=!1}}},[e._v("取 消")]),e._v(" "),a("aui-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){e.submit("form")}}},[e._v("确 定")])],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("aui-button",{attrs:{size:"small"},on:{click:function(t){e.isShow=!1}}},[e._v("取 消")]),e._v(" "),a("aui-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){e.innerVisible=!0}}},[e._v("继续修改")])],1)],1)],1)},staticRenderFns:[]},S=a("/Xao")(v,y,!1,null,null,null).exports,w=a("QUZ0"),D=a("djZp"),T=function e(){d()(this,e),this.data={adNo:""},this.CommCode="IBContentManagement",this.SceneCode="AdvertisementDelete",this.TransServiceCode="mg-afaservices-cnt/advertisementDelete"},_=function e(){d()(this,e),this.data={adNo:""},this.CommCode="IBContentManagement",this.SceneCode="AdvertisementUDSel",this.TransServiceCode="mg-afaservices-cnt/advertisementUDSel"},N=function e(){d()(this,e),this.data={adNo:""},this.CommCode="IBContentManagement",this.SceneCode="AdvertisementDelSel",this.TransServiceCode="mg-afaservices-cnt/advertisementDelSel"},k={components:{selectTree:u.a},data:function(){return{loading:!1,loadingImg:!0,loadingImgError:!1,deleteCheckData:[],deleteCheckPopStatu:!1,dialogVisible:!1,dialogImageUrl:"",dialogList:{addAdsFileUpload:f,editAdsFileUp:S},dialogOptions:{isShow:!1},dialogOptionsUpdate:{isShow:!1,branchList:[]},selection:[],selectedItem:{},QueryForm:{branchNum:[],adNo:""},branchNum:[],brnoList:[],brnoMap:{},adTypeMap:{P:"图片",V:"视频",C:"文字"},permission:{},menuItemList:[],tableTotal:0,currentPage:1,pageSize:i.a.get("PageSize"),editCheckData:[],rules:{},absFilePath:"",viewFileAddress:"",afaToJSDownloadFilePath:""}},created:function(){var e=this;this.queryBranchNum(),this.$nextTick(function(){e.absFilePath=i.a.get("absDownFilePath"),e.viewFileAddress=i.a.get("viewFileAddress"),e.afaToJSDownloadFilePath=i.a.get("afaToJSDownloadFilePath")})},methods:{queryBranchNum:function(){var e=this;this.loading=!0;var t=new s.a;t.data.orgno=this.$store.getters.BranchNum,Object(r.a)(t).then(function(t){e.loading=!1,e.branchNum=t.RspInfo.Result||[],e.dialogOptionsUpdate.branchList=t.RspInfo.Result||[],e.permission=p.a.objArray2Hash(e.branchNum,"orgno"),e.brnoMap=t.RspInfo.orgMap||{},e.brnoList=p.a.formatTreeData(e.branchNum,"orgno","superno"),e.QueryForm.branchNum.push(e.brnoList[0].orgno),e.queryModel()}).catch(function(t){e.loading=!1,console.error("查询错误",t),e.$aui.message.show({type:"warning",message:t.SYS_HEAD.ReturnMessage})})},dataFormat:function(e,t){return"Brno"==t.property?e[t.property]+"-"+this.brnoMap[e[t.property]]:"AdType"==t.property?this.adTypeMap[e[t.property]]:void 0},loadingImgFalse:function(){this.loadingImg=!1,this.loadingImgError=!0},dialogDetail:function(e){var t=this;this.dialogVisible=!0,this.loadingImgError=!1,this.loadingImg=!0,this.loading=!0;var a=new w.a;a.OpType="0",a.FileNm=this.absFilePath,a.FileNm1=this.afaToJSDownloadFilePath,a.data.FILE_ID=e.row.FileId,a.data.FILE_NAME=e.row.AdContent,a.data.SysCode="SYS_MG_01",Object(r.a)(a).then(function(e){t.loading=!1;var a=e.RspInfo.fileDownPath;a=a.substring(a.lastIndexOf("/")+1,a.length),t.dialogImageUrl=t.viewFileAddress+a}).catch(function(e){t.loading=!1,t.loadingImgError=!0,t.$aui.message.show({type:"warning",message:e.SYS_HEAD.ReturnMessage}),console.log(e)})},dialogDetailClose:function(){this.dialogImageUrl=""},handleSizeChange:function(){this.selection=[],this.queryModel()},handleCurrentChange:function(){this.selection=[],this.queryModel()},resetForm:function(){this.menuItemList=[],this.$refs.QueryForm.resetFields()},selectList:function(e){this.selection=e,e.length>1&&this.$refs.menuItemList.toggleRowSelection(e[0])},queryModel:function(){var e=this;this.loading=!0;var t=new D.a;t.data.Brno=0==this.QueryForm.branchNum.length?this.$store.getters.BranchNum:this.QueryForm.branchNum[0],t.data.AdNo=this.QueryForm.adNo,t.data.QueryPageNo=this.currentPage,t.data.QueryRowNum=this.pageSize,Object(r.a)(t).then(function(t){for(var a in e.loading=!1,e.menuItemList=t.RspInfo.resultSet||[],e.tableTotal=t.RspInfo.total||0,e.menuItemList){var i=e.menuItemList[a];e.menuItemList[a].OperDate=p.a.timeFormat2Date(i.OperDate)+"  "+p.a.timeFormat2Time(i.OperTime)}"0"==e.tableTotal&&(e.menuItemList=[],e.$aui.message.show({type:"warning",message:"无满足条件的记录"}))}).catch(function(t){e.loading=!1,e.menuItemList=[],e.$aui.message.show({type:"warning",message:"请求失败，错误码:"+t.SYS_HEAD.ReturnCode+"，错误信息："+t.SYS_HEAD.ReturnMessage})})},checkAdd:function(){this.dialogOptions.isShow=!0,this.dialogOptions.brnoList=this.brnoList},checkPermission:function(e){this.permission[this.selection.Brno]?e?this.editShowAd():this.deleteHandle():this.$aui.message.show({type:"warning",message:"权限不足,无法修改！"})},editShowAd:function(){var e=this;this.loading=!0;var t=new c;t.data.adNo=this.selection[0].AdNo+"",Object(r.a)(t).then(function(t){e.loading=!1;t.RspInfo.resultSet[0];e.selectedItem={adNo:e.selection[0].AdNo,adName:e.selection[0].AdName,endDate:e.selection[0].EndDate,endTime:e.selection[0].EndTime,startDate:e.selection[0].StartDate,startTime:e.selection[0].StartTime,isEnable:!Number(e.selection[0].IsEnabled),brno:e.selection[0].Brno,remark:e.selection[0].Remark,adContentre:e.selection[0].AdContent,adType:e.selection[0].AdType},e.influencedDev()}).catch(function(t){e.loading=!1,e.$aui.message.show({type:"warning",message:"请求失败，错误码:"+t.SYS_HEAD.ReturnCode+"，错误信息："+t.SYS_HEAD.ReturnMessage})})},influencedDelDev:function(){var e=this;this.loading=!0;var t=new N,a=[];for(var i in this.selection)a.push(this.selection[i].AdNo);t.data.adNo=a.join(","),Object(r.a)(t).then(function(t){e.loading=!1,e.deleteCheckPopStatu=!0,e.deleteCheckData=t.RspInfo.resultSet}).catch(function(t){e.loading=!1,e.$aui.message.show({type:"warning",message:"请求失败，错误码:"+t.SYS_HEAD.ReturnCode+"，错误信息："+t.SYS_HEAD.ReturnMessage})})},influencedDev:function(){var e=this;this.loading=!0;var t=new _;t.data.adNo=this.selection[0].AdNo+"",Object(r.a)(t).then(function(t){e.loading=!1,e.editCheckData=t.RspInfo.resultSet,e.dialogOptionsUpdate.isShow=!0}).catch(function(t){e.loading=!1,e.$aui.message.show({type:"warning",message:"请求失败，错误码:"+t.SYS_HEAD.ReturnCode+"，错误信息："+t.SYS_HEAD.ReturnMessage})})},deleteHandle:function(){var e=this;this.$aui.confirm.show("您确定是否要删除选中项，删除后将不能恢复","删除",{cancelButtonText:"取消",confirmButtonText:"确定",type:"warning"}).then(function(){e.deleteAd()}).catch(function(){})},deleteAd:function(){var e=this;this.loading=!0;var t=new T,a=[];for(var i in this.selection)a.push(this.selection[i].AdNo);t.data.adNo=a.join(","),Object(r.a)(t).then(function(t){e.loading=!1,e.deleteCheckPopStatu=!1,"0"==t.RspInfo.resuleSet.alertMessage?e.$aui.message.show({type:"success",message:"删除成功"}):e.$aui.message.show({type:"warning",message:"该广告文件使用期尚未过期，无法删除！"}),e.queryModel()}).catch(function(t){e.loading=!1,e.$aui.message.show({type:"warning",message:"请求失败:"+t.SYS_HEAD.ReturnMessage}),console.log(t)})}}},A={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{"element-loading-text":"加载中。。。"}},[a("aui-card",[a("aui-form",{ref:"QueryForm",attrs:{model:e.QueryForm,rules:e.rules,size:"mini","label-position":"top"}},[a("aui-row",{attrs:{gutter:10}},[a("aui-col",{attrs:{lg:4,md:6}},[a("aui-form-item",{attrs:{label:"机构编号",prop:"branchNum"}},[a("select-tree",{staticStyle:{width:"170px"},attrs:{"single-check":!0,props:{id:"orgno",label:"cname",children:"children"},"tree-data":e.brnoList,placeholder:"请选择机构"},model:{value:e.QueryForm.branchNum,callback:function(t){e.$set(e.QueryForm,"branchNum",t)},expression:"QueryForm.branchNum"}})],1)],1),e._v(" "),a("aui-col",{attrs:{lg:4,md:6}},[a("aui-form-item",{attrs:{label:"广告编号",prop:"adNo"}},[a("aui-input",{attrs:{placeholder:"请输入广告编号"},model:{value:e.QueryForm.adNo,callback:function(t){e.$set(e.QueryForm,"adNo",t)},expression:"QueryForm.adNo"}})],1)],1),e._v(" "),a("aui-col",{staticClass:"searchBtnMarginTop",attrs:{lg:2,md:3}},[a("aui-button",{attrs:{type:"primary",size:"mini",icon:"aui-icon-search"},on:{click:e.queryModel}},[e._v("查询")])],1),e._v(" "),a("aui-col",{staticClass:"searchBtnMarginTop",attrs:{lg:2,md:3}},[a("aui-button",{attrs:{type:"warning",size:"mini",icon:"aui-icon-refresh"},on:{click:function(t){e.resetForm("QueryForm")}}},[e._v("重置")])],1)],1)],1)],1),e._v(" "),a("aui-card",[a("aui-row",[a("aui-col",{attrs:{md:3,lg:2}},[e.btnPermission("Button_AD_Add")?a("aui-button",{attrs:{type:"primary",size:"mini",icon:"aui-icon-plus",disabled:!(0==e.selection.length)},on:{click:function(t){e.checkAdd()}}},[e._v("新增")]):e._e()],1),e._v(" "),a("aui-col",{attrs:{md:3,lg:2}},[e.btnPermission("Button_AD_Edit")?a("aui-button",{attrs:{type:"primary",size:"mini",icon:"aui-icon-edit",disabled:!(1==e.selection.length)},on:{click:function(t){e.checkPermission("1")}}},[e._v("修改")]):e._e()],1),e._v(" "),a("aui-col",{attrs:{md:3,lg:2}},[e.btnPermission("Button_AD_Delete")?a("aui-button",{attrs:{type:"danger",size:"mini",icon:"aui-icon-delete",disabled:!(1==e.selection.length)},on:{click:function(t){e.checkPermission()}}},[e._v("删除")]):e._e()],1)],1),e._v(" "),a("aui-table",{ref:"menuItemList",staticClass:"tableMarginTop",attrs:{data:e.menuItemList,"header-row-class-name":"tableHeaderClass",border:""},on:{"selection-change":e.selectList}},[a("aui-table-column",{attrs:{type:"selection",width:"40",fixed:""}}),e._v(" "),a("aui-table-column",{attrs:{prop:"Brno",formatter:e.dataFormat,label:"机构编号"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"AdNo",label:"广告编号"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"AdType",formatter:e.dataFormat,label:"广告类型"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"AdName",label:"广告名称"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"AdContent",label:"文件路径/内容","show-overflow-tooltip":""}}),e._v(" "),a("aui-table-column",{attrs:{prop:"Remark",label:"文件描述"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"FileId",label:"文件编号"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"OperDate",label:"上传时间"}}),e._v(" "),a("aui-table-column",{attrs:{prop:"OperUserID",label:"上传用户"}}),e._v(" "),a("aui-table-column",{attrs:{label:"预览",align:"center",fixed:"right",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return["P"==t.row.AdType?a("aui-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){e.dialogDetail(t)}}},[e._v("预览")]):e._e()]}}])})],1),e._v(" "),a("div",{staticClass:"box",staticStyle:{"text-align":"right","margin-top":"10px"}},[a("aui-pagination",{attrs:{background:"","current-page":e.currentPage,"page-sizes":[10,20,50,100],"page-size":e.pageSize,layout:"total, prev, pager, next, jumper",total:e.tableTotal},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.currentPage=t}}})],1)],1),e._v(" "),a("aui-dialog",{attrs:{visible:e.dialogVisible,"lock-scroll":!1},on:{"update:visible":function(t){e.dialogVisible=t},hide:e.dialogDetailClose}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingImg,expression:"loadingImg"}],staticStyle:{"text-align":"center"}},[a("img",{staticStyle:{width:"100%","min-height":"340px",position:"relative"},attrs:{src:e.dialogImageUrl,alt:""},on:{load:function(t){e.loadingImg=!1},error:e.loadingImgFalse}})])]),e._v(" "),a(e.dialogList.addAdsFileUpload,{tag:"component",attrs:{option:e.dialogOptions},on:{succ:e.queryModel}}),e._v(" "),a(e.dialogList.editAdsFileUp,{tag:"component",attrs:{option:e.dialogOptionsUpdate,"selected-item":e.selectedItem,"edit-check-data":e.editCheckData},on:{succ:e.queryModel}})],1)},staticRenderFns:[]};var C=a("/Xao")(k,A,!1,function(e){a("49s5")},"data-v-4c0f0dfb",null);t.default=C.exports},oFHj:function(e,t,a){var i=a("aEPt");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);a("8bSs")("4e4e7486",i,!0)}});